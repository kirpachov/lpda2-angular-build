"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[3320],{9740:(S,h,o)=>{o.r(h),o.d(h,{ExportReservationsModalModule:()=>z});var _=o(2992),n=o(7552),e=o(4496),c=o(6504),i=o(1368),r=o(400);let s=(()=>{class E{constructor(){this.datePipe=(0,e.uUt)(i.y)}transform(a,p){return a instanceof r.Se?`Dal ${this.datePipe.transform(a.from.toUtcNativeDate(),p)} al ${this.datePipe.transform(a.to.toUtcNativeDate(),p)}`:null}static#e=this.\u0275fac=function(p){return new(p||E)};static#t=this.\u0275pipe=e.UTH({name:"datePeriodSummary",type:E,pure:!0,standalone:!0})}return E})();var t=o(3480),u=o(3984),d=o(424),R=o(3616);function g(E,X){if(1&E&&e.OEk(0),2&E){const a=e.GaO();e.oRS(" ",a.label," ")}}function T(E,X){if(1&E&&(e.I0R(0,"small",3),e.OEk(1),e.wVc(2,"datePeriodSummary"),e.C$Y()),2&E){const a=e.GaO();e.yG2(),e.cNF(e.kDX(2,1,a.control.value))}}const O=["*"];let y=(()=>{class E{constructor(){this.destroy$=new t.UF,this.control=new c.Ku(null),this.today=r.EK.currentLocal(),this.tomorrow=r.EK.currentLocal().append({day:1}),this.max=null,this.appProductionDate=r.EK.fromLocalNativeDate(new Date("2023-8-1")),this.endOfCurrentYear=r.EK.fromLocalNativeDate(new Date(`${this.today.year}-12-31`)),this.periodOptions=[new u.Ib(new r.Se(this.today.append({day:-30}),this.today),"Last month"),new u.Ib(new r.Se(this.today.append({day:-365}),this.today),"Last year"),...Array.from({length:5},(a,p)=>p).map(a=>this.today.year-a).filter(a=>a>=this.appProductionDate.year).map(a=>new u.Ib(new r.Se(r.EK.fromLocalNativeDate(new Date(`${a}-01-01`)),r.EK.fromLocalNativeDate(new Date(`${a}-12-31`))),`${a}`))],this.label="Select the time period."}writeValue(a){if(void 0===a&&(a=null),null===a||a instanceof r.Se)return this.control.setValue(a);console.warn("Invalid value for DatePeriodComponent",a)}registerOnChange(a){this.control.valueChanges.pipe((0,R.a)(this.destroy$)).subscribe((...p)=>a(...p))}registerOnTouched(a){this.control.valueChanges.pipe((0,R.a)(this.destroy$)).subscribe((...p)=>a(...p))}setDisabledState(a){a?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(p){return new(p||E)};static#t=this.\u0275cmp=e.In1({type:E,selectors:[["app-date-period"]],inputs:{max:"max",label:"label"},standalone:!0,features:[e.M5G([{provide:c.Y6,useExisting:(0,e.wd)(()=>E),multi:!0},t.UF]),e.UHJ],ngContentSelectors:O,decls:6,vars:6,consts:[[3,"min","max","formControl","items"],["content",""],["class","d-block text-muted"],[1,"d-block","text-muted"]],template:function(p,f){if(1&p&&(e.kPM(),e.I0R(0,"tui-input-date-range",0)(1,"span",null,1),e._Xx(3),e.C$Y(),e.yuY(4,g,1,1),e.C$Y(),e.yuY(5,T,3,3,"small",2)),2&p){const P=e.Gew(2);e.E7m("min",f.appProductionDate)("max",f.max)("formControl",f.control)("items",f.periodOptions),e.yG2(4),e.C0Y(4,P.children.length?-1:4),e.yG2(),e.C0Y(5,null!=f.control.value&&f.control.value.from&&null!=f.control.value&&f.control.value.to?5:-1)}},dependencies:[d.uy,d.YZ,d.Ku,c.sl,c.ue,c.ug,s],encapsulation:2})}return E})();var N=o(1183),D=o(8212),C=o(9956),m=o(8304),v=o(8824),l=o(3264),M=o(1128),A=o(8256),V=o(8392);let U=(()=>{class E{constructor(){this.service=(0,e.uUt)(m.S),this.destroy$=(0,e.uUt)(t.UF),this.date=(0,e.uUt)(i.y),this.notifications=(0,e.uUt)(M.E),this.loading=(0,e.OCB)(!1),this.form=new c.WC({created_at:new c.Ku(null),datetime:new c.Ku(null),status:new c.Ku(null)})}export(){this.loading.set(!0),this.service.export(this.formatFormValue()).pipe((0,R.a)(this.destroy$),(0,v.U)(()=>this.loading.set(!1))).subscribe({error:a=>{this.notifications.error((0,A.mk)(a)||V.a)}})}formatFormValue(){const a={};return this.form.value.created_at&&(a.created_at_from=this.date.transform(this.form.value.created_at.from.toUtcNativeDate(),"yyyy-MM-dd")||"",a.created_at_to=this.date.transform(this.form.value.created_at.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.datetime&&(a.datetime_from=this.date.transform(this.form.value.datetime.from.toUtcNativeDate(),"yyyy-MM-dd")||"",a.datetime_to=this.date.transform(this.form.value.datetime.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.status&&(0,N.s)(this.form.value.status)&&(a.status=this.form.value.status),a}static#e=this.\u0275fac=function(p){return new(p||E)};static#t=this.\u0275cmp=e.In1({type:E,selectors:[["app-export-reservations-modal"]],standalone:!0,features:[e.M5G([t.UF]),e.UHJ],decls:27,vars:10,consts:()=>{let a,p,f,P,$,L,x;return a="Export reservations",p="Booking status",f="Booking creation date",P="Booking date",$="(date when people come to eat)",L="Download Excel",x="Cancel",[a,[3,"formGroup","ngSubmit"],[1,"block","mb-3"],[3,"formControlName"],p,[3,"errors"],f,P,[1,"text-slate-400"],$,[1,"flex","items-center","justify-center"],["type","submit","tuiButton","","appearance","primary",1,"me-2",3,"disabled","showLoader"],L,["type","button","routerLink","..","tuiButton","","appearance","icon",3,"disabled"],x]},template:function(p,f){1&p&&(e.I0R(0,"h1"),e.aS0(1,0),e.C$Y(),e.I0R(2,"form",1),e.qCj("ngSubmit",function(){return f.export()}),e.I0R(3,"div",2)(4,"app-reservation-status-select",3),e.SAx(5),e.aS0(6,4),e.k70(),e.C$Y(),e.wR5(7,"app-errors",5),e.C$Y(),e.I0R(8,"div",2)(9,"app-date-period",3)(10,"span"),e.aS0(11,6),e.C$Y()(),e.wR5(12,"app-errors",5),e.C$Y(),e.I0R(13,"div",2)(14,"app-date-period",3)(15,"span"),e.aS0(16,7),e.C$Y()(),e.I0R(17,"span",8),e.aS0(18,9),e.C$Y(),e.wR5(19,"app-errors",5),e.C$Y(),e.I0R(20,"div",10)(21,"button",11),e.SAx(22),e.aS0(23,12),e.k70(),e.C$Y(),e.I0R(24,"button",13),e.SAx(25),e.aS0(26,14),e.k70(),e.C$Y()()()),2&p&&(e.yG2(2),e.E7m("formGroup",f.form),e.yG2(2),e.E7m("formControlName","status"),e.yG2(3),e.E7m("errors",f.form.controls.status.errors),e.yG2(2),e.E7m("formControlName","created_at"),e.yG2(3),e.E7m("errors",f.form.controls.created_at.errors),e.yG2(2),e.E7m("formControlName","datetime"),e.yG2(5),e.E7m("errors",f.form.controls.datetime.errors),e.yG2(2),e.E7m("disabled",f.form.disabled)("showLoader",f.loading()),e.yG2(3),e.E7m("disabled",f.form.disabled||f.loading()))},dependencies:[y,c.sl,c.sz,c.ue,c.u,c.uW,c.Wo,D.CI,D.Kw,C.g,l.Y,_.qQ,_.ER],encapsulation:2})}return E})(),z=(()=>{class E{static#e=this.\u0275fac=function(p){return new(p||E)};static#t=this.\u0275mod=e.a4G({type:E});static#r=this.\u0275inj=e.s3X({imports:[_.qQ.forChild([(0,n.VV)(U,{path:"",closeable:!0,dismissible:!0,size:"m"})])]})}return E})()},9956:(S,h,o)=>{o.d(h,{g:()=>C});var _=o(1368),n=o(4496),e=o(9938),c=o(2528),i=o(7308),r=o(7012),s=o(3972),t=o(5944),u=o(1040);function d(m,v){if(1&m&&(n.SAx(0),n.OEk(1),n.k70()),2&m){const l=v.polymorpheusOutlet;n.yG2(),n.oRS(" ",l," ")}}const R=()=>({});function g(m,v){if(1&m&&(n.I0R(0,"div",1),n.wVc(1,"async"),n.yuY(2,d,2,1,"ng-container",2),n.wVc(3,"async"),n.C$Y()),2&m){const l=n.GaO();n.eAK("t-message-text_light","onDark"===n.kDX(1,6,l.mode$)),n.E7m("@tuiFadeIn",l.animation)("@tuiHeightCollapse",l.animation),n.yG2(2),n.E7m("polymorpheusOutlet",l.error.message||n.kDX(3,8,l.defaultErrorMessage$))("polymorpheusOutletContext",l.error.context||n.q4q(10,R))}}let T=(()=>{class m{constructor(l,M,A){this.animation=l,this.mode$=M,this.defaultErrorMessage$=A,this.error=null,this.visible=!0}set errorSetter(l){this.error=(0,c.gT)(l)?new i.E(l):l}onAnimation(l){this.visible=l}}return m.\u0275fac=function(l){return new(l||m)(n.GI1(t.kp),n.GI1(t.Yx),n.GI1(t.cX))},m.\u0275cmp=n.In1({type:m,selectors:[["tui-error"]],hostBindings:function(l,M){1&l&&n.qCj("animationcancel.self",function(){return M.onAnimation(!1)})("animationstart.self",function(){return M.onAnimation(!0)})},inputs:{errorSetter:[n.Wk5.None,"error","errorSetter"]},features:[n.M5G([s.Ir])],decls:1,vars:1,consts:[["automation-id","tui-error__text","class","t-message-text",3,"t-message-text_light",4,"ngIf"],["automation-id","tui-error__text",1,"t-message-text"],[4,"polymorpheusOutlet","polymorpheusOutletContext"]],template:function(l,M){1&l&&n.yuY(0,g,4,11,"div",0),2&l&&n.E7m("ngIf",M.error&&M.visible)},dependencies:[_.u_,u.Af,_.a],styles:["[_nghost-%COMP%]{font:var(--tui-font-text-s);color:var(--tui-text-01);display:block;color:var(--tui-negative);word-wrap:break-word;animation:tuiPresent 1s infinite}.t-message-text[_ngcontent-%COMP%]{margin-top:.25rem;white-space:pre-line}.t-message-text_light[_ngcontent-%COMP%]{color:var(--tui-negative-night)}"],data:{animation:[r.iY,r.K2]},changeDetection:0}),m})(),O=(()=>{class m{}return m.\u0275fac=function(l){return new(l||m)},m.\u0275mod=n.a4G({type:m}),m.\u0275inj=n.s3X({imports:[[_.MD,u.Ux]]}),m})();function y(m,v){1&m&&n.wR5(0,"tui-error",0),2&m&&n.E7m("error",v.$implicit)}function N(m,v){1&m&&n.C_f(0)}function D(m,v){1&m&&n.yuY(0,N,1,0,"ng-container",1),2&m&&n.E7m("ngTemplateOutlet",v.$implicit)}let C=(()=>{class m{constructor(){this._errors=null}get errors(){return this._errors}set errors(l){this._errors=l}allErrors(){return this.errors||null}errorsToTemplates(){return e.y.formatErrors(this.errors||null).filter(l=>l&&l instanceof n.Yw2)}errorsToStr(){return e.y.formatErrors(this.errors||null).filter(l=>l&&"string"==typeof l)}static#e=this.\u0275fac=function(M){return new(M||m)};static#t=this.\u0275cmp=n.In1({type:m,selectors:[["app-errors"]],inputs:{errors:"errors"},standalone:!0,features:[n.UHJ],decls:4,vars:0,consts:[[3,"error"],[4,"ngTemplateOutlet"]],template:function(M,A){1&M&&(n.c53(0,y,1,1,"tui-error",0,n.oxv),n.c53(2,D,1,1,"ng-container",null,n.oxv)),2&M&&(n.oho(A.errorsToStr()),n.yG2(2),n.oho(A.errorsToTemplates()))},dependencies:[_.MD,_.XV,O,T]})}return m})()},8128:(S,h,o)=>{function _(n){if(!n)return null;const e=n.match(/filename="(.+)"/);return e?e[1]:null}o.d(h,{k:()=>_})},8256:(S,h,o)=>{function _(i,r){return i.error?.message?i.error.message:500==i.status?`${i.error.error} ${i.error.exception}`.replace(/\</gm,"").replace(/\>+/gm,""):504==i.status?"Server unreachable, check your connection and try again.":n(function c(i){if("object"==typeof i.error&&"object"==typeof i.error.details&&Array.isArray(i.error.details)&&i.error.details.length>0){const r=i.error.details.filter(s=>"object"==typeof s&&null!=s&&s instanceof Object&&Object.keys(s).length>0).filter(s=>"string"==typeof s.attribute&&s.attribute.length>0&&("string"==typeof s.message&&s.message.length>0||Array.isArray(s.message)&&s.message.length>0));if(r.length>0)return r}return[]}(i),r)}function n(i,r){if(0==i.length)return null;const s=r?.joinChar??", ",t=i.map(u=>`${u.attribute} ${u.message}`);return t.length?function e(i){return[...new Set(i)]}(t).join(s):null}o.d(h,{Yj:()=>n,mk:()=>_})},9938:(S,h,o)=>{o.d(h,{y:()=>c});var _=o(6504);const n={required:"This field cannot be empty!",email:"This email is not valid!",numbersOnly:"Only numbers allowed!",numberOnly:"Only numbers allowed!",numerical:"Only numbers allowed!",invalid_http_url:"Invalid HTTP connection",minlength:i=>"\n          Text too short: Minimum length: \n          " + i.requiredLength + "\n          , current length: \n          " + i.actualLength + "\n        ",InvalidFormat:i=>"\n          \" \n          " + i.value + "\n           \" is not a valid format. Valid example: \"\n          " + i.validExample + "\n          \"\n        ",pattern:i=>"\n           \" \n          " + i.actualValue + "\n           \" is not a valid format. The format must comply with the following\n          regular expression (RegExp): \" \n          " + i.requiredPattern + "\n           \" \n        ",max:i=>"\n          The entered value is too large! Maximum value: \n          " + i.max + "\n           , current value: \n          " + i.actual + "\n        ",min:i=>"\n           The entered value is too small! Minimum value: \n          " + i.min + "\n           , current value: \n          " + i.actual + "\n        ",maxlength:i=>"\n           The entered value is too long! Maximum length: \n          " + i.requiredLength + "\n           , Current length: \n          " + i.actualLength + "\n        ",phoneIT:"\n           This does not seem to be a valid Italian phone number. Example: +39\n          123 456 7890 \n        ",inclusion:i=>{const r=Array.isArray(i)?"\n           The allowed values are: \n          " + i.join(", ") + "\n           . \n        ":"";return "\n           The entered value is not valid. \n          " + r + "\n        "},arrayMinLength:i=>"\n           You must enter at least \n          " + i.requiredLength + "\n           elements. \n        ",passwordConfirmation:"The passwords do not match!",formWeeklyFromTo:"The start time must be earlier than the end time!"},e={assignToFormUnlessControl:!0};class c{static formatErrors(r,s){return null==r||null==r?[]:new c(r,s).formatErrors()}static assignErrorsToForm(r,s,t={}){const u=s.error?.details;if(!u||!Array.isArray(u))return"object"==typeof u&&Object.keys(u).length>0?this.assignErrorsToFormFromJson(r,u,t):void console.warn("invalid errors provided to assignErrorsToForm",u);this.assignErrorsToFormFromArray(r,u,t)}static assignErrorsToFormFromJson(r,s,t={}){const u={...e,...t};Object.keys(s).forEach(d=>{const R=s[d];R&&Array.isArray(R)?R.forEach(g=>{const T=r.controls[d];T?T.setErrors({[g.attribute]:g.message}):u.assignToFormUnlessControl&&r.setErrors({[g.attribute]:g.message})}):console.warn("assignErrorsToFormFromJson expected an array of ActiveError, but got:",R)})}static assignErrorsToFormFromArray(r,s,t={}){const u={...e,...t};s.forEach(d=>{const R=r instanceof _.WC?r.controls[d.attribute]:r;R?R.setErrors({[d.attribute]:d.message}):u.assignToFormUnlessControl&&r.setErrors({[d.attribute]:d.message})})}constructor(r,s=n){this.defaultMessages=n,this.messages={},this.enableLogging=!1,this.errors=r,s?this.mergeMessages(s):this.assignDefaults()}assignDefaults(){this.messages={},Object.keys(this.defaultMessages).forEach(r=>{this.messages[r]=this.defaultMessages[r]})}mergeMessages(r){[...Object.keys(this.defaultMessages),...Object.keys(r)].forEach(t=>{this.messages[t]=r[t]?r[t]:this.defaultMessages[t]})}formatErrors(){return[...this.errorMsgFromControl()]}warn(...r){this.enableLogging&&console.warn(...r)}errorMsgFromControl(){if(null==this.errors||null==this.errors)return[];var r=[];return Object.keys(this.errors).filter(s=>{if("string"==typeof this.errors[s]&&this.errors[s].length>0)return r.push(this.errors[s]);if(this.messages.hasOwnProperty(s)&&this.messages[s]&&null!=this.messages[s]){const d=this.messages[s];switch(typeof d){case"string":default:r.push(d);break;case"function":r.push(d(this.errors[s]))}}else if(this.warn(`ReactiveFormsErrors missing error message of "${s}". Parser error with your custom logic.`),[!0,!1].includes(this.errors[s])){var u={};u[s]=this.errors[s],"string"!=typeof u&&(u=JSON.stringify(u)),r.push(u)}else r.push(this.errors[s])}),r}}},5180:(S,h,o)=>{o.d(h,{C:()=>r});var _=o(8400);class n extends _.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class e extends _.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(u=>new n(u)):[]}}class c extends _.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(u=>new e(u)):[]}}class i extends _.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.other=t.other}}class r extends _.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new i(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(u=>new c(u)):[]}}},8304:(S,h,o)=>{o.d(h,{S:()=>u});var _=o(6012),n=o(5180),e=o(4704),c=o(3252),i=o(9144),r=o(7048),s=o(8128),t=o(4496);let u=(()=>{class d extends _.s{constructor(){super(n.C,"admin/reservations")}tablesSummary(g={}){return this.get("tables_summary",{params:g})}deliverConfirmationEmail(g){return this.post(`${g}/deliver_confirmation_email`,{}).pipe((0,e.k)(T=>this.mapItem(T)))}export(g){return new c._(T=>{this.get("export",{responseType:"blob",observe:"response",params:g}).pipe((0,i.a)(O=>(console.error("ReservationsService.export() error:",O),T.error(O),new c._))).subscribe(O=>{if(O instanceof r.WA&&O.body){const y=(0,s.k)(O.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",N=O.headers?.get("Content-Type")??"application/octet-stream",D=window.URL.createObjectURL(new Blob([O.body],{type:N})),C=document.createElement("a");C.href=D,C.download=y,C.click(),T.complete()}})})}static#e=this.\u0275fac=function(T){return new(T||d)};static#t=this.\u0275prov=t.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},4736:(S,h,o)=>{o.d(h,{M:()=>c,O:()=>i});var _=o(4496),n=o(5944),e=o(4704);let c=(()=>{class r{constructor(t){this.months$=t}transform({month:t}){return this.months$.pipe((0,e.k)(u=>u[t]))}}return r.\u0275fac=function(t){return new(t||r)(_.GI1(n.GU,16))},r.\u0275pipe=_.UTH({name:"tuiMonth",type:r,pure:!0}),r})(),i=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=_.a4G({type:r}),r.\u0275inj=_.s3X({}),r})()},3984:(S,h,o)=>{o.d(h,{AF:()=>e,Ib:()=>_});class _{constructor(i,r,s){this.range=i,this.name=r,this.content=s}toString(){return this.name}}class e{constructor(i,r){this.item=i,this.stringify=r}toString(){return this.stringify(this.item)}}},796:(S,h,o)=>{o.d(h,{YL:()=>R,g3:()=>g}),o(4736);var n=o(5193),e=o(5944),r=(o(3012),o(2700),o(528)),t=(o(4704),o(4496)),u=o(6504);const R=(0,n.Sk)({limitWidth:"fixed",align:"right"}),g={provide:e.Y9,deps:[[new t.T7N,new t.Yiy,u.Y6]],useFactory:r.Z}}}]);