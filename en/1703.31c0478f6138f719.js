"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[1703],{1703:(h,O,t)=>{t.d(O,{q:()=>q});var e=t(4496),s=t(6504),d=t(1236),C=t(8256),i=t(9938),r=t(8392),R=t(1128),f=t(3480),P=t(400),D=t(5e3),N=t(8212),I=t(7692),E=t(9880),A=t(8048),v=t(3797),m=t(9888),u=t(2740),_=t(6052),n=t(5188),a=t(3616),p=t(4e3),M=t(8824),W=t(9956),x=t(7924),F=t(7556),K=t(2516),B=t(1240),L=t(964),G=t(7936),k=t(4336);const V=(l,g)=>g.id;function Y(l,g){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.name.errors)}}function z(l,g){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.weekday.errors)}}const b=()=>[15,30,45,60];function X(l,g){1&l&&e.wR5(0,"tui-data-list-wrapper",20),2&l&&e.E7m("items",e.q4q(1,b))}function H(l,g){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.step.errors)}}function Q(l,g){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.starts_at.errors)}}function j(l,g){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.ends_at.errors)}}function J(l,g){if(1&l&&(e.I0R(0,"div",21),e.OEk(1),e.C$Y()),2&l){const o=g.$implicit;e.yG2(),e.MjK("",o.name,": ",o.starts_at," - ",o.ends_at,"")}}function Z(l,g){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.errors)}}let q=(()=>{class l{constructor(){this.service=(0,e.uUt)(F.K),this.destroy$=(0,e.uUt)(f.UF),this.notifications=(0,e.uUt)(R.E),this.route=(0,e.uUt)(d.gV),this.formSubmitted=(0,e.OCB)(!1),this.parentLoading=(0,e.OCB)(!1),this.searching=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.parentLoading()||this.searching()),this._context="create",this.submitted=new e._w7,this.cancelled=new e._w7,this.concurrentData=(0,e.OCB)(null),this.concurrent=(0,e.S6b)(()=>(this.concurrentData()?.items??[]).filter(o=>o.weekday==this.form.value.weekday&&o.id!=this.currentItemId())),this.form=new s.WC({weekday:new s.Ku(null,[s.AQ.required]),starts_at:new s.Ku(null,[s.AQ.required]),ends_at:new s.Ku(null,[s.AQ.required]),step:new s.Ku(30,[s.AQ.required,s.AQ.min(15),s.AQ.max(60)]),name:new s.Ku(null,[s.AQ.required])}),this.formInitialValue=this.form.value,this.currentItemId=(0,e.OCB)(null)}set setParentLoading(o){this.parentLoading.set(o)}set context(o){"update"==o?this.form.controls.weekday.disable():this.form.controls.weekday.enable()}get context(){return this._context}set turn(o){if(this.currentItemId.set(o?.id??null),o){const T={weekday:o.weekday,starts_at:o.starts_at?P.uc.fromString(o.starts_at):null,ends_at:o.ends_at?P.uc.fromString(o.ends_at):null,step:o.step,name:o.name};this.form.patchValue(T)}else this.form.reset(this.formInitialValue)}ngOnInit(){this.form.controls.weekday.valueChanges.pipe((0,a.a)(this.destroy$),(0,p.a)()).subscribe({next:o=>this.searchSameWeekday(o)}),this.route.queryParams.pipe((0,a.a)(this.destroy$)).subscribe({next:o=>{o.weekday&&this.form.controls.weekday.setValue(o.weekday)}})}manageHttpError(o){i.y.assignErrorsToForm(this.form,o),this.notifications.error((0,C.mk)(o)||r.a)}submit(){this.formSubmitted.set(!0),!this.form.invalid&&this.submitted.emit(this.formatOutput())}cancel(){this.cancelled.emit()}formatOutput(){const{ends_at:o,starts_at:T,name:c,step:S}=this.form.value,U={starts_at:T?(0,L.In)(T):null,ends_at:o?(0,L.In)(o):null,name:c??"",step:S??30};return"create"==this.context&&(U.weekday=this.form.controls.weekday.value||0),U}searchSameWeekday(o){null!=o?(this.searching.set(!0),this.service.search({weekday:o,per_page:100}).pipe((0,a.a)(this.destroy$),(0,M.U)(()=>this.searching.set(!1))).subscribe({next:T=>this.concurrentData.set(T)})):this.concurrentData.set(null)}static#e=this.\u0275fac=function(T){return new(T||l)};static#t=this.\u0275cmp=e.In1({type:l,selectors:[["app-reservation-turn-form"]],inputs:{setParentLoading:[e.Wk5.None,"loading","setParentLoading"],context:"context",turn:"turn"},outputs:{submitted:"submitted",cancelled:"cancelled"},standalone:!0,features:[e.UHJ],decls:44,vars:20,consts:()=>{let o,T,c,S,U,w,$;return o="Shift name",T="Minutes between one booking and another",c="From the hours",S="Until the hours",U="\n           Note that for \n          " + "\ufffd0\ufffd" + "\n           the following shifts are also present: \n        ",w="Save",$="Cancel",[[3,"formGroup","ngSubmit"],[1,"mb-3","block"],["tuiAutoFocus","",3,"formControlName"],o,[3,"errors"],[3,"formControlName"],T,["tuiTextfield",""],[3,"items",4,"tuiDataList"],[1,"flex","items-center"],[1,"me-2","grow"],c,S,[3,"expanded"],[1,"text-slate-400"],U,["type","submit","tuiButton","","appearance","primary",3,"showLoader"],w,["type","button","tuiButton","","appearance","icon",3,"disabled","click"],$,[3,"items"],[1,"block"],["class","block"]]},template:function(T,c){1&T&&(e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return c.submit()}),e.I0R(1,"div",1)(2,"tui-input",2),e.SAx(3),e.aS0(4,3),e.k70(),e.C$Y(),e.yuY(5,Y,1,1,"app-errors",4),e.C$Y(),e.I0R(6,"div",1),e.wR5(7,"app-weekday-select",5),e.yuY(8,z,1,1,"app-errors",4),e.C$Y(),e.I0R(9,"div",1)(10,"tui-select",5),e.SAx(11),e.aS0(12,6),e.k70(),e.wR5(13,"input",7),e.yuY(14,X,1,2,"tui-data-list-wrapper",8),e.C$Y(),e.yuY(15,H,1,1,"app-errors",4),e.C$Y(),e.I0R(16,"div",1)(17,"div",9)(18,"div",10)(19,"tui-input-time",5),e.SAx(20),e.aS0(21,11),e.k70(),e.C$Y(),e.yuY(22,Q,1,1,"app-errors",4),e.C$Y(),e.I0R(23,"div",10)(24,"tui-input-time",5),e.SAx(25),e.aS0(26,12),e.k70(),e.C$Y(),e.yuY(27,j,1,1,"app-errors",4),e.C$Y()(),e.I0R(28,"tui-expand",13)(29,"div",14)(30,"span"),e.aS0(31,15),e.wVc(32,"downcase"),e.wVc(33,"weekday"),e.C$Y(),e.c53(34,J,2,3,"div",22,V),e.C$Y()()(),e.yuY(36,Z,1,1,"app-errors",4),e.I0R(37,"div",9)(38,"button",16),e.SAx(39),e.aS0(40,17),e.k70(),e.C$Y(),e.I0R(41,"button",18),e.qCj("click",function(){return c.cancel()}),e.SAx(42),e.aS0(43,19),e.k70(),e.C$Y()()()),2&T&&(e.E7m("formGroup",c.form),e.yG2(2),e.E7m("formControlName","name"),e.yG2(3),e.C0Y(5,c.formSubmitted()||c.form.controls.name.touched?5:-1),e.yG2(2),e.E7m("formControlName","weekday"),e.yG2(),e.C0Y(8,c.formSubmitted()||c.form.controls.weekday.touched?8:-1),e.yG2(2),e.E7m("formControlName","step"),e.yG2(5),e.C0Y(15,c.formSubmitted()||c.form.controls.step.touched?15:-1),e.yG2(4),e.E7m("formControlName","starts_at"),e.yG2(3),e.C0Y(22,c.formSubmitted()||c.form.controls.starts_at.touched?22:-1),e.yG2(2),e.E7m("formControlName","ends_at"),e.yG2(3),e.C0Y(27,c.formSubmitted()||c.form.controls.ends_at.touched?27:-1),e.yG2(),e.E7m("expanded",c.concurrent().length>0),e.yG2(5),e.oBb(e.kDX(32,16,e.kDX(33,18,c.form.value.weekday))),e.Ylm(31),e.yG2(),e.oho(c.concurrent()),e.yG2(2),e.C0Y(36,c.formSubmitted()?36:-1),e.yG2(2),e.E7m("showLoader",c.loading()),e.yG2(3),e.E7m("disabled",c.loading()))},dependencies:[N.CI,N.Kw,I.Sk,s.sl,s.sz,s.ue,s.u,s.uW,s.Wo,v.CQ,v.Oo,v.cP,G.b,W.g,m.Q7,u.IZ,u.iw,u.gt,x.W,D.m6,D.gJ,K.G,E.kh,E.st,B.e,_.q8,_.OO,k.Ux,A.aS,n.my,n.cP,n.uO],encapsulation:2,changeDetection:0})}return l})()},7924:(h,O,t)=>{t.d(O,{W:()=>v});var e=t(4496),s=t(6504),d=t(3480),C=t(5e3),i=t(8048),r=t(5193),R=t(6052),f=t(5188),P=t(2516),D=t(4336),N=t(7936);function I(m,u){1&m&&(e.OEk(0),e.wVc(1,"weekday")),2&m&&e.cNF(e.kDX(1,1,u.$implicit))}const E=()=>[0,1,2,3,4,5,6];function A(m,u){if(1&m&&e.wR5(0,"tui-data-list-wrapper",5),2&m){e.GaO();const _=e.Gew(1);e.E7m("items",e.q4q(2,E))("itemContent",_)}}let v=(()=>{class m{constructor(){this.control=new s.Ku(null,[s.AQ.min(0),s.AQ.max(6)]),this.initialAutofocus=(0,e.OCB)(!1),this.dropdownOpen=(0,e.OCB)(!1),this.showCleaner=!0}set autofocus(_){this.initialAutofocus.set(!0===_),this.dropdownOpen.set(!0===_)}ngOnChanges(){this.control.valueChanges.subscribe({next:_=>{_&&this.dropdownOpen.set(!1)}})}writeValue(_){let n=null;n="number"==typeof _?_:"string"==typeof _?Number(_):null,this.control.setValue(n)}registerOnChange(_){this.control.valueChanges.subscribe({next:n=>_(n)})}registerOnTouched(_){this.control.valueChanges.subscribe({next:n=>_(n)})}setDisabledState(_){_?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(n){return new(n||m)};static#t=this.\u0275cmp=e.In1({type:m,selectors:[["app-weekday-select"]],inputs:{showCleaner:"showCleaner",autofocus:"autofocus"},standalone:!0,features:[e.M5G([d.UF,{provide:s.Y6,useExisting:m,multi:!0}]),e.SYr,e.UHJ],decls:7,vars:5,consts:()=>{let _;return _="Day of the week",[["selectItem",""],[3,"tuiAutoFocus","tuiDropdownOpen","valueContent","tuiTextfieldCleaner","formControl","tuiDropdownOpenChange"],_,["tuiTextfield",""],[3,"items","itemContent",4,"tuiDataList"],[3,"items","itemContent"]]},template:function(n,a){if(1&n&&(e.yuY(0,I,2,3,"ng-template",null,0,e.gJz),e.I0R(2,"tui-select",1),e.qCj("tuiDropdownOpenChange",function(M){return a.dropdownOpen.set(M)}),e.SAx(3),e.aS0(4,2),e.k70(),e.wR5(5,"input",3),e.yuY(6,A,1,3,"tui-data-list-wrapper",4),e.C$Y()),2&n){const p=e.Gew(1);e.yG2(2),e.E7m("tuiAutoFocus",a.initialAutofocus())("tuiDropdownOpen",a.dropdownOpen())("valueContent",p)("tuiTextfieldCleaner",a.showCleaner)("formControl",a.control)}},dependencies:[R.q8,R.OO,D.Ux,i.aS,i.es,f.my,f.cP,f.uO,N.b,s.sl,s.ue,s.ug,P.G,C.m6,C.gJ,r.ms,r.oL],encapsulation:2})}return m})()},9772:(h,O,t)=>{t.d(O,{CU:()=>d,MJ:()=>s,ye:()=>C}),(new Date).getTimezoneOffset();const s=1;function d(i,r=s){if(!("string"==typeof i&&i.length>0&&i.match(/\d{1,2}:\d{1,2}/)))return console.error("Invalid string provided to strTimeTimezone",{string:i}),"";const f=Number(i.split(":")[0])+r;return`${f<10?"0":""}${f}:${i.split(":")[1]}`}function C(i,r=s){return d(i,-1*r)}},1960:(h,O,t)=>{t.d(O,{u:()=>C});var e=t(8400),s=t(7516);class d extends e.w{constructor(r){super(r),this.date=r.date?new Date(r.date):void 0,this.reservation_turn_id=r.reservation_turn_id,this.group_id=r.group_id,this.reservation_turn=r.reservation_turn?new s.e(r.reservation_turn):void 0}}class C extends e.w{constructor(r){super(r),this.turns=[],this.dates=[],this.title=r.title,this.status=r.status,this.preorder_type=r.preorder_type,this.payment_value=r.payment_value,this.message=r.message,this.turns=(r.turns||[]).map(R=>new s.e(R)),this.dates=(r.dates||[]).map(R=>new d(R)),this.translations=r.translations||{},this.table_type_to_preorder_reservation_groups=r.table_type_to_preorder_reservation_groups}}},7516:(h,O,t)=>{t.d(O,{e:()=>C});var e=t(8400),s=t(9772),d=t(1960);class C extends e.w{constructor(r){super(r),this.messages=[],this.name=r.name,this.weekday=r.weekday,this.step=r.step,this.valid_times=r.valid_times,this.starts_at=r.starts_at?(0,s.CU)(r.starts_at):void 0,this.ends_at=r.ends_at?(0,s.CU)(r.ends_at):void 0,this.preorder_reservation_group=r.preorder_reservation_group?new d.u(r.preorder_reservation_group):void 0,this.messages=r.messages}}},1240:(h,O,t)=>{t.d(O,{e:()=>s});var e=t(4496);let s=(()=>{class d{transform(i){return"string"==typeof i&&i.length>0?i.toLowerCase():null}static#e=this.\u0275fac=function(r){return new(r||d)};static#t=this.\u0275pipe=e.UTH({name:"downcase",type:d,pure:!0,standalone:!0})}return d})()},2516:(h,O,t)=>{t.d(O,{G:()=>s});var e=t(4496);let s=(()=>{class d{constructor(){this.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}transform(i){return"number"!=typeof i&&"string"==typeof i&&(i=parseInt(i)),"number"==typeof i&&i>=0&&i<=6?this.weekdays[i]:null}static#e=this.\u0275fac=function(r){return new(r||d)};static#t=this.\u0275pipe=e.UTH({name:"weekday",type:d,pure:!0,standalone:!0})}return d})()},7556:(h,O,t)=>{t.d(O,{K:()=>C});var e=t(6012),s=t(7516),d=t(4496);let C=(()=>{class i extends e.s{constructor(){super(s.e,"admin/reservation_turns")}static#e=this.\u0275fac=function(f){return new(f||i)};static#t=this.\u0275prov=d.wxM({token:i,factory:i.\u0275fac,providedIn:"root"})}return i})()},9880:(h,O,t)=>{t.d(O,{kP:()=>I,kh:()=>m,st:()=>v});var e=t(4496),s=t(3480),d=t(4392),C=t(3120),i=t(3616),r=t(7692),R=t(1368);const f=["wrapper"];function P(u,_){if(1&u&&(e.I0R(0,"tui-loader",4),e.C_f(1,5),e.C$Y()),2&u){const n=e.GaO(2);e.E7m("overlay",!0)("showLoader",n.loading),e.yG2(),e.E7m("ngTemplateOutlet",n.content)}}function D(u,_){if(1&u&&(e.SAx(0),e._Xx(1),e.yuY(2,P,2,3,"tui-loader",3),e.k70()),2&u){const n=e.GaO();e.yG2(2),e.E7m("ngIf",n.async)("ngIfElse",n.content)}}const N=["*"];let I=(()=>{class u{}return u.\u0275fac=function(n){return new(n||u)},u.\u0275dir=e.Sc5({type:u,selectors:[["","tuiExpandContent",""]]}),u})();let v=(()=>{class u{constructor(n,a){this.cdr=n,this.destroy$=a,this.state=0,this.async=!1,this.content=null,this.expanded=null}set expandedSetter(n){if(null!==this.expanded)return 0!==this.state?(this.expanded=n,void(this.state=3)):(this.expanded=n,void this.retrigger(this.async&&n?1:3));this.expanded=n}get overflow(){return 0!==this.state}get loading(){return!!this.expanded&&this.async&&1===this.state}get height(){const{expanded:n,state:a,contentWrapper:p}=this;return n&&2===a||!n&&3===a?0:p&&(!n&&2===a||n&&3===a)?p.nativeElement.offsetHeight:p&&n&&1===a?Math.max(p.nativeElement.offsetHeight,48):null}get contentVisible(){return this.expanded||0!==this.state}onTransitionEnd({propertyName:n}){"opacity"===n&&3===this.state&&(this.state=0)}onExpandLoaded(n){n.stopPropagation(),1===this.state&&this.retrigger(3)}retrigger(n){this.state=2,(0,C.k)(0).pipe((0,i.a)(this.destroy$)).subscribe(()=>{2===this.state&&(this.state=n,this.cdr.markForCheck())})}}return u.\u0275fac=function(n){return new(n||u)(e.GI1(e.kD9),e.GI1(s.UF,2))},u.\u0275cmp=e.In1({type:u,selectors:[["tui-expand"]],contentQueries:function(n,a,p){if(1&n&&e.szK(p,I,5,e.Yw2),2&n){let M;e.wto(M=e.Gqi())&&(a.content=M.first)}},viewQuery:function(n,a){if(1&n&&e.CC$(f,5),2&n){let p;e.wto(p=e.Gqi())&&(a.contentWrapper=p.first)}},hostVars:9,hostBindings:function(n,a){1&n&&e.qCj("transitionend.self",function(M){return a.onTransitionEnd(M)})("tui-expand-loaded",function(M){return a.onExpandLoaded(M)}),2&n&&(e.e48("aria-expanded",a.expanded),e.m4B("height",a.height,"px"),e.eAK("_expanded",a.expanded)("_overflow",a.overflow)("_loading",a.loading))},inputs:{async:"async",expandedSetter:[e.Wk5.None,"expanded","expandedSetter"]},features:[e.M5G([s.UF])],ngContentSelectors:N,decls:3,vars:3,consts:[[1,"t-wrapper"],["wrapper",""],[4,"ngIf"],["size","l",3,"overlay","showLoader",4,"ngIf","ngIfElse"],["size","l",3,"overlay","showLoader"],[3,"ngTemplateOutlet"]],template:function(n,a){1&n&&(e.kPM(),e.I0R(0,"div",0,1),e.yuY(2,D,3,2,"ng-container",2),e.C$Y()),2&n&&(e.E7m("@tuiParentAnimation",void 0)("@.disabled",a.overflow),e.yG2(2),e.E7m("ngIf",a.contentVisible))},dependencies:[r.Cb,R.u_,R.XV],styles:['[_nghost-%COMP%]{transition-property:opacity,height,visibility;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;display:block;opacity:0;transition-delay:1ms}._overflow[_nghost-%COMP%]{overflow:hidden}._expanded[_nghost-%COMP%]{opacity:1;transform:translate(0)}._loading[_nghost-%COMP%]{opacity:.99}.t-wrapper[_ngcontent-%COMP%]:before, .t-wrapper[_ngcontent-%COMP%]:after{content:"";display:table}'],data:{animation:[d.cI]},changeDetection:0}),u})(),m=(()=>{class u{}return u.\u0275fac=function(n){return new(n||u)},u.\u0275mod=e.a4G({type:u}),u.\u0275inj=e.s3X({imports:[[R.MD,r.Sk]]}),u})()}}]);