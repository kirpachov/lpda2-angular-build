"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[4208],{4208:(O,S,o)=>{o.d(S,{u:()=>w});var e=o(4496),d=o(3480),a=o(400),c=o(8304),u=o(3616),R=o(8824),T=o(7692),h=o(5656);let b=(()=>{class n{transform(i){return null==i||"object"!=typeof i||Array.isArray(i)?[]:Object.keys(i).map(s=>[s,i[s]])}static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275pipe=e.UTH({name:"objectToArray",type:n,pure:!0,standalone:!0})}return n})();var _=o(1560),l=o(1368);function p(n,r){if(1&n&&e.wR5(0,"tui-loader",0),2&n){const i=e.GaO();e.E7m("showLoader",i.showLoader)("size","s")}}const C=(n,r)=>r[0];function y(n,r){if(1&n&&(e.SAx(0),e.aS0(1,8),e.k70(),e.OEk(2)),2&n){const i=e.GaO(2);e.yG2(2),e.oRS(" ",i.totalPeople(),"\n")}}function A(n,r){if(1&n&&(e.OEk(0),e.SAx(1),e.aS0(2,11),e.k70(),e.OEk(3),e.SAx(4),e.aS0(5,12),e.k70()),2&n){const i=e.GaO().$implicit;e.oRS(" ",i[1]," "),e.yG2(3),e.oRS(" ",i[0]," ")}}function f(n,r){if(1&n&&(e.yuY(0,A,6,2,"ng-template",null,9,e.gJz),e.I0R(2,"span",10),e.OEk(3),e.C$Y()),2&n){const i=r.$implicit,s=e.Gew(1);e.yG2(2),e.E7m("tuiHint",s),e.yG2(),e.CAO(" ",i[1]," x ",i[0]," ")}}function I(n,r){if(1&n&&(e.I0R(0,"p",13),e.OEk(1),e.C$Y()),2&n){const i=e.GaO(2);e.yG2(),e.oRS(" ",i.groupedError()," ")}}const P=(n,r)=>r.turn.id;function x(n,r){1&n&&e.OEk(0,"Quante persone ci sono al tavolo in questione")}function L(n,r){if(1&n&&(e.I0R(0,"th",20),e.OEk(1),e.C$Y()),2&n){const i=r.$implicit;e.yG2(),e.oRS(" ",i[0]," ")}}function $(n,r){1&n&&e.OEk(0,"Quanti tavoli con lo stesso numero di persone")}const U=n=>({"text-slate-400":n});function G(n,r){if(1&n&&(e.I0R(0,"td",24)(1,"span",27),e.OEk(2),e.C$Y()()),2&n){const i=r.$implicit;e.yG2(),e.E7m("ngClass",e.S45(2,U,0==i[1])),e.yG2(),e.cNF(i[1])}}function Y(n,r){if(1&n&&(e.I0R(0,"div",15)(1,"p",16)(2,"b"),e.OEk(3),e.C$Y()(),e.I0R(4,"table",17)(5,"thead",18)(6,"tr",19)(7,"th",20),e.yuY(8,x,1,0,"ng-template",null,21,e.gJz),e.I0R(10,"span",22),e.aS0(11,23),e.C$Y()(),e.c53(12,L,2,1,"th",28,C),e.wVc(14,"objectToArray"),e.C$Y()(),e.I0R(15,"tbody")(16,"tr",19)(17,"td",24),e.yuY(18,$,1,0,"ng-template",null,25,e.gJz),e.I0R(20,"span",22),e.aS0(21,26),e.C$Y()(),e.c53(22,G,3,4,"td",29,C),e.wVc(24,"objectToArray"),e.C$Y()()()()),2&n){const i=r.$implicit,s=e.Gew(9),m=e.Gew(19);e.yG2(3),e.cNF(i.turn.name),e.yG2(7),e.E7m("tuiHint",s),e.yG2(2),e.oho(e.kDX(14,3,i.summary)),e.yG2(8),e.E7m("tuiHint",m),e.yG2(2),e.oho(e.kDX(24,5,i.summary))}}function B(n,r){if(1&n&&(e.I0R(0,"div",14),e.c53(1,Y,25,7,"div",30,P),e.C$Y()),2&n){const i=e.GaO(2);e.yG2(),e.oho(i.groupedData())}}function D(n,r){if(1&n&&(e.yuY(0,y,3,1,"ng-template",null,1,e.gJz),e.I0R(2,"div",2)(3,"span",3),e.SAx(4),e.aS0(5,4),e.k70(),e.C$Y(),e.c53(6,f,4,3,null,null,C),e.I0R(8,"span",5)(9,"mat-icon",6),e.OEk(10,"import_contacts"),e.C$Y(),e.OEk(11),e.C$Y()(),e.yuY(12,I,2,1,"p",7)(13,B,3,0)),2&n){const i=e.Gew(1),s=e.GaO();e.yG2(6),e.oho(s.ungroupedData()),e.yG2(2),e.E7m("tuiHint",i),e.yG2(3),e.oRS(" ",s.totalPeople()," "),e.yG2(),e.C0Y(12,s.groupedError()?12:13)}}let w=(()=>{class n{constructor(){this.destroy$=(0,e.uUt)(d.UF),this.service=(0,e.uUt)(c.S),this.ungroupedData=(0,e.OCB)(null),this.totalPeople=(0,e.S6b)(()=>this.ungroupedData()?.reduce((i,[s,m])=>i+s*m,0)||0),this.groupedData=(0,e.OCB)(null),this.loadingGrouped=(0,e.OCB)(!1),this.loadingUngrouped=(0,e.OCB)(!1),this.parentLoading=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.loadingGrouped()||this.loadingUngrouped()||this.parentLoading()),this.groupedError=(0,e.OCB)(null),this.filters=null}set showLoader(i){this.parentLoading.set(i)}get showLoader(){return this.parentLoading()}ngOnChanges(){this.query()}query(){this.queryUngrouped(),this.queryGrouped()}queryUngrouped(){this.loadingUngrouped.set(!0);const i={};Object.keys(this.filters??{}).forEach(s=>{if(this.filters){const m=this.filters[s];m instanceof a.EK?i[s]=m.toString():m&&(i[s]=m)}}),this.service.ungroupedTablesSummary(i).pipe((0,u.a)(this.destroy$),(0,R.U)(()=>this.loadingUngrouped.set(!1))).subscribe({next:s=>{this.ungroupedData.set(Object.entries(s).map(([m,M])=>[Number(m),M]))}})}queryGrouped(){this.groupedError.set(null),this.groupedData.set(null);const i={};if(this.filters&&this.filters.date_from&&this.filters.date_from===this.filters.date_to)i.date=this.filters.date_from.toString();else{if(!(this.filters&&this.filters.date instanceof a.EK))return console.warn("invalid filters for grouped data",this.filters,JSON.stringify(this.filters)),void this.groupedError.set("Select a single day to view the summary grouped by shift.");i.date=this.filters.date.toString()}this.loadingGrouped.set(!0),this.service.tablesSummary(i).pipe((0,u.a)(this.destroy$),(0,R.U)(()=>this.loadingGrouped.set(!1))).subscribe({next:s=>{this.groupedData.set(function E(n){const r=n.map(i=>Object.keys(i.summary).map(Number)).flat();return n.map(i=>function t(n,r){for(let s=1;s<=8;s++)s in n.summary||(n.summary[s]=0);for(const s of r)s in n.summary||(n.summary[s]=0);return n}(i,r))}(s))}})}static#e=this.\u0275fac=function(s){return new(s||n)};static#t=this.\u0275cmp=e.In1({type:n,selectors:[["app-reservation-tables-summary"]],inputs:{showLoader:"showLoader",filters:"filters"},standalone:!0,features:[e.M5G([d.UF]),e.SYr,e.UHJ],decls:2,vars:1,consts:()=>{let i,s,m,M,N,v;return i="Table distribution",s="Total people",m="tables from",M="people",N="N\xB0 of people",v="Quantity:",[[3,"showLoader","size"],["totalHint",""],[1,"flex","items-center","justify-around","border","px-2","py-2","border-slate-200"],[1,"hidden","md:flex","items-center","justify-center"],i,[1,"flex","items-center",3,"tuiHint"],[1,"me-1"],["class","text-slate-500"],s,["dHint",""],[1,"me-1",3,"tuiHint"],m,M,[1,"text-slate-500"],[1,"flex","flex-wrap"],[1,"col-12","pe-2","mb-2","md:col-6"],[1,"font-xl"],[1,"tui-table"],[1,"bg-tui-base-04"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__th"],["headerExplain",""],[3,"tuiHint"],N,[1,"tui-table__td"],["valueExplain",""],v,[3,"ngClass"],["class","tui-table__th"],["class","tui-table__td"],["class","col-12 pe-2 mb-2 md:col-6"]]},template:function(s,m){1&s&&e.yuY(0,p,1,2,"tui-loader",0)(1,D,14,3),2&s&&e.C0Y(0,m.loading()?0:1)},dependencies:[T.Sk,T.Cb,h.WY,h.lh,h.SL,h.i6,h.IT,_.oB,_.qL,b,l.QF],styles:["td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid var(--tui-base-04)}table[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-size:.9rem}table[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   .tui-table__td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   .tui-table__th[_ngcontent-%COMP%]{padding:.5rem;height:inherit}"],changeDetection:0})}return n})()},8128:(O,S,o)=>{function e(d){if(!d)return null;const a=d.match(/filename="(.+)"/);return a?a[1]:null}o.d(S,{k:()=>e})},2264:(O,S,o)=>{o.d(S,{W:()=>d});var e=o(8400);class d extends e.w{constructor(c){super(c),this.filename=c.filename,this.status=c.status,this.key=c.key,this.original_id=c.original_id,this.tag=c.tag,this.url=c.url}}},5180:(O,S,o)=>{o.d(S,{C:()=>T});var e=o(8400);class d extends e.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class a extends e.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(E=>new d(E)):[]}}class c extends e.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(E=>new a(E)):[]}}class u extends e.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.external_id=t.external_id,this.other=t.other}}var R=o(9064);class T extends e.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new u(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(E=>new c(E)):[],this.table_type_id=t.table_type_id,this.table_type=t.table_type?new R.g(t.table_type):void 0}}},9064:(O,S,o)=>{o.d(S,{g:()=>a});var e=o(8400),d=o(2264);class a extends e.w{constructor(u){super(u),this.name=u.name,this.description=u.description,this.default_people_per_turn=u.default_people_per_turn,this.default_price=u.default_price,this.notes=u.notes,this.status=u.status,this.translations=u.translations,this.images=u.images?u.images.map(R=>new d.W(R)):[]}}},8304:(O,S,o)=>{o.d(S,{S:()=>t});var e=o(6012),d=o(5180),a=o(4704),c=o(3252),u=o(9144),R=o(7048),T=o(8128),h=o(4496);let t=(()=>{class E extends e.s{constructor(){super(d.C,"admin/reservations")}createPayment(_,l){return this.post(`${_}/payment`,l).pipe((0,a.k)(p=>this.mapItem(p)))}updateStatus(_,l){return this.patch(`${_}/status/${l}`,{}).pipe((0,a.k)(p=>this.mapItem(p)))}tablesSummary(_={}){return this.get("tables_summary",{params:_})}ungroupedTablesSummary(_={}){return this.get("ungrouped_tables_summary",{params:_})}deliverConfirmationEmail(_){return this.post(`${_}/deliver_confirmation_email`,{}).pipe((0,a.k)(l=>this.mapItem(l)))}refoundPayment(_){return this.post(`${_}/refund_payment`,{}).pipe((0,a.k)(l=>this.mapItem(l)))}confirmPayment(_){return this.post(`${_}/record_deferred_payment`,{}).pipe((0,a.k)(l=>this.mapItem(l)))}refreshPaymentStatus(_){return this.post(`${_}/refresh_payment_status`,{}).pipe((0,a.k)(l=>this.mapItem(l)))}export(_){return new c._(l=>{this.get("export",{responseType:"blob",observe:"response",params:_}).pipe((0,u.a)(p=>(console.error("ReservationsService.export() error:",p),l.error(p),new c._))).subscribe(p=>{if(p instanceof R.WA&&p.body){const C=(0,T.k)(p.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",y=p.headers?.get("Content-Type")??"application/octet-stream",A=window.URL.createObjectURL(new Blob([p.body],{type:y})),f=document.createElement("a");f.href=A,f.download=C,f.click(),l.complete()}})})}static#e=this.\u0275fac=function(l){return new(l||E)};static#t=this.\u0275prov=h.wxM({token:E,factory:E.\u0275fac,providedIn:"root"})}return E})()}}]);