"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[1264],{1264:(ie,y,s)=>{s.d(y,{g:()=>te});var e=s(4496),p=s(668),C=s(6376),O=s(8896),D=s(8016),_=s(8212),f=s(7692),b=s(9052),v=s(1560),g=s(3480),I=s(1040),x=s(7760),N=s(9880),E=s(466),w=s(4336),d=s(6504),$=s(4152),S=s(1128),G=s(1368),c=s(3616),R=s(9144),A=s(2700),P=s(4e3),H=s(6684),u=s(8824),m=s(8256),k=s(2264);let L=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.a4G({type:i}),i.\u0275inj=e.s3X({}),i})();var h=s(3400);const j=(i,r)=>r.id;function B(i,r){if(1&i){const t=e.KQA();e.I0R(0,"div",11)(1,"span",12),e.aS0(2,13),e.C$Y(),e.I0R(3,"button",14),e.qCj("click",function(){e.usT(t);const o=e.GaO().$implicit,a=e.GaO(3);return e.CGJ(a.removeImage(o))}),e.SAx(4),e.aS0(5,15),e.k70(),e.C$Y()()}}const M=i=>({scale:i});function z(i,r){if(1&i){const t=e.KQA();e.I0R(0,"div",3)(1,"div",4)(2,"div",5)(3,"button",6)(4,"mat-icon"),e.OEk(5,"drag_indicator"),e.C$Y()(),e.I0R(6,"app-image-input",7),e.qCj("ngModelChange",function(o){const l=e.usT(t).$implicit,T=e.GaO(3);return e.CGJ(T.updateImage(o,l))}),e.C$Y()(),e.yuY(7,B,6,0,"ng-template",null,8,e.gJz),e.I0R(9,"div",5)(10,"tui-hosted-dropdown",9)(11,"button",10)(12,"mat-icon"),e.OEk(13,"delete"),e.C$Y()()()()()()}if(2&i){const t=r.$implicit,n=e.Gew(8),o=e.GaO(3);e.yG2(6),e.E7m("showBorder",!1)("cropperSettings",e.S45(5,M,4/3))("loading",o.savingImage())("ngModel",t),e.yG2(4),e.E7m("content",n)}}function F(i,r){if(1&i){const t=e.KQA();e.I0R(0,"div",2),e.qCj("cdkDropListDropped",function(o){e.usT(t);const a=e.GaO(2);return e.CGJ(a.drop(o))}),e.c53(1,z,14,7,"div",16,j),e.C$Y()}if(2&i){const t=e.GaO(2);e.yG2(),e.oho(t.images())}}function U(i,r){1&i&&(e.I0R(0,"p"),e.aS0(1,17),e.C$Y())}function Y(i,r){if(1&i&&(e.yuY(0,F,3,0,"div",1)(1,U,2,0),e.wR5(2,"app-image-input",0)),2&i){const t=e.GaO();e.C0Y(0,t.images().length>0?0:1),e.yG2(2),e.E7m("cropperSettings",e.S45(4,M,4/3))("loading",t.savingImage())("formControl",t.newImage)}}function W(i,r){if(1&i&&(e.I0R(0,"p",18),e.SAx(1),e.aS0(2,19),e.k70(),e.C$Y(),e.wR5(3,"pre",20),e.wVc(4,"json")),2&i){const t=e.GaO();e.yG2(3),e.E7m("innerText",e.kDX(4,1,t.contextData))}}let Q=(()=>{class i{constructor(t){this.context=t,this.destroy$=(0,e.uUt)(g.UF),this.service=(0,e.uUt)(x.U),this.notifications=(0,e.uUt)(S.E),this.newImage=new d.Ku(null),this.data=(0,e.OCB)(null),this.images=(0,e.S6b)(()=>this.data()?.items??[]),this.reordering=(0,e.OCB)(!1),this.removing=(0,e.OCB)(!1),this.savingImage=(0,e.OCB)(!1),this.loadingImages=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.loadingImages()||this.savingImage()||this.removing()||this.reordering()),this.contextData=this.context.data??null}ngOnInit(){this.loadImages(),this.newImage.valueChanges.pipe((0,c.a)(this.destroy$),(0,R.a)(()=>(0,A.of)(null)),(0,P.a)(),(0,H.I)(t=>null!=t)).subscribe({next:()=>this.saveNewImage()})}drop(t){let n=this.images();if((0,h.qv)(n,t.previousIndex,t.currentIndex),!(this.contextData&&this.contextData.record_type&&this.contextData.record_id))return;this.reorderSub?.unsubscribe();const o=this.images().map(a=>a.id).filter(a=>"number"==typeof a&&Number(a)>0);this.reordering.set(!0),this.reorderSub=this.service.updateRecord(this.contextData,o).pipe((0,c.a)(this.destroy$),(0,u.U)(()=>this.reordering.set(!1))).subscribe({next:()=>{this.loadImages()},error:a=>{this.notifications.error((0,m.mk)(a)||"Something went wrong.")}})}updateImage(t,n){if(!(t instanceof Blob&&n instanceof k.W&&n.id))return void this.notifications.error();const o=new FormData;o.append("image",t),this.savingImage.set(!0),this.service.update(n.id,o).pipe((0,c.a)(this.destroy$),(0,u.U)(()=>this.savingImage.set(!1))).subscribe({next:()=>this.loadImages(),error:a=>this.notifications.error((0,m.mk)(a))})}removeImage(t){const n=t.id;n&&n>0&&this.contextData&&this.contextData.record_type&&this.contextData.record_id&&(this.removeSub?.unsubscribe(),this.removing.set(!0),this.removeSub=this.service.removeFromRecord(n,this.contextData).pipe((0,c.a)(this.destroy$),(0,u.U)(()=>this.removing.set(!1))).subscribe({next:()=>{this.loadImages()},error:o=>{this.notifications.error((0,m.mk)(o)||"Something went wrong.")}}))}cancel(){this.context.completeWith(null)}saveNewImage(){this.uploadSub?.unsubscribe(),this.savingImage.set(!0),this.uploadSub=this.service.create(this.newImageFormData()).pipe((0,c.a)(this.destroy$),(0,u.U)(()=>this.savingImage.set(!1))).subscribe({next:t=>{this.newImage.setValue(null),this.loadImages()},error:t=>{this.notifications.error((0,m.mk)(t)||"Something went wrong.")}})}loadImages(){this.contextData&&this.contextData.record_type&&this.contextData.record_id&&(this.loadSub?.unsubscribe(),this.loadingImages.set(!0),this.service.search({record_type:this.contextData.record_type,record_id:this.contextData.record_id}).pipe((0,c.a)(this.destroy$),(0,u.U)(()=>this.loadingImages.set(!1))).subscribe({next:t=>{this.data.set(t)},error:t=>{this.notifications.error((0,m.mk)(t)||"Something went wrong.")}}))}newImageFormData(){if(!(this.contextData&&this.contextData.record_type&&this.contextData.record_id))throw new Error("Invalid context data.");if(!this.newImage.valid||!this.newImage.value)throw new Error("Invalid new image.");const t=new FormData;return t.append("image",this.newImage.value),t.append("record_type",this.contextData?.record_type),t.append("record_id",this.contextData?.record_id?.toString()),t}static#e=this.\u0275fac=function(n){return new(n||i)(e.GI1(I.C0))};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["app-images-edit-modal"]],standalone:!0,features:[e.M5G([g.UF]),e.UHJ],decls:2,vars:1,consts:()=>{let t,n,o,a;return t="Are you sure you want to remove this image?",n="Remove image",o="No image.",a="Something went wrong. Please try again later.",[[3,"cropperSettings","loading","formControl"],["cdkDropList","","class","example-list mb-5"],["cdkDropList","",1,"example-list","mb-5",3,"cdkDropListDropped"],["cdkDrag","",1,"mb-3","p-3"],[1,"flex","justify-between","items-center"],[1,"flex","items-center"],["cdkDragHandle","","tuiIconButton","","appearance","icon","size","m","type","button"],[3,"showBorder","cropperSettings","loading","ngModel","ngModelChange"],["removeImageContent",""],[3,"content"],["type","button","tuiIconButton","","appearance","icon"],[1,"p-3"],[1,"block","mb-2","text-lg"],t,["type","button","appearance","secondary-destructive","size","m","tuiButton","",3,"click"],n,["cdkDrag","","class","mb-3 p-3"],o,[1,"text-red"],a,[3,"innerText"]]},template:function(n,o){1&n&&e.yuY(0,Y,3,6,"app-image-input",0)(1,W,5,3),2&n&&e.C0Y(0,o.contextData&&o.contextData.record_type&&o.contextData.record_id?0:1)},dependencies:[$.c,d.sl,d.ue,d.ug,N.kh,_.CI,_.Kw,G.ED,f.Sk,L,v.qL,h.Cm,h.w5,h.A3,E.GE,E.Qw,w.A$,d.y,d._G],styles:[".example-list[_ngcontent-%COMP%]{width:500px;max-width:100%;border:solid 1px #ccc;min-height:60px;display:block;background:#fff;border-radius:4px;overflow:hidden}.example-box[_ngcontent-%COMP%]{padding:20px 10px;border-bottom:solid 1px #ccc;color:#000000de;display:flex;flex-direction:row;align-items:center;justify-content:space-between;box-sizing:border-box;cursor:move;background:#fff;font-size:14px}.cdk-drag-preview[_ngcontent-%COMP%]{box-sizing:border-box;border-radius:4px;box-shadow:0 5px 5px -3px #0003,0 8px 10px 1px #00000024,0 3px 14px 2px #0000001f}.cdk-drag-placeholder[_ngcontent-%COMP%]{opacity:0}.cdk-drag-animating[_ngcontent-%COMP%]{transition:transform .25s cubic-bezier(0,0,.2,1)}.example-box[_ngcontent-%COMP%]:last-child{border:none}.example-list.cdk-drop-list-dragging[_ngcontent-%COMP%]   .example-box[_ngcontent-%COMP%]:not(.cdk-drag-placeholder){transition:transform .25s cubic-bezier(0,0,.2,1)}"],changeDetection:0})}return i})();var J=s(1588);function X(i,r){if(1&i){const t=e.KQA();e.I0R(0,"tui-island",10),e.qCj("click",function(){e.usT(t);const o=e.GaO(3);return e.CGJ(o.showDetails())}),e.wR5(1,"app-show-image",11),e.C$Y()}if(2&i){const t=e.GaO().$implicit;e.yG2(),e.E7m("image",t)}}function K(i,r){1&i&&e.yuY(0,X,2,1,"tui-island",9)}function V(i,r){if(1&i){const t=e.KQA();e.I0R(0,"tui-island",13),e.qCj("click",function(){e.usT(t);const o=e.GaO(3);return e.CGJ(o.showDetails())}),e.wR5(1,"app-show-image",11),e.C$Y()}2&i&&(e.yG2(),e.E7m("image",null))}function Z(i,r){1&i&&e.yuY(0,V,2,1,"tui-island",12)}function q(i,r){if(1&i){const t=e.KQA();e.I0R(0,"div",0)(1,"button",1),e.qCj("click",function(){e.usT(t);const o=e.Gew(3);return e.CGJ(o.prev())}),e.C$Y(),e.I0R(2,"tui-carousel",2,3),e.qCj("indexChange",function(o){e.usT(t);const a=e.GaO();return e.CGJ(a.cIndex.set(o))}),e.c53(4,K,1,0,"tui-island",14,e.oxv,!1,Z,1,0,"tui-island",15),e.C$Y(),e.I0R(7,"button",4),e.qCj("click",function(){e.usT(t);const o=e.Gew(3);return e.CGJ(o.next())}),e.C$Y()(),e.I0R(8,"button",5),e.qCj("click",function(){e.usT(t);const o=e.GaO();return e.CGJ(o.showDetails())}),e.I0R(9,"span",6)(10,"mat-icon",7),e.OEk(11,"edit"),e.C$Y(),e.I0R(12,"span"),e.aS0(13,8),e.C$Y()()()}if(2&i){const t=e.GaO();e.yG2(),e.E7m("disabled",0===t.cIndex()),e.yG2(),e.E7m("index",t.cIndex()),e.yG2(2),e.oho(t.images),e.yG2(3),e.E7m("disabled",0==t.images.length||t.cIndex()===t.images.length-1)}}function ee(i,r){1&i&&e.wR5(0,"tui-loader",16),2&i&&e.E7m("showLoader",!0)}let te=(()=>{class i{constructor(){this.dialogs=(0,e.uUt)(D._k),this.injector=(0,e.uUt)(e.zZn),this.service=(0,e.uUt)(x.U),this.destroy$=(0,e.uUt)(g.UF),this.notifications=(0,e.uUt)(S.E),this.cd=(0,e.uUt)(e.kD9),this.loadingImages=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.loadingImages()),this.images=[],this.cIndex=(0,e.OCB)(0)}showDetails(){this.dialogs.open(new I.WO(Q,this.injector),{data:{record_type:this.recordType,record_id:this.recordId},dismissible:!0,closeable:!0,label:"Edit images"}).subscribe({next:t=>{console.log("next with data",t),this.reloadImages()},error:t=>{this.reloadImages(),console.warn("completed with error",t)},complete:()=>{console.log("complete with data"),this.reloadImages()}})}reloadImages(){this.recordType&&this.recordId?(this.loadingImages.set(!0),this.service.search({record_type:this.recordType,record_id:this.recordId}).pipe((0,c.a)(this.destroy$),(0,u.U)(()=>this.loadingImages.set(!1))).subscribe({next:t=>{this.images=t.items,this.cd.markForCheck()},error:t=>{this.notifications.error((0,m.mk)(t))}})):this.notifications.error()}static#e=this.\u0275fac=function(n){return new(n||i)};static#t=this.\u0275cmp=e.In1({type:i,selectors:[["app-show-images"]],inputs:{images:"images",recordType:"recordType",recordId:"recordId"},standalone:!0,features:[e.M5G([g.UF]),e.UHJ],decls:2,vars:1,consts:()=>{let t;return t="Edit images",[["tuiCarouselButtons","",1,"flex","items-center","mb-2"],["icon","tuiIconChevronLeftLarge","title","Previous","size","s","tuiIconButton","","type","button",3,"disabled","click"],[1,"max-w-[150px]",3,"index","indexChange"],["carousel",""],["icon","tuiIconChevronRightLarge","size","s","title","Next","tuiIconButton","","type","button",3,"disabled","click"],["type","button","tuiButton","","appearance","flat","size","m",3,"click"],[1,"flex","items-center"],[1,"me-1"],t,["class","cursor-pointer",3,"click",4,"tuiItem"],[1,"cursor-pointer",3,"click"],[2,"max-width","100px",3,"image"],["class","!flex cursor-pointer items-center justify-center",3,"click",4,"tuiItem"],[1,"!flex","cursor-pointer","items-center","justify-center",3,"click"],["class","cursor-pointer"],["class","!flex cursor-pointer items-center justify-center"],[3,"showLoader"]]},template:function(n,o){1&n&&e.yuY(0,q,14,4)(1,ee,1,1),2&n&&e.C0Y(0,o.images?0:o.loading()?1:-1)},dependencies:[p.uG,p.iy,p.Ep,p.a2,J.S,_.CI,_.Kw,C.k,C.C,f.Sk,f.Cb,O.g,b.y,v.qL],encapsulation:2,changeDetection:0})}return i})()}}]);