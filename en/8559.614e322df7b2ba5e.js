"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[8559],{9722:(y,m,r)=>{r.d(m,{t:()=>W});var u=r(1368),t=r(4496),d=r(6504),l=r(2516),_=r(7556),a=r(3480),p=r(6732),h=r(7692),M=r(466),$=r(5193),S=r(1673),O=r(8212),D=r(6528),i=r(3616),c=r(8824),g=r(4704),C=r(9144),P=r(2700);let w=(()=>{class s{transform(e){return o=>o?.dayOfWeek(!1)!=e}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275pipe=t.UTH({name:"tuiWeekdayHandler",type:s,pure:!0,standalone:!0})}return s})();var x=r(964),I=r(400);let F=(()=>{class s{transform(e){return e instanceof Date?e:e instanceof I.EK?e.toUtcNativeDate():null}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275pipe=t.UTH({name:"fromTuiDay",type:s,pure:!0,standalone:!0})}return s})();const G=(s,f)=>f.id,R=()=>[];function Y(s,f){if(1&s){const e=t.KQA();t.I0R(0,"tui-calendar",11),t.qCj("dayClick",function(n){t.usT(e);const T=t.GaO(3).$implicit,E=t.GaO(2);return t.CGJ(E.triggerDate(T.id,n))}),t.wVc(1,"tuiWeekdayHandler"),t.C$Y()}if(2&s){const e=t.GaO().tuiLet,o=t.GaO(2).$implicit;let n;t.E7m("disabledItemHandler",t.kDX(1,2,o.weekday))("value",null!==(n=e)&&void 0!==n?n:t.q4q(4,R))}}function k(s,f){if(1&s&&(t.I0R(0,"span",13),t.OEk(1),t.wVc(2,"date"),t.wVc(3,"fromTuiDay"),t.C$Y()),2&s){const e=f.$implicit;t.yG2(),t.cNF(t.g7$(2,1,t.kDX(3,4,e),"d MMMM y"))}}function L(s,f){1&s&&(t.I0R(0,"span",14),t.aS0(1,15),t.C$Y())}function A(s,f){if(1&s&&(t.I0R(0,"tui-hosted-dropdown",12)(1,"button",16),t.SAx(2),t.aS0(3,17),t.k70(),t.C$Y()()),2&s){t.GaO(2);const e=t.Gew(2);t.E7m("content",e)}}function b(s,f){if(1&s&&(t.I0R(0,"div",5),t.c53(1,k,4,6,"span",18,t.oxv,!1,L,2,0,"span",19),t.yuY(4,A,4,1,"tui-hosted-dropdown",12),t.C$Y()),2&s){const e=t.GaO().tuiLet,o=t.GaO(4);let n;t.yG2(),t.oho(null!==(n=e)&&void 0!==n?n:t.q4q(2,R)),t.yG2(3),t.C0Y(4,o.editable?4:-1)}}function z(s,f){if(1&s){const e=t.KQA();t.SAx(0),t.yuY(1,Y,2,5,"ng-template",null,7,t.gJz),t.I0R(3,"div",8)(4,"tui-checkbox-block",9),t.qCj("ngModelChange",function(){t.usT(e);const n=t.GaO(2).$implicit,T=t.GaO(2);return t.CGJ(T.triggerSelection(n.id))}),t.OEk(5),t.C$Y(),t.yuY(6,b,5,3,"div",10),t.C$Y(),t.k70()}if(2&s){const e=f.tuiLet,o=t.GaO(2).$implicit,n=t.GaO(2);t.yG2(4),t.E7m("readOnly",!n.editable)("ngModel",void 0!==e),t.yG2(),t.oRS(" ",o.name," "),t.yG2(),t.C0Y(6,null!=e?6:-1)}}function K(s,f){if(1&s&&t.yuY(0,z,7,4,"ng-container",6),2&s){const e=t.GaO().$implicit,o=t.GaO(2);t.E7m("tuiLet",o.selections()[e.id])}}function H(s,f){1&s&&t.yuY(0,K,1,1,"ng-container"),2&s&&t.C0Y(0,f.$implicit.id?0:-1)}function B(s,f){if(1&s&&(t.I0R(0,"tr",2)(1,"td",3)(2,"p",4),t.OEk(3),t.wVc(4,"weekday"),t.C$Y()(),t.I0R(5,"td",3)(6,"div",5),t.c53(7,H,1,1,null,null,G),t.C$Y()()()),2&s){const e=f.$implicit,o=t.GaO();t.yG2(3),t.cNF(t.kDX(4,1,e)),t.yG2(4),t.oho(o.turnsPerDay()[e])}}let W=(()=>{class s{constructor(){this.turnsService=(0,t.uUt)(_.K),this.destroy$=(0,t.uUt)(a.UF),this.date=(0,t.uUt)(u.y),this.outputMamiChanges=new t._w7,this.loading=(0,t.OCB)(!1),this.selections=(0,t.OCB)({}),this.editable$=(0,t.OCB)(!1),this.allTurns=(0,t.OCB)([]),this.turnsPerDay=(0,t.S6b)(()=>{const e=this.allTurns().filter(n=>null!=n.weekday),o={};for(const n of e){if(null==n.weekday||null==n.weekday)throw new Error("Turns must have a weekday");(this.editable$()||n.id&&Object.keys(this.selections()).includes(n.id.toString()))&&(o[n.weekday]||=[],o[n.weekday].push(n))}return o}),this.weekdays=(0,t.S6b)(()=>Object.keys(this.turnsPerDay()).map(Number)),this.lastOutput=null}set turns(e){this.selections.update(o=>(e.forEach(n=>{if(!n.id)throw new Error("Turn id is missing");o[n.id]||=[]}),o))}set dates(e){this.selections.update(o=>(e.forEach(n=>{if(!n.reservation_turn_id)throw new Error("Turn id is missing");if(!n.date)throw new Error("Date is missing or invalid",n.date);o[n.reservation_turn_id]||=[],o[n.reservation_turn_id].push((0,x._0)(n.date))}),o))}set editable(e){this.editable$.set(e)}get editable(){return this.editable$()}set item(e){this.selections.set({}),this.turns=e?.turns??[],this.dates=e?.dates??[]}ngOnInit(){this.searchTurns()}triggerSelection(e){this.selections.update(o=>(e in o?delete o[e]:o[e]=[],o)),this.emitChanges()}triggerDate(e,o){if(!e)throw new Error("Invalid turn id"+e);if(!o)throw new Error("Invalid day"+o);this.selections.update(n=>{n[e]||=[];const T=n[e].findIndex(E=>E.day===o.day);return-1===T?n[e].push(o):n[e].splice(T,1),n[e]=n[e].sort((E,v)=>E.dayAfter(v)?1:-1),n}),this.emitChanges()}emitChanges(){const e=[],o=[],n=this.selections();Object.keys(n).forEach(E=>{const v=parseInt(E);if(0===n[v].length)o.push(v);else for(const N of n[v]){const U=this.date.transform(N.toUtcNativeDate(),"yyyy-MM-dd");U?e.push({turn_id:v,date:U}):console.error("Invalid date",N)}});const T={dates:e,turns:o};(null===this.lastOutput||JSON.stringify(this.lastOutput)!==JSON.stringify(T))&&this.outputMamiChanges.emit(T)}searchTurns(){this.loading.set(!0),this.turnsService.search({per_page:1e3}).pipe((0,i.a)(this.destroy$),(0,c.U)(()=>this.loading.set(!1)),(0,g.k)(e=>e.items),(0,C.a)(e=>(console.error(e),(0,P.of)([])))).subscribe({next:e=>{this.allTurns.set(e)}})}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275cmp=t.In1({type:s,selectors:[["app-select-turns-paymentv2"]],inputs:{turns:"turns",dates:"dates",editable:"editable",item:"item"},outputs:{outputMamiChanges:"outputMamiChanges"},standalone:!0,features:[t.M5G([a.UF]),t.UHJ],decls:5,vars:2,consts:()=>{let e,o;return e="Always",o="Change dates",[["size","xl",3,"overlay","showLoader"],[1,"tui-table"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__td"],[1,"text-xl"],[1,"flex","flex-col"],[4,"tuiLet"],["selectDatesTemplate",""],[1,"flex","flex-row","items-center","mb-5"],[1,"me-1",3,"readOnly","ngModel","ngModelChange"],["class","flex flex-col"],["tuiPreventDefault","mousedown",3,"disabledItemHandler","value","dayClick"],[3,"content"],[1,"mx-2","mb-1"],[1,"text-xl","text-green-500"],e,["tuiButton","","tuiHint","Modifica date","appearance","outline","size","s","type","button"],o,["class","mx-2 mb-1"],["class","text-xl text-green-500"],["class","tui-table__tr tui-table__tr_border_none"]]},template:function(o,n){1&o&&(t.I0R(0,"tui-loader",0)(1,"table",1)(2,"tbody"),t.c53(3,B,9,3,"tr",20,t.oxv),t.C$Y()()()),2&o&&(t.E7m("overlay",!0)("showLoader",n.loading()),t.yG2(3),t.oho(n.weekdays()))},dependencies:[l.G,D.i,D.I,d.y,d.ue,d._G,h.Sk,h.Cb,u.y,M.GE,M.Qw,w,$.ms,S.y,S.I,O.CI,O.Kw,p.kR,p.ew,F],changeDetection:0})}return s})()},9772:(y,m,r)=>{r.d(m,{CU:()=>t,ye:()=>d});const u=(new Date).getTimezoneOffset()/60;function t(l,_=u){return"string"==typeof l&&l.length>0&&l.match(/\d{1,2}:\d{1,2}/)?`${Number(l.split(":")[0])-_}:${l.split(":")[1]}`:(console.error("Invalid string provided to strTimeTimezone",{string:l}),"")}function d(l,_=u){return t(l,-1*_)}},964:(y,m,r)=>{r.d(m,{Ez:()=>h,In:()=>S,Q1:()=>D,Q9:()=>$,QX:()=>a,Qx:()=>d,_0:()=>O,ay:()=>l,e6:()=>t,yc:()=>_});var u=r(400);const t=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function d(i,c){return new Date(`${i.formattedYear}-${i.formattedMonthPart}-${i.formattedDayPart} ${c.toString()}`).toISOString()}function l(i){if(!("string"==typeof i&&i.length>0&&i.match(t)))return console.error("Invalid string provided to isoStringToTuiDay",{isoString:i}),null;const c=new Date(i);return new u.EK(c.getFullYear(),c.getMonth()+1,c.getDate())}function _(i){if("string"==typeof i&&i.length>0&&i.match(/^\d{4}-\d{1,2}-\d{1,2}\s{1}00:00$/)&&(i=i.split(" ")[0]),!("string"==typeof i&&i.length>0&&i.match(/^\d{4}-\d{1,2}-\d{1,2}$/)))return console.error("Invalid string provided to stringToTuiDay. Expected format YYYY-MM-DD, got",{str:i}),null;const{day:c,month:g,year:C}=u.EK.parseRawDateString(i,"YMD");return new u.EK(C,g,c)}function a(i){if(!("string"==typeof i&&i.length>0&&i.match(t)))return console.error("Invalid string provided to isoStringToTuiTime",{isoString:i}),null;const c=new Date(i);return new u.uc(c.getHours(),c.getMinutes())}function h(i){return new Date(`1970-01-01 ${i.toString()}`).toISOString()}function $(i){const c=new Date(`${i}Z`);return`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")} ${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}`}function S(i){return function M(i){const c=new Date(`1970-01-01 ${i}`);return`${`${c.getUTCHours()}`.padStart(2,"0")}:${`${c.getUTCMinutes()}`.padStart(2,"0")}`}(i.toString())}function O(i){return new u.EK(i.getFullYear(),i.getMonth(),i.getDate())}function D(i){return new u.uc(i.getHours(),i.getMinutes())}},1960:(y,m,r)=>{r.d(m,{u:()=>l});var u=r(8400),t=r(5136);class d extends u.w{constructor(a){super(a),this.date=a.date?new Date(a.date):void 0,this.reservation_turn_id=a.reservation_turn_id,this.group_id=a.group_id,this.reservation_turn=a.reservation_turn?new t.e(a.reservation_turn):void 0}}class l extends u.w{constructor(a){super(a),this.turns=[],this.dates=[],this.title=a.title,this.status=a.status,this.preorder_type=a.preorder_type,this.payment_value=a.payment_value,this.message=a.message,this.turns=(a.turns||[]).map(p=>new t.e(p)),this.dates=(a.dates||[]).map(p=>new d(p))}}},5136:(y,m,r)=>{r.d(m,{e:()=>l});var u=r(8400),t=r(9772),d=r(1960);class l extends u.w{constructor(a){super(a),this.name=a.name,this.weekday=a.weekday,this.step=a.step,this.valid_times=a.valid_times,this.starts_at=a.starts_at?(0,t.CU)(a.starts_at):void 0,this.ends_at=a.ends_at?(0,t.CU)(a.ends_at):void 0,this.preorder_reservation_group=a.preorder_reservation_group?new d.u(a.preorder_reservation_group):void 0}}},2516:(y,m,r)=>{r.d(m,{G:()=>t});var u=r(4496);let t=(()=>{class d{constructor(){this.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}transform(_){return"number"!=typeof _&&"string"==typeof _&&(_=parseInt(_)),"number"==typeof _&&_>=0&&_<=6?this.weekdays[_]:null}static#t=this.\u0275fac=function(a){return new(a||d)};static#e=this.\u0275pipe=u.UTH({name:"weekday",type:d,pure:!0,standalone:!0})}return d})()},4251:(y,m,r)=>{r.d(m,{e:()=>l});var u=r(6012),t=r(1960),d=r(4496);let l=(()=>{class _ extends u.s{constructor(){super(t.u,"admin/preorder_reservation_groups")}static#t=this.\u0275fac=function(h){return new(h||_)};static#e=this.\u0275prov=d.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},7556:(y,m,r)=>{r.d(m,{K:()=>l});var u=r(6012),t=r(5136),d=r(4496);let l=(()=>{class _ extends u.s{constructor(){super(t.e,"admin/reservation_turns")}static#t=this.\u0275fac=function(h){return new(h||_)};static#e=this.\u0275prov=d.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()}}]);