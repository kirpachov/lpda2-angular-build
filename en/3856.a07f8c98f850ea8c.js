"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[3856],{7748:(h,d,n)=>{n.d(d,{c:()=>_});var c=n(6404),t=n(5656),a=n(4496);function l(i,m){if(1&i&&(a.I0R(0,"span",0),a.OEk(1),a.C$Y()),2&i){const u=a.GaO();a.E7m("tuiHint",u.trans[u.type].long),a.yG2(),a.cNF(u.trans[u.type].short)}}let _=(()=>{class i{constructor(){this.trans={nexi_payment:{short:"Payment CC with nexi",long:"\n           A payment with a credit card of the specified amount will be required\n          at the time of booking. \n        "},nexi_authorization:{short:"Authorization cc with nexi",long:"\n           A credit card authorization in the specified amount will be required\n          at the time of booking. \n        "}}}set item(u){u&&!(0,c.ch)(u)&&console.warn("Invalid preorder type:",u),this.type=u?.preorder_type}static#t=this.\u0275fac=function(y){return new(y||i)};static#e=this.\u0275cmp=a.In1({type:i,selectors:[["app-preorder-reservation-group-preorder-type"]],inputs:{item:"item",type:"type"},standalone:!0,features:[a.UHJ],decls:1,vars:1,consts:[[3,"tuiHint"]],template:function(y,T){1&y&&a.yuY(0,l,2,2,"span",0),2&y&&a.C0Y(0,T.type&&T.trans[T.type]?0:-1)},dependencies:[t.WY,t.lh,t.SL,t.i6,t.IT],encapsulation:2,changeDetection:0})}return i})()},1744:(h,d,n)=>{n.d(d,{t:()=>H});var c=n(1368),t=n(4496),a=n(6504),l=n(2516),_=n(7556),i=n(3480),m=n(6732),u=n(7692),y=n(466),T=n(5193),g=n(1673),v=n(8212),O=n(6528),D=n(3616),R=n(8824),x=n(4704),$=n(9144),G=n(2700);let N=(()=>{class s{transform(e){return r=>r?.dayOfWeek(!1)!=e}static#t=this.\u0275fac=function(r){return new(r||s)};static#e=this.\u0275pipe=t.UTH({name:"tuiWeekdayHandler",type:s,pure:!0,standalone:!0})}return s})();var w=n(964),U=n(9160);let I=(()=>{class s{transform(e,r){return!(!e||!r)&&e.getTime()>r.getTime()}static#t=this.\u0275fac=function(r){return new(r||s)};static#e=this.\u0275pipe=t.UTH({name:"dateAfter",type:s,pure:!0,standalone:!0})}return s})();const F=(s,p)=>p.id,M=()=>[];function A(s,p){if(1&s){const e=t.KQA();t.I0R(0,"tui-calendar",11),t.qCj("dayClick",function(o){t.usT(e);const f=t.GaO(3).$implicit,C=t.GaO(2);return t.CGJ(C.triggerDate(f.id,o))}),t.wVc(1,"tuiWeekdayHandler"),t.C$Y()}if(2&s){const e=t.GaO().tuiLet,r=t.GaO(2).$implicit;let o;t.E7m("disabledItemHandler",t.kDX(1,2,r.weekday))("value",null!==(o=e)&&void 0!==o?o:t.q4q(4,M))}}const L=s=>({"text-slate-400":s});function k(s,p){if(1&s&&(t.I0R(0,"span",13),t.wVc(1,"dateAfter"),t.wVc(2,"fromTuiDay"),t.OEk(3),t.wVc(4,"date"),t.wVc(5,"fromTuiDay"),t.C$Y()),2&s){const e=p.$implicit,r=t.GaO(6);t.E7m("ngClass",t.S45(12,L,!t.g7$(1,2,t.kDX(2,5,e),r.today))),t.yG2(3),t.cNF(t.g7$(4,7,t.kDX(5,10,e),"d MMMM y"))}}function Y(s,p){1&s&&(t.I0R(0,"span",14),t.aS0(1,15),t.C$Y())}function z(s,p){if(1&s&&(t.I0R(0,"tui-hosted-dropdown",12)(1,"button",16),t.SAx(2),t.aS0(3,17),t.k70(),t.C$Y()()),2&s){t.GaO(2);const e=t.Gew(2);t.E7m("content",e)}}function b(s,p){if(1&s&&(t.I0R(0,"div",5),t.c53(1,k,6,14,"span",18,t.oxv,!1,Y,2,0,"span",19),t.yuY(4,z,4,1,"tui-hosted-dropdown",12),t.C$Y()),2&s){const e=t.GaO().tuiLet,r=t.GaO(4);let o;t.yG2(),t.oho(null!==(o=e)&&void 0!==o?o:t.q4q(2,M)),t.yG2(3),t.C0Y(4,r.editable?4:-1)}}function K(s,p){if(1&s){const e=t.KQA();t.SAx(0),t.yuY(1,A,2,5,"ng-template",null,7,t.gJz),t.I0R(3,"div",8)(4,"tui-checkbox-block",9),t.qCj("ngModelChange",function(){t.usT(e);const o=t.GaO(2).$implicit,f=t.GaO(2);return t.CGJ(f.triggerSelection(o.id))}),t.OEk(5),t.C$Y(),t.yuY(6,b,5,3,"div",10),t.C$Y(),t.k70()}if(2&s){const e=p.tuiLet,r=t.GaO(2).$implicit,o=t.GaO(2);t.yG2(4),t.E7m("readOnly",!o.editable)("ngModel",void 0!==e),t.yG2(),t.oRS(" ",r.name," "),t.yG2(),t.C0Y(6,null!=e?6:-1)}}function W(s,p){if(1&s&&t.yuY(0,K,7,4,"ng-container",6),2&s){const e=t.GaO().$implicit,r=t.GaO(2);t.E7m("tuiLet",r.selections()[e.id])}}function B(s,p){1&s&&t.yuY(0,W,1,1,"ng-container"),2&s&&t.C0Y(0,p.$implicit.id?0:-1)}function V(s,p){if(1&s&&(t.I0R(0,"tr",2)(1,"td",3)(2,"p",4),t.OEk(3),t.wVc(4,"weekday"),t.C$Y()(),t.I0R(5,"td",3)(6,"div",5),t.c53(7,B,1,1,null,null,F),t.C$Y()()()),2&s){const e=p.$implicit,r=t.GaO();t.yG2(3),t.cNF(t.kDX(4,1,e)),t.yG2(4),t.oho(r.turnsPerDay()[e])}}let H=(()=>{class s{constructor(){this.turnsService=(0,t.uUt)(_.K),this.destroy$=(0,t.uUt)(i.UF),this.date=(0,t.uUt)(c.y),this.outputMamiChanges=new t._w7,this.loading=(0,t.OCB)(!1),this.selections=(0,t.OCB)({}),this.today=new Date,this.editable$=(0,t.OCB)(!1),this.allTurns=(0,t.OCB)([]),this.turnsPerDay=(0,t.S6b)(()=>{const e=this.allTurns().filter(o=>null!=o.weekday),r={};for(const o of e){if(null==o.weekday||null==o.weekday)throw new Error("Turns must have a weekday");(this.editable$()||o.id&&Object.keys(this.selections()).includes(o.id.toString()))&&(r[o.weekday]||=[],r[o.weekday].push(o))}return r}),this.weekdays=(0,t.S6b)(()=>Object.keys(this.turnsPerDay()).map(Number)),this.lastOutput=null}set turns(e){this.selections.update(r=>(e.forEach(o=>{if(!o.id)throw new Error("Turn id is missing");r[o.id]||=[]}),r))}set dates(e){this.selections.update(r=>(e.forEach(o=>{if(!o.reservation_turn_id)throw new Error("Turn id is missing");if(!o.date)throw new Error("Date is missing or invalid",o.date);r[o.reservation_turn_id]||=[],r[o.reservation_turn_id].push((0,w._0)(o.date))}),r))}set editable(e){this.editable$.set(e)}get editable(){return this.editable$()}set item(e){this.selections.set({}),this.turns=e?.turns??[],this.dates=e?.dates??[]}ngOnInit(){this.searchTurns()}triggerSelection(e){this.selections.update(r=>(e in r?delete r[e]:r[e]=[],r)),this.emitChanges()}triggerDate(e,r){if(!e)throw new Error("Invalid turn id"+e);if(!r)throw new Error("Invalid day"+r);this.selections.update(o=>{o[e]||=[];const f=o[e].findIndex(C=>C.day===r.day);return-1===f?o[e].push(r):o[e].splice(f,1),o[e]=o[e].sort((C,E)=>C.dayAfter(E)?1:-1),o}),this.emitChanges()}emitChanges(){const e=[],r=[],o=this.selections();Object.keys(o).forEach(C=>{const E=parseInt(C);if(0===o[E].length)r.push(E);else for(const P of o[E]){const S=this.date.transform(P.toUtcNativeDate(),"yyyy-MM-dd");S?e.push({turn_id:E,date:S}):console.error("Invalid date",P)}});const f={dates:e,turns:r};(null===this.lastOutput||JSON.stringify(this.lastOutput)!==JSON.stringify(f))&&this.outputMamiChanges.emit(f)}searchTurns(){this.loading.set(!0),this.turnsService.search({per_page:1e3}).pipe((0,D.a)(this.destroy$),(0,R.U)(()=>this.loading.set(!1)),(0,x.k)(e=>e.items),(0,$.a)(e=>(console.error(e),(0,G.of)([])))).subscribe({next:e=>{this.allTurns.set(e)}})}static#t=this.\u0275fac=function(r){return new(r||s)};static#e=this.\u0275cmp=t.In1({type:s,selectors:[["app-select-turns-paymentv2"]],inputs:{turns:"turns",dates:"dates",editable:"editable",item:"item"},outputs:{outputMamiChanges:"outputMamiChanges"},standalone:!0,features:[t.M5G([i.UF]),t.UHJ],decls:5,vars:2,consts:()=>{let e,r;return e="Always",r="Change dates",[["size","xl",3,"overlay","showLoader"],[1,"tui-table"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__td"],[1,"text-xl"],[1,"flex","flex-col"],[4,"tuiLet"],["selectDatesTemplate",""],[1,"flex","flex-row","items-center","mb-5"],[1,"me-1",3,"readOnly","ngModel","ngModelChange"],["class","flex flex-col"],["tuiPreventDefault","mousedown",3,"disabledItemHandler","value","dayClick"],[3,"content"],[1,"mx-2","mb-1",3,"ngClass"],[1,"text-xl","text-green-500"],e,["tuiButton","","tuiHint","Modifica date","appearance","outline","size","s","type","button"],r,["class","mx-2 mb-1",3,"ngClass"],["class","text-xl text-green-500"],["class","tui-table__tr tui-table__tr_border_none"]]},template:function(r,o){1&r&&(t.I0R(0,"tui-loader",0)(1,"table",1)(2,"tbody"),t.c53(3,V,9,3,"tr",20,t.oxv),t.C$Y()()()),2&r&&(t.E7m("overlay",!0)("showLoader",o.loading()),t.yG2(3),t.oho(o.weekdays()))},dependencies:[l.G,O.i,O.I,a.y,a.ue,a._G,u.Sk,u.Cb,c.y,y.GE,y.Qw,N,T.ms,g.y,g.I,v.CI,v.Kw,m.kR,m.ew,U.E,c.QF,I],changeDetection:0})}return s})()},6404:(h,d,n)=>{n.d(d,{ch:()=>a,i4:()=>t});const t=["nexi_payment","nexi_authorization"];function a(l){return t.includes(l)}},1960:(h,d,n)=>{n.d(d,{u:()=>l});var c=n(8400),t=n(5136);class a extends c.w{constructor(i){super(i),this.date=i.date?new Date(i.date):void 0,this.reservation_turn_id=i.reservation_turn_id,this.group_id=i.group_id,this.reservation_turn=i.reservation_turn?new t.e(i.reservation_turn):void 0}}class l extends c.w{constructor(i){super(i),this.turns=[],this.dates=[],this.title=i.title,this.status=i.status,this.preorder_type=i.preorder_type,this.payment_value=i.payment_value,this.message=i.message,this.turns=(i.turns||[]).map(m=>new t.e(m)),this.dates=(i.dates||[]).map(m=>new a(m)),this.translations=i.translations||{}}}},5136:(h,d,n)=>{n.d(d,{e:()=>l});var c=n(8400),t=n(9772),a=n(1960);class l extends c.w{constructor(i){super(i),this.messages=[],this.name=i.name,this.weekday=i.weekday,this.step=i.step,this.valid_times=i.valid_times,this.starts_at=i.starts_at?(0,t.CU)(i.starts_at):void 0,this.ends_at=i.ends_at?(0,t.CU)(i.ends_at):void 0,this.preorder_reservation_group=i.preorder_reservation_group?new a.u(i.preorder_reservation_group):void 0,this.messages=i.messages}}},9160:(h,d,n)=>{n.d(d,{E:()=>a});var c=n(400),t=n(4496);let a=(()=>{class l{transform(i){return i instanceof Date?i:i instanceof c.EK?i.toUtcNativeDate():null}static#t=this.\u0275fac=function(m){return new(m||l)};static#e=this.\u0275pipe=t.UTH({name:"fromTuiDay",type:l,pure:!0,standalone:!0})}return l})()},2516:(h,d,n)=>{n.d(d,{G:()=>t});var c=n(4496);let t=(()=>{class a{constructor(){this.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}transform(_){return"number"!=typeof _&&"string"==typeof _&&(_=parseInt(_)),"number"==typeof _&&_>=0&&_<=6?this.weekdays[_]:null}static#t=this.\u0275fac=function(i){return new(i||a)};static#e=this.\u0275pipe=c.UTH({name:"weekday",type:a,pure:!0,standalone:!0})}return a})()},4251:(h,d,n)=>{n.d(d,{e:()=>l});var c=n(6012),t=n(1960),a=n(4496);let l=(()=>{class _ extends c.s{constructor(){super(t.u,"admin/preorder_reservation_groups")}static#t=this.\u0275fac=function(u){return new(u||_)};static#e=this.\u0275prov=a.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()},7556:(h,d,n)=>{n.d(d,{K:()=>l});var c=n(6012),t=n(5136),a=n(4496);let l=(()=>{class _ extends c.s{constructor(){super(t.e,"admin/reservation_turns")}static#t=this.\u0275fac=function(u){return new(u||_)};static#e=this.\u0275prov=a.wxM({token:_,factory:_.\u0275fac,providedIn:"root"})}return _})()}}]);