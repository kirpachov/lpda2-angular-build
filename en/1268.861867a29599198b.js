"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[1268],{9332:(y,m,r)=>{r.d(m,{t:()=>X});var _=r(1368),t=r(4496),d=r(6504),l=r(2516),u=r(7556),a=r(3480),p=r(6732),h=r(7692),M=r(466),$=r(5193),S=r(1673),O=r(8212),D=r(6528),s=r(3616),c=r(8824),g=r(4704),C=r(9144),P=r(2700);let w=(()=>{class i{transform(e){return n=>n?.dayOfWeek(!1)!=e}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275pipe=t.UTH({name:"tuiWeekdayHandler",type:i,pure:!0,standalone:!0})}return i})();var x=r(964),I=r(400);let F=(()=>{class i{transform(e){return e instanceof Date?e:e instanceof I.EK?e.toUtcNativeDate():null}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275pipe=t.UTH({name:"fromTuiDay",type:i,pure:!0,standalone:!0})}return i})(),G=(()=>{class i{transform(e,n){return!(!e||!n)&&e.getTime()>n.getTime()}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275pipe=t.UTH({name:"dateAfter",type:i,pure:!0,standalone:!0})}return i})();const Y=(i,f)=>f.id,R=()=>[];function k(i,f){if(1&i){const e=t.KQA();t.I0R(0,"tui-calendar",11),t.qCj("dayClick",function(o){t.usT(e);const T=t.GaO(3).$implicit,E=t.GaO(2);return t.CGJ(E.triggerDate(T.id,o))}),t.wVc(1,"tuiWeekdayHandler"),t.C$Y()}if(2&i){const e=t.GaO().tuiLet,n=t.GaO(2).$implicit;let o;t.E7m("disabledItemHandler",t.kDX(1,2,n.weekday))("value",null!==(o=e)&&void 0!==o?o:t.q4q(4,R))}}const A=i=>({"text-slate-400":i});function L(i,f){if(1&i&&(t.I0R(0,"span",13),t.wVc(1,"dateAfter"),t.wVc(2,"fromTuiDay"),t.OEk(3),t.wVc(4,"date"),t.wVc(5,"fromTuiDay"),t.C$Y()),2&i){const e=f.$implicit,n=t.GaO(6);t.E7m("ngClass",t.S45(12,A,!t.g7$(1,2,t.kDX(2,5,e),n.today))),t.yG2(3),t.cNF(t.g7$(4,7,t.kDX(5,10,e),"d MMMM y"))}}function b(i,f){1&i&&(t.I0R(0,"span",14),t.aS0(1,15),t.C$Y())}function z(i,f){if(1&i&&(t.I0R(0,"tui-hosted-dropdown",12)(1,"button",16),t.SAx(2),t.aS0(3,17),t.k70(),t.C$Y()()),2&i){t.GaO(2);const e=t.Gew(2);t.E7m("content",e)}}function K(i,f){if(1&i&&(t.I0R(0,"div",5),t.c53(1,L,6,14,"span",18,t.oxv,!1,b,2,0,"span",19),t.yuY(4,z,4,1,"tui-hosted-dropdown",12),t.C$Y()),2&i){const e=t.GaO().tuiLet,n=t.GaO(4);let o;t.yG2(),t.oho(null!==(o=e)&&void 0!==o?o:t.q4q(2,R)),t.yG2(3),t.C0Y(4,n.editable?4:-1)}}function H(i,f){if(1&i){const e=t.KQA();t.SAx(0),t.yuY(1,k,2,5,"ng-template",null,7,t.gJz),t.I0R(3,"div",8)(4,"tui-checkbox-block",9),t.qCj("ngModelChange",function(){t.usT(e);const o=t.GaO(2).$implicit,T=t.GaO(2);return t.CGJ(T.triggerSelection(o.id))}),t.OEk(5),t.C$Y(),t.yuY(6,K,5,3,"div",10),t.C$Y(),t.k70()}if(2&i){const e=f.tuiLet,n=t.GaO(2).$implicit,o=t.GaO(2);t.yG2(4),t.E7m("readOnly",!o.editable)("ngModel",void 0!==e),t.yG2(),t.oRS(" ",n.name," "),t.yG2(),t.C0Y(6,null!=e?6:-1)}}function B(i,f){if(1&i&&t.yuY(0,H,7,4,"ng-container",6),2&i){const e=t.GaO().$implicit,n=t.GaO(2);t.E7m("tuiLet",n.selections()[e.id])}}function W(i,f){1&i&&t.yuY(0,B,1,1,"ng-container"),2&i&&t.C0Y(0,f.$implicit.id?0:-1)}function V(i,f){if(1&i&&(t.I0R(0,"tr",2)(1,"td",3)(2,"p",4),t.OEk(3),t.wVc(4,"weekday"),t.C$Y()(),t.I0R(5,"td",3)(6,"div",5),t.c53(7,W,1,1,null,null,Y),t.C$Y()()()),2&i){const e=f.$implicit,n=t.GaO();t.yG2(3),t.cNF(t.kDX(4,1,e)),t.yG2(4),t.oho(n.turnsPerDay()[e])}}let X=(()=>{class i{constructor(){this.turnsService=(0,t.uUt)(u.K),this.destroy$=(0,t.uUt)(a.UF),this.date=(0,t.uUt)(_.y),this.outputMamiChanges=new t._w7,this.loading=(0,t.OCB)(!1),this.selections=(0,t.OCB)({}),this.today=new Date,this.editable$=(0,t.OCB)(!1),this.allTurns=(0,t.OCB)([]),this.turnsPerDay=(0,t.S6b)(()=>{const e=this.allTurns().filter(o=>null!=o.weekday),n={};for(const o of e){if(null==o.weekday||null==o.weekday)throw new Error("Turns must have a weekday");(this.editable$()||o.id&&Object.keys(this.selections()).includes(o.id.toString()))&&(n[o.weekday]||=[],n[o.weekday].push(o))}return n}),this.weekdays=(0,t.S6b)(()=>Object.keys(this.turnsPerDay()).map(Number)),this.lastOutput=null}set turns(e){this.selections.update(n=>(e.forEach(o=>{if(!o.id)throw new Error("Turn id is missing");n[o.id]||=[]}),n))}set dates(e){this.selections.update(n=>(e.forEach(o=>{if(!o.reservation_turn_id)throw new Error("Turn id is missing");if(!o.date)throw new Error("Date is missing or invalid",o.date);n[o.reservation_turn_id]||=[],n[o.reservation_turn_id].push((0,x._0)(o.date))}),n))}set editable(e){this.editable$.set(e)}get editable(){return this.editable$()}set item(e){this.selections.set({}),this.turns=e?.turns??[],this.dates=e?.dates??[]}ngOnInit(){this.searchTurns()}triggerSelection(e){this.selections.update(n=>(e in n?delete n[e]:n[e]=[],n)),this.emitChanges()}triggerDate(e,n){if(!e)throw new Error("Invalid turn id"+e);if(!n)throw new Error("Invalid day"+n);this.selections.update(o=>{o[e]||=[];const T=o[e].findIndex(E=>E.day===n.day);return-1===T?o[e].push(n):o[e].splice(T,1),o[e]=o[e].sort((E,v)=>E.dayAfter(v)?1:-1),o}),this.emitChanges()}emitChanges(){const e=[],n=[],o=this.selections();Object.keys(o).forEach(E=>{const v=parseInt(E);if(0===o[v].length)n.push(v);else for(const N of o[v]){const U=this.date.transform(N.toUtcNativeDate(),"yyyy-MM-dd");U?e.push({turn_id:v,date:U}):console.error("Invalid date",N)}});const T={dates:e,turns:n};(null===this.lastOutput||JSON.stringify(this.lastOutput)!==JSON.stringify(T))&&this.outputMamiChanges.emit(T)}searchTurns(){this.loading.set(!0),this.turnsService.search({per_page:1e3}).pipe((0,s.a)(this.destroy$),(0,c.U)(()=>this.loading.set(!1)),(0,g.k)(e=>e.items),(0,C.a)(e=>(console.error(e),(0,P.of)([])))).subscribe({next:e=>{this.allTurns.set(e)}})}static#t=this.\u0275fac=function(n){return new(n||i)};static#e=this.\u0275cmp=t.In1({type:i,selectors:[["app-select-turns-paymentv2"]],inputs:{turns:"turns",dates:"dates",editable:"editable",item:"item"},outputs:{outputMamiChanges:"outputMamiChanges"},standalone:!0,features:[t.M5G([a.UF]),t.UHJ],decls:5,vars:2,consts:()=>{let e,n;return e="Always",n="Change dates",[["size","xl",3,"overlay","showLoader"],[1,"tui-table"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__td"],[1,"text-xl"],[1,"flex","flex-col"],[4,"tuiLet"],["selectDatesTemplate",""],[1,"flex","flex-row","items-center","mb-5"],[1,"me-1",3,"readOnly","ngModel","ngModelChange"],["class","flex flex-col"],["tuiPreventDefault","mousedown",3,"disabledItemHandler","value","dayClick"],[3,"content"],[1,"mx-2","mb-1",3,"ngClass"],[1,"text-xl","text-green-500"],e,["tuiButton","","tuiHint","Modifica date","appearance","outline","size","s","type","button"],n,["class","mx-2 mb-1",3,"ngClass"],["class","text-xl text-green-500"],["class","tui-table__tr tui-table__tr_border_none"]]},template:function(n,o){1&n&&(t.I0R(0,"tui-loader",0)(1,"table",1)(2,"tbody"),t.c53(3,V,9,3,"tr",20,t.oxv),t.C$Y()()()),2&n&&(t.E7m("overlay",!0)("showLoader",o.loading()),t.yG2(3),t.oho(o.weekdays()))},dependencies:[l.G,D.i,D.I,d.y,d.ue,d._G,h.Sk,h.Cb,_.y,M.GE,M.Qw,w,$.ms,S.y,S.I,O.CI,O.Kw,p.kR,p.ew,F,_.QF,G],changeDetection:0})}return i})()},9772:(y,m,r)=>{r.d(m,{CU:()=>t,ye:()=>d});const _=(new Date).getTimezoneOffset()/60;function t(l,u=_){return"string"==typeof l&&l.length>0&&l.match(/\d{1,2}:\d{1,2}/)?`${Number(l.split(":")[0])-u}:${l.split(":")[1]}`:(console.error("Invalid string provided to strTimeTimezone",{string:l}),"")}function d(l,u=_){return t(l,-1*u)}},964:(y,m,r)=>{r.d(m,{Ez:()=>h,In:()=>S,Q1:()=>D,Q9:()=>$,QX:()=>a,Qx:()=>d,_0:()=>O,ay:()=>l,e6:()=>t,yc:()=>u});var _=r(400);const t=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function d(s,c){return new Date(`${s.formattedYear}-${s.formattedMonthPart}-${s.formattedDayPart} ${c.toString()}`).toISOString()}function l(s){if(!("string"==typeof s&&s.length>0&&s.match(t)))return console.error("Invalid string provided to isoStringToTuiDay",{isoString:s}),null;const c=new Date(s);return new _.EK(c.getFullYear(),c.getMonth()+1,c.getDate())}function u(s){if("string"==typeof s&&s.length>0&&s.match(/^\d{4}-\d{1,2}-\d{1,2}\s{1}00:00$/)&&(s=s.split(" ")[0]),!("string"==typeof s&&s.length>0&&s.match(/^\d{4}-\d{1,2}-\d{1,2}$/)))return console.error("Invalid string provided to stringToTuiDay. Expected format YYYY-MM-DD, got",{str:s}),null;const{day:c,month:g,year:C}=_.EK.parseRawDateString(s,"YMD");return new _.EK(C,g,c)}function a(s){if(!("string"==typeof s&&s.length>0&&s.match(t)))return console.error("Invalid string provided to isoStringToTuiTime",{isoString:s}),null;const c=new Date(s);return new _.uc(c.getHours(),c.getMinutes())}function h(s){return new Date(`1970-01-01 ${s.toString()}`).toISOString()}function $(s){const c=new Date(`${s}Z`);return`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")} ${String(c.getHours()).padStart(2,"0")}:${String(c.getMinutes()).padStart(2,"0")}`}function S(s){return function M(s){const c=new Date(`1970-01-01 ${s}`);return`${`${c.getUTCHours()}`.padStart(2,"0")}:${`${c.getUTCMinutes()}`.padStart(2,"0")}`}(s.toString())}function O(s){return new _.EK(s.getFullYear(),s.getMonth(),s.getDate())}function D(s){return new _.uc(s.getHours(),s.getMinutes())}},1960:(y,m,r)=>{r.d(m,{u:()=>l});var _=r(8400),t=r(5136);class d extends _.w{constructor(a){super(a),this.date=a.date?new Date(a.date):void 0,this.reservation_turn_id=a.reservation_turn_id,this.group_id=a.group_id,this.reservation_turn=a.reservation_turn?new t.e(a.reservation_turn):void 0}}class l extends _.w{constructor(a){super(a),this.turns=[],this.dates=[],this.title=a.title,this.status=a.status,this.preorder_type=a.preorder_type,this.payment_value=a.payment_value,this.message=a.message,this.turns=(a.turns||[]).map(p=>new t.e(p)),this.dates=(a.dates||[]).map(p=>new d(p))}}},5136:(y,m,r)=>{r.d(m,{e:()=>l});var _=r(8400),t=r(9772),d=r(1960);class l extends _.w{constructor(a){super(a),this.name=a.name,this.weekday=a.weekday,this.step=a.step,this.valid_times=a.valid_times,this.starts_at=a.starts_at?(0,t.CU)(a.starts_at):void 0,this.ends_at=a.ends_at?(0,t.CU)(a.ends_at):void 0,this.preorder_reservation_group=a.preorder_reservation_group?new d.u(a.preorder_reservation_group):void 0}}},2516:(y,m,r)=>{r.d(m,{G:()=>t});var _=r(4496);let t=(()=>{class d{constructor(){this.weekdays=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]}transform(u){return"number"!=typeof u&&"string"==typeof u&&(u=parseInt(u)),"number"==typeof u&&u>=0&&u<=6?this.weekdays[u]:null}static#t=this.\u0275fac=function(a){return new(a||d)};static#e=this.\u0275pipe=_.UTH({name:"weekday",type:d,pure:!0,standalone:!0})}return d})()},4251:(y,m,r)=>{r.d(m,{e:()=>l});var _=r(6012),t=r(1960),d=r(4496);let l=(()=>{class u extends _.s{constructor(){super(t.u,"admin/preorder_reservation_groups")}static#t=this.\u0275fac=function(h){return new(h||u)};static#e=this.\u0275prov=d.wxM({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},7556:(y,m,r)=>{r.d(m,{K:()=>l});var _=r(6012),t=r(5136),d=r(4496);let l=(()=>{class u extends _.s{constructor(){super(t.e,"admin/reservation_turns")}static#t=this.\u0275fac=function(h){return new(h||u)};static#e=this.\u0275prov=d.wxM({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()}}]);