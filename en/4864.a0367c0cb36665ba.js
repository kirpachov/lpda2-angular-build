"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[4864],{4864:(y,C,s)=>{s.r(C),s.d(C,{ResetPasswordComponent:()=>w});var t=s(4496),r=s(1368),_=s(6504),O=s(9956),n=s(3480),o=s(5e3),e=s(8212),u=s(7692),a=s(8048),m=s(3797),d=s(7568),g=s(2992),f=s(3468),R=s(4872),P=s(9212),D=s(2300),A=s(3616),S=s(4964),l=s(4388),E=s(8256),i=s(8392),p=s(4476),T=s(7936);function x(v,I){if(1&v&&t.wR5(0,"app-errors",12),2&v){const c=t.GaO();t.E7m("errors",c.e("password"))}}function b(v,I){if(1&v&&t.wR5(0,"app-errors",12),2&v){const c=t.GaO();t.E7m("errors",c.e("code"))}}function $(v,I){if(1&v&&t.wR5(0,"app-errors",12),2&v){const c=t.GaO();t.E7m("errors",c.form.errors)}}let w=(()=>{class v{constructor(){this.auth=(0,t.uUt)(S.o),this.router=(0,t.uUt)(g.E5),this.configs=(0,t.uUt)(f.m),this.route=(0,t.uUt)(g.gV),this.notifications=(0,t.uUt)(l.E),this._=(0,t.uUt)(p.OY).setTitle("Set password | The water door"),this.form=new _.WC({code:new _.Ku(null,[_.AQ.required]),password:new _.Ku(null,[_.AQ.required])}),this.destroy$=(0,t.uUt)(n.UF),this.loading=!1,this.typing=!1,this.type$=this.form.valueChanges.pipe((0,R.ay)(),(0,P.y)(()=>this.typing=!0),(0,D.o)(1e3),(0,P.y)(()=>this.typing=!1)).subscribe(),this.submitted=!1}se(c){if(this.typing||!this.submitted)return!1;const h=this.form.get(c);return!!h&&h.invalid&&(h.dirty||h.touched)}e(c){const h=this.form.get(c);return h?h.errors:null}ngOnInit(){this.setMinPasswordLength(),this.readCodeFromRoute()}submit(){this.submitted=!0,!this.form.invalid&&(this.loading=!0,this.auth.resetPassword(this.formValue()).pipe((0,A.a)(this.destroy$)).subscribe({next:()=>{this.loading=!1,this.router.navigate(["/auth"]),this.notifications.success("The password has been successfully reset. You can now log in.")},error:c=>{this.loading=!1,this.notifications.error((0,E.mk)(c)||i.a),console.error("resetPassword",c),this.form.setErrors({...this.form.errors,server:c.error.message})}}))}formValue(){const c=this.form.value;return{code:c.code,password:c.password}}setMinPasswordLength(){this.configs.get("minPasswordLength").subscribe(c=>{c&&!isNaN(c)&&c>0&&this.form.get("password")?.setValidators([_.AQ.required,_.AQ.minLength(c)])})}readCodeFromRoute(){this.route.params.subscribe(c=>{c.code&&this.form.get("code")?.setValue(c.code)})}static#t=this.\u0275fac=function(h){return new(h||v)};static#r=this.\u0275cmp=t.In1({type:v,selectors:[["app-reset-password"]],standalone:!0,features:[t.M5G([n.UF]),t.UHJ],decls:25,vars:9,consts:()=>{let c,h;return c="Code",h="Password",[[1,"flex","justify-center","h-full"],[1,"flex","flex-col","justify-center"],[1,"flex","flex-col",3,"formGroup","ngSubmit"],[1,"mb-1"],[1,"text-slate-400","mb-3"],[1,"mb-2","hidden"],["formControlName","code",3,"tuiAutoFocus","tuiTextfieldSize"],c,["tuiTextfield","","type","text"],[1,"mb-2"],["formControlName","password",3,"tuiAutoFocus","tuiTextfieldSize"],h,[3,"errors"],[1,"flex","justify-between"],["routerLink","/auth","tuiButton","","appearance","secondary","type","button",1,"me-2"],["tuiButton","","type","submit",1,"ms-2",3,"showLoader"]]},template:function(h,M){1&h&&(t.I0R(0,"div",0)(1,"div",1)(2,"form",2),t.qCj("ngSubmit",function(){return M.submit()}),t.I0R(3,"h2",3),t.OEk(4,"Reimposta la password."),t.C$Y(),t.I0R(5,"span",4),t.OEk(6,"Inserisci la nuova password."),t.C$Y(),t.I0R(7,"div",5)(8,"tui-input",6),t.SAx(9),t.aS0(10,7),t.k70(),t.wR5(11,"input",8),t.C$Y()(),t.I0R(12,"div",9)(13,"tui-input-password",10),t.SAx(14),t.aS0(15,11),t.k70(),t.wR5(16,"input",8),t.C$Y(),t.yuY(17,x,1,1,"app-errors",12),t.C$Y(),t.yuY(18,b,1,1,"app-errors",12)(19,$,1,1,"app-errors",12),t.I0R(20,"div",13)(21,"button",14),t.OEk(22,"Annulla"),t.C$Y(),t.I0R(23,"button",15),t.OEk(24,"Conferma"),t.C$Y()()()()()),2&h&&(t.yG2(2),t.E7m("formGroup",M.form),t.yG2(6),t.E7m("tuiAutoFocus",!0)("tuiTextfieldSize","l"),t.yG2(5),t.E7m("tuiAutoFocus",!0)("tuiTextfieldSize","l"),t.yG2(4),t.C0Y(17,M.se("password")?17:-1),t.yG2(),t.C0Y(18,M.se("code")?18:-1),t.yG2(),t.C0Y(19,M.submitted?19:-1),t.yG2(4),t.E7m("showLoader",M.loading))},dependencies:[r.MD,_.sl,_.sz,_.ue,_.u,_.uW,_.Wo,e.CI,e.Kw,m.CQ,m.Oo,m.cP,T.b,O.g,o.m6,o.gJ,u.Sk,d.eW,d.Mt,d.Ki,a.aS,a.rD,g.qQ,g.ER],styles:["[_nghost-%COMP%]{display:block;height:100%}"]})}return v})()},9956:(y,C,s)=>{s.d(C,{g:()=>S});var t=s(1368),r=s(4496),_=s(9938),O=s(2528),n=s(7308),o=s(7012),e=s(3972),u=s(5944),a=s(1040);function m(l,E){if(1&l&&(r.SAx(0),r.OEk(1),r.k70()),2&l){const i=E.polymorpheusOutlet;r.yG2(),r.oRS(" ",i," ")}}const d=()=>({});function g(l,E){if(1&l&&(r.I0R(0,"div",1),r.wVc(1,"async"),r.yuY(2,m,2,1,"ng-container",2),r.wVc(3,"async"),r.C$Y()),2&l){const i=r.GaO();r.eAK("t-message-text_light","onDark"===r.kDX(1,6,i.mode$)),r.E7m("@tuiFadeIn",i.animation)("@tuiHeightCollapse",i.animation),r.yG2(2),r.E7m("polymorpheusOutlet",i.error.message||r.kDX(3,8,i.defaultErrorMessage$))("polymorpheusOutletContext",i.error.context||r.q4q(10,d))}}let f=(()=>{class l{constructor(i,p,T){this.animation=i,this.mode$=p,this.defaultErrorMessage$=T,this.error=null,this.visible=!0}set errorSetter(i){this.error=(0,O.gT)(i)?new n.E(i):i}onAnimation(i){this.visible=i}}return l.\u0275fac=function(i){return new(i||l)(r.GI1(u.kp),r.GI1(u.Yx),r.GI1(u.cX))},l.\u0275cmp=r.In1({type:l,selectors:[["tui-error"]],hostBindings:function(i,p){1&i&&r.qCj("animationcancel.self",function(){return p.onAnimation(!1)})("animationstart.self",function(){return p.onAnimation(!0)})},inputs:{errorSetter:[r.Wk5.None,"error","errorSetter"]},features:[r.M5G([e.Ir])],decls:1,vars:1,consts:[["automation-id","tui-error__text","class","t-message-text",3,"t-message-text_light",4,"ngIf"],["automation-id","tui-error__text",1,"t-message-text"],[4,"polymorpheusOutlet","polymorpheusOutletContext"]],template:function(i,p){1&i&&r.yuY(0,g,4,11,"div",0),2&i&&r.E7m("ngIf",p.error&&p.visible)},dependencies:[t.u_,a.Af,t.a],styles:["[_nghost-%COMP%]{font:var(--tui-font-text-s);color:var(--tui-text-01);display:block;color:var(--tui-negative);word-wrap:break-word;animation:tuiPresent 1s infinite}.t-message-text[_ngcontent-%COMP%]{margin-top:.25rem;white-space:pre-line}.t-message-text_light[_ngcontent-%COMP%]{color:var(--tui-negative-night)}"],data:{animation:[o.iY,o.K2]},changeDetection:0}),l})(),R=(()=>{class l{}return l.\u0275fac=function(i){return new(i||l)},l.\u0275mod=r.a4G({type:l}),l.\u0275inj=r.s3X({imports:[[t.MD,a.Ux]]}),l})();function P(l,E){1&l&&r.wR5(0,"tui-error",0),2&l&&r.E7m("error",E.$implicit)}function D(l,E){1&l&&r.C_f(0)}function A(l,E){1&l&&r.yuY(0,D,1,0,"ng-container",1),2&l&&r.E7m("ngTemplateOutlet",E.$implicit)}let S=(()=>{class l{constructor(){this._errors=null}get errors(){return this._errors}set errors(i){this._errors=i}allErrors(){return this.errors||null}errorsToTemplates(){return _.y.formatErrors(this.errors||null).filter(i=>i&&i instanceof r.Yw2)}errorsToStr(){return _.y.formatErrors(this.errors||null).filter(i=>i&&"string"==typeof i)}static#t=this.\u0275fac=function(p){return new(p||l)};static#r=this.\u0275cmp=r.In1({type:l,selectors:[["app-errors"]],inputs:{errors:"errors"},standalone:!0,features:[r.UHJ],decls:4,vars:0,consts:[[3,"error"],[4,"ngTemplateOutlet"]],template:function(p,T){1&p&&(r.c53(0,P,1,1,"tui-error",0,r.oxv),r.c53(2,A,1,1,"ng-container",null,r.oxv)),2&p&&(r.oho(T.errorsToStr()),r.yG2(2),r.oho(T.errorsToTemplates()))},dependencies:[t.MD,t.XV,R,f]})}return l})()},8256:(y,C,s)=>{function t(n,o){return n.error?.message?n.error.message:500==n.status?`${n.error.error} ${n.error.exception}`.replace(/\</gm,"").replace(/\>+/gm,""):504==n.status?"Server unreachable, check your connection and try again.":r(function O(n){if("object"==typeof n.error&&"object"==typeof n.error.details&&Array.isArray(n.error.details)&&n.error.details.length>0){const o=n.error.details.filter(e=>"object"==typeof e&&null!=e&&e instanceof Object&&Object.keys(e).length>0).filter(e=>"string"==typeof e.attribute&&e.attribute.length>0&&("string"==typeof e.message&&e.message.length>0||Array.isArray(e.message)&&e.message.length>0));if(o.length>0)return o}return[]}(n),o)}function r(n,o){if(0==n.length)return null;const e=o?.joinChar??", ",u=n.map(a=>`${a.attribute} ${a.message}`);return u.length?function _(n){return[...new Set(n)]}(u).join(e):null}s.d(C,{Yj:()=>r,mk:()=>t})},9938:(y,C,s)=>{s.d(C,{y:()=>O});var t=s(6504);const r={required:"Questo campo non pu\xf2 essere vuoto!",email:"Questa email non \xe8 valida!",numbersOnly:"Solo numeri ammessi!",numberOnly:"Solo numeri ammessi!",numerical:"Solo numeri ammessi!",invalid_http_url:"Collegamento http non valido",minlength:n=>`Testo troppo corto: Lunghezza minima: ${n.requiredLength}, lunghezza attuale: ${n.actualLength}`,InvalidFormat:n=>`"${n.value}" non \xe8 un formato valido. Esempio valido: "${n.validExample}"`,pattern:n=>`"${n.actualValue}" non \xe8 un formato valido. Il formato deve rispettare la seguente espressione regolare (RegExp): "${n.requiredPattern}"`,max:n=>`Il valore inserito \xe8 troppo grande! Valore massimo: ${n.max}, valore attuale: ${n.actual}`,min:n=>`Il valore inserito \xe8 troppo piccolo! Valore minimo: ${n.min}, valore attuale: ${n.actual}`,maxlength:n=>`Il valore inserito \xe8 troppo lungo! Lunghezza massima: ${n.requiredLength}, Lunghezza attuale: ${n.actualLength}`,phoneIT:"Questo non sembra essere un numero di telefono italiano valido. Esempio: +39 123 456 7890",inclusion:n=>"Il valore inserito non \xe8 valido. "+(Array.isArray(n)?`I valori ammessi sono: ${n.join(", ")}.`:""),arrayMinLength:n=>`Devi inserire almeno ${n.requiredLength} elementi.`,passwordConfirmation:"Le password non coincidono!"},_={assignToFormUnlessControl:!0};class O{static formatErrors(o,e){return null==o||null==o?[]:new O(o,e).formatErrors()}static assignErrorsToForm(o,e,u={}){const a=e.error?.details;if(!a||!Array.isArray(a))return"object"==typeof a&&Object.keys(a).length>0?this.assignErrorsToFormFromJson(o,a,u):void console.warn("invalid errors provided to assignErrorsToForm",a);this.assignErrorsToFormFromArray(o,a,u)}static assignErrorsToFormFromJson(o,e,u={}){const a={..._,...u};Object.keys(e).forEach(m=>{const d=e[m];d&&Array.isArray(d)?d.forEach(g=>{const f=o.controls[m];f?f.setErrors({[g.attribute]:g.message}):a.assignToFormUnlessControl&&o.setErrors({[g.attribute]:g.message})}):console.warn("assignErrorsToFormFromJson expected an array of ActiveError, but got:",d)})}static assignErrorsToFormFromArray(o,e,u={}){const a={..._,...u};e.forEach(m=>{const d=o instanceof t.WC?o.controls[m.attribute]:o;d?d.setErrors({[m.attribute]:m.message}):a.assignToFormUnlessControl&&o.setErrors({[m.attribute]:m.message})})}constructor(o,e=r){this.defaultMessages=r,this.messages={},this.enableLogging=!1,this.errors=o,e?this.mergeMessages(e):this.assignDefaults()}assignDefaults(){this.messages={},Object.keys(this.defaultMessages).forEach(o=>{this.messages[o]=this.defaultMessages[o]})}mergeMessages(o){[...Object.keys(this.defaultMessages),...Object.keys(o)].forEach(u=>{this.messages[u]=o[u]?o[u]:this.defaultMessages[u]})}formatErrors(){return[...this.errorMsgFromControl()]}warn(...o){this.enableLogging&&console.warn(...o)}errorMsgFromControl(){if(null==this.errors||null==this.errors)return[];var o=[];return Object.keys(this.errors).filter(e=>{if("string"==typeof this.errors[e]&&this.errors[e].length>0)return o.push(this.errors[e]);if(this.messages.hasOwnProperty(e)&&this.messages[e]&&null!=this.messages[e]){const m=this.messages[e];switch(typeof m){case"string":default:o.push(m);break;case"function":o.push(m(this.errors[e]))}}else if(this.warn(`ReactiveFormsErrors missing error message of "${e}". Parser error with your custom logic.`),[!0,!1].includes(this.errors[e])){var a={};a[e]=this.errors[e],"string"!=typeof a&&(a=JSON.stringify(a)),o.push(a)}else o.push(this.errors[e])}),o}}},8392:(y,C,s)=>{s.d(C,{a:()=>t});const t="Something went wrong."},4872:(y,C,s)=>{s.d(C,{ay:()=>O});var t=s(4496),r=s(3252),_=s(3616);function O(e){e||((0,t.yAg)(O),e=(0,t.uUt)(t.eM9));const u=new r._(a=>e.onDestroy(a.next.bind(a)));return a=>a.pipe((0,_.a)(u))}}}]);