"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[2736],{4208:(R,c,i)=>{i.d(c,{u:()=>w});var e=i(4496),a=i(3480),l=i(400),u=i(8304),m=i(3616),o=i(8824),p=i(7692),t=i(5656);let v=(()=>{class n{transform(s){return null==s||"object"!=typeof s||Array.isArray(s)?[]:Object.keys(s).map(r=>[r,s[r]])}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275pipe=e.UTH({name:"objectToArray",type:n,pure:!0,standalone:!0})}return n})();var d=i(1560),h=i(1368);function f(n,_){if(1&n&&e.wR5(0,"tui-loader",0),2&n){const s=e.GaO();e.E7m("showLoader",s.showLoader)("size","s")}}const O=(n,_)=>_[0];function y(n,_){if(1&n&&(e.SAx(0),e.aS0(1,8),e.k70(),e.OEk(2)),2&n){const s=e.GaO(2);e.yG2(2),e.oRS(" ",s.totalPeople(),"\n")}}function A(n,_){if(1&n&&(e.OEk(0),e.SAx(1),e.aS0(2,11),e.k70(),e.OEk(3),e.SAx(4),e.aS0(5,12),e.k70()),2&n){const s=e.GaO().$implicit;e.oRS(" ",s[1]," "),e.yG2(3),e.oRS(" ",s[0]," ")}}function C(n,_){if(1&n&&(e.yuY(0,A,6,2,"ng-template",null,9,e.gJz),e.I0R(2,"span",10),e.OEk(3),e.C$Y()),2&n){const s=_.$implicit,r=e.Gew(1);e.yG2(2),e.E7m("tuiHint",r),e.yG2(),e.CAO(" ",s[1]," x ",s[0]," ")}}function I(n,_){if(1&n&&(e.I0R(0,"p",13),e.OEk(1),e.C$Y()),2&n){const s=e.GaO(2);e.yG2(),e.oRS(" ",s.groupedError()," ")}}const b=(n,_)=>_.turn.id;function x(n,_){1&n&&e.OEk(0,"Quante persone ci sono al tavolo in questione")}function L(n,_){if(1&n&&(e.I0R(0,"th",19),e.OEk(1),e.C$Y()),2&n){const s=_.$implicit;e.yG2(),e.oRS(" ",s[0]," ")}}function D(n,_){1&n&&e.OEk(0,"Quanti tavoli con lo stesso numero di persone")}const U=n=>({"text-slate-400":n});function $(n,_){if(1&n&&(e.I0R(0,"td",23)(1,"span",26),e.OEk(2),e.C$Y()()),2&n){const s=_.$implicit;e.yG2(),e.E7m("ngClass",e.S45(2,U,0==s[1])),e.yG2(),e.cNF(s[1])}}function G(n,_){if(1&n&&(e.I0R(0,"div",15)(1,"p",16)(2,"b"),e.OEk(3),e.C$Y()(),e.I0R(4,"table",17)(5,"thead")(6,"tr",18)(7,"th",19),e.yuY(8,x,1,0,"ng-template",null,20,e.gJz),e.I0R(10,"span",21),e.aS0(11,22),e.C$Y()(),e.c53(12,L,2,1,"th",27,O),e.wVc(14,"objectToArray"),e.C$Y()(),e.I0R(15,"tbody")(16,"tr",18)(17,"td",23),e.yuY(18,D,1,0,"ng-template",null,24,e.gJz),e.I0R(20,"span",21),e.aS0(21,25),e.C$Y()(),e.c53(22,$,3,4,"td",28,O),e.wVc(24,"objectToArray"),e.C$Y()()()()),2&n){const s=_.$implicit,r=e.Gew(9),E=e.Gew(19);e.yG2(3),e.cNF(s.turn.name),e.yG2(7),e.E7m("tuiHint",r),e.yG2(2),e.oho(e.kDX(14,3,s.summary)),e.yG2(8),e.E7m("tuiHint",E),e.yG2(2),e.oho(e.kDX(24,5,s.summary))}}function B(n,_){if(1&n&&(e.I0R(0,"div",14),e.c53(1,G,25,7,"div",29,b),e.C$Y()),2&n){const s=e.GaO(2);e.yG2(),e.oho(s.groupedData())}}function Y(n,_){if(1&n&&(e.yuY(0,y,3,1,"ng-template",null,1,e.gJz),e.I0R(2,"div",2)(3,"span",3),e.SAx(4),e.aS0(5,4),e.k70(),e.C$Y(),e.c53(6,C,4,3,null,null,O),e.I0R(8,"span",5)(9,"mat-icon",6),e.OEk(10,"import_contacts"),e.C$Y(),e.OEk(11),e.C$Y()(),e.yuY(12,I,2,1,"p",7)(13,B,3,0)),2&n){const s=e.Gew(1),r=e.GaO();e.yG2(6),e.oho(r.ungroupedData()),e.yG2(2),e.E7m("tuiHint",s),e.yG2(3),e.oRS(" ",r.totalPeople()," "),e.yG2(),e.C0Y(12,r.groupedError()?12:13)}}let w=(()=>{class n{constructor(){this.destroy$=(0,e.uUt)(a.UF),this.service=(0,e.uUt)(u.S),this.ungroupedData=(0,e.OCB)(null),this.totalPeople=(0,e.S6b)(()=>this.ungroupedData()?.reduce((s,[r,E])=>s+r*E,0)||0),this.groupedData=(0,e.OCB)(null),this.loadingGrouped=(0,e.OCB)(!1),this.loadingUngrouped=(0,e.OCB)(!1),this.parentLoading=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.loadingGrouped()||this.loadingUngrouped()||this.parentLoading()),this.groupedError=(0,e.OCB)(null),this.filters=null}set showLoader(s){this.parentLoading.set(s)}get showLoader(){return this.parentLoading()}ngOnChanges(){this.query()}query(){this.queryUngrouped(),this.queryGrouped()}queryUngrouped(){this.loadingUngrouped.set(!0);const s={};Object.keys(this.filters??{}).forEach(r=>{if(this.filters){const E=this.filters[r];E instanceof l.EK?s[r]=E.toString():E&&(s[r]=E)}}),this.service.ungroupedTablesSummary(s).pipe((0,m.a)(this.destroy$),(0,o.U)(()=>this.loadingUngrouped.set(!1))).subscribe({next:r=>{this.ungroupedData.set(Object.entries(r).map(([E,g])=>[Number(E),g]))}})}queryGrouped(){this.groupedError.set(null),this.groupedData.set(null);const s={};if(this.filters&&this.filters.date_from&&this.filters.date_from===this.filters.date_to)s.date=this.filters.date_from.toString();else{if(!(this.filters&&this.filters.date instanceof l.EK))return console.warn("invalid filters for grouped data",this.filters,JSON.stringify(this.filters)),void this.groupedError.set("Select a single day to view the summary grouped by shift.");s.date=this.filters.date.toString()}this.loadingGrouped.set(!0),this.service.tablesSummary(s).pipe((0,m.a)(this.destroy$),(0,o.U)(()=>this.loadingGrouped.set(!1))).subscribe({next:r=>{this.groupedData.set(function T(n){const _=n.map(s=>Object.keys(s.summary).map(Number)).flat();return n.map(s=>function S(n,_){for(let r=1;r<=8;r++)r in n.summary||(n.summary[r]=0);for(const r of _)r in n.summary||(n.summary[r]=0);return n}(s,_))}(r))}})}static#e=this.\u0275fac=function(r){return new(r||n)};static#t=this.\u0275cmp=e.In1({type:n,selectors:[["app-reservation-tables-summary"]],inputs:{showLoader:"showLoader",filters:"filters"},standalone:!0,features:[e.M5G([a.UF]),e.SYr,e.UHJ],decls:2,vars:1,consts:()=>{let s,r,E,g,N,P;return s="Table distribution",r="Total people",E="tables from",g="people",N="N\xB0 of people",P="Quantity:",[[3,"showLoader","size"],["totalHint",""],[1,"flex","items-center","justify-around","border","px-2","py-2","border-slate-200"],[1,"hidden","md:flex","items-center","justify-center"],s,[1,"flex","items-center",3,"tuiHint"],[1,"me-1"],["class","text-slate-500"],r,["dHint",""],[1,"me-1",3,"tuiHint"],E,g,[1,"text-slate-500"],[1,"flex","flex-wrap"],[1,"col-12","pe-2","mb-2","md:col-6"],[1,"font-xl"],[1,"tui-table"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__th"],["headerExplain",""],[3,"tuiHint"],N,[1,"tui-table__td"],["valueExplain",""],P,[3,"ngClass"],["class","tui-table__th"],["class","tui-table__td"],["class","col-12 pe-2 mb-2 md:col-6"]]},template:function(r,E){1&r&&e.yuY(0,f,1,2,"tui-loader",0)(1,Y,14,3),2&r&&e.C0Y(0,E.loading()?0:1)},dependencies:[p.Sk,p.Cb,t.WY,t.lh,t.SL,t.i6,t.IT,d.oB,d.qL,v,h.QF],styles:["td[_ngcontent-%COMP%], th[_ngcontent-%COMP%]{border:1px solid var(--tui-base-04)}table[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]{font-size:.9rem}table[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   .tui-table__td[_ngcontent-%COMP%], table[_ngcontent-%COMP%]   *[_ngcontent-%COMP%]   .tui-table__th[_ngcontent-%COMP%]{padding:.5rem;height:inherit}"],changeDetection:0})}return n})()},8128:(R,c,i)=>{function e(a){if(!a)return null;const l=a.match(/filename="(.+)"/);return l?l[1]:null}i.d(c,{k:()=>e})},9772:(R,c,i)=>{i.d(c,{CU:()=>a,ye:()=>l});const e=(new Date).getTimezoneOffset()/60;function a(u,m=e){return"string"==typeof u&&u.length>0&&u.match(/\d{1,2}:\d{1,2}/)?`${Number(u.split(":")[0])-m}:${u.split(":")[1]}`:(console.error("Invalid string provided to strTimeTimezone",{string:u}),"")}function l(u,m=e){return a(u,-1*m)}},1960:(R,c,i)=>{i.d(c,{u:()=>u});var e=i(8400),a=i(5136);class l extends e.w{constructor(o){super(o),this.date=o.date?new Date(o.date):void 0,this.reservation_turn_id=o.reservation_turn_id,this.group_id=o.group_id,this.reservation_turn=o.reservation_turn?new a.e(o.reservation_turn):void 0}}class u extends e.w{constructor(o){super(o),this.turns=[],this.dates=[],this.title=o.title,this.status=o.status,this.preorder_type=o.preorder_type,this.payment_value=o.payment_value,this.message=o.message,this.turns=(o.turns||[]).map(p=>new a.e(p)),this.dates=(o.dates||[]).map(p=>new l(p)),this.translations=o.translations||{}}}},5136:(R,c,i)=>{i.d(c,{e:()=>u});var e=i(8400),a=i(9772),l=i(1960);class u extends e.w{constructor(o){super(o),this.messages=[],this.name=o.name,this.weekday=o.weekday,this.step=o.step,this.valid_times=o.valid_times,this.starts_at=o.starts_at?(0,a.CU)(o.starts_at):void 0,this.ends_at=o.ends_at?(0,a.CU)(o.ends_at):void 0,this.preorder_reservation_group=o.preorder_reservation_group?new l.u(o.preorder_reservation_group):void 0,this.messages=o.messages}}},5180:(R,c,i)=>{i.d(c,{C:()=>o});var e=i(8400);class a extends e.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class l extends e.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(S=>new a(S)):[]}}class u extends e.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(S=>new l(S)):[]}}class m extends e.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.external_id=t.external_id,this.other=t.other}}class o extends e.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new m(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(S=>new u(S)):[]}}},8304:(R,c,i)=>{i.d(c,{S:()=>S});var e=i(6012),a=i(5180),l=i(4704),u=i(3252),m=i(9144),o=i(7048),p=i(8128),t=i(4496);let S=(()=>{class T extends e.s{constructor(){super(a.C,"admin/reservations")}updateStatus(d,h){return this.patch(`${d}/status/${h}`,{}).pipe((0,l.k)(f=>this.mapItem(f)))}tablesSummary(d={}){return this.get("tables_summary",{params:d})}ungroupedTablesSummary(d={}){return this.get("ungrouped_tables_summary",{params:d})}deliverConfirmationEmail(d){return this.post(`${d}/deliver_confirmation_email`,{}).pipe((0,l.k)(h=>this.mapItem(h)))}refoundPayment(d){return this.post(`${d}/refund_payment`,{}).pipe((0,l.k)(h=>this.mapItem(h)))}refreshPaymentStatus(d){return this.post(`${d}/refresh_payment_status`,{}).pipe((0,l.k)(h=>this.mapItem(h)))}export(d){return new u._(h=>{this.get("export",{responseType:"blob",observe:"response",params:d}).pipe((0,m.a)(f=>(console.error("ReservationsService.export() error:",f),h.error(f),new u._))).subscribe(f=>{if(f instanceof o.WA&&f.body){const O=(0,p.k)(f.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",y=f.headers?.get("Content-Type")??"application/octet-stream",A=window.URL.createObjectURL(new Blob([f.body],{type:y})),C=document.createElement("a");C.href=A,C.download=O,C.click(),h.complete()}})})}static#e=this.\u0275fac=function(h){return new(h||T)};static#t=this.\u0275prov=t.wxM({token:T,factory:T.\u0275fac,providedIn:"root"})}return T})()},1200:(R,c,i)=>{i.d(c,{A:()=>o,m:()=>p});var e=i(4496),a=i(900),l=i(3480),u=i(800),m=i(3616);let o=(()=>{class t{constructor(T,v,d){this.el=T,this.zone=v,this.destroy$=d,this.eventName=""}ngOnInit(){(0,u.w)(this.el.nativeElement,this.eventName,{passive:!1}).pipe((0,a.Uv)(this.zone),(0,a.uy)(),(0,m.a)(this.destroy$)).subscribe()}}return t.\u0275fac=function(T){return new(T||t)(e.GI1(e.GMv),e.GI1(e.WW2),e.GI1(l.UF,2))},t.\u0275dir=e.Sc5({type:t,selectors:[["","tuiPreventDefault",""]],inputs:{eventName:[e.Wk5.None,"tuiPreventDefault","eventName"]},features:[e.M5G([l.UF])]}),t})(),p=(()=>{class t{}return t.\u0275fac=function(T){return new(T||t)},t.\u0275mod=e.a4G({type:t}),t.\u0275inj=e.s3X({}),t})()}}]);