"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[3472],{9740:(y,h,o)=>{o.r(h),o.d(h,{ExportReservationsModalModule:()=>V});var c=o(2992),n=o(7552),e=o(4496),_=o(6504),i=o(1368),r=o(400);let s=(()=>{class E{constructor(){this.datePipe=(0,e.uUt)(i.y)}transform(a,f){return a instanceof r.Se?`Dal ${this.datePipe.transform(a.from.toUtcNativeDate(),f)} al ${this.datePipe.transform(a.to.toUtcNativeDate(),f)}`:null}static#e=this.\u0275fac=function(f){return new(f||E)};static#t=this.\u0275pipe=e.UTH({name:"datePeriodSummary",type:E,pure:!0,standalone:!0})}return E})();var t=o(3480),u=o(3984),d=o(424),R=o(3616);function O(E,z){if(1&E&&e.OEk(0),2&E){const a=e.GaO();e.oRS(" ",a.label," ")}}function T(E,z){if(1&E&&(e.I0R(0,"small",3),e.OEk(1),e.wVc(2,"datePeriodSummary"),e.C$Y()),2&E){const a=e.GaO();e.yG2(),e.cNF(e.kDX(2,1,a.control.value))}}const M=["*"];let S=(()=>{class E{constructor(){this.destroy$=new t.UF,this.control=new _.Ku(null),this.today=r.EK.currentLocal(),this.tomorrow=r.EK.currentLocal().append({day:1}),this.max=null,this.appProductionDate=r.EK.fromLocalNativeDate(new Date("2023-8-1")),this.endOfCurrentYear=r.EK.fromLocalNativeDate(new Date(`${this.today.year}-12-31`)),this.periodOptions=[new u.Ib(new r.Se(this.today.append({day:-30}),this.today),"Last month"),new u.Ib(new r.Se(this.today.append({day:-365}),this.today),"Last year"),...Array.from({length:5},(a,f)=>f).map(a=>this.today.year-a).filter(a=>a>=this.appProductionDate.year).map(a=>new u.Ib(new r.Se(r.EK.fromLocalNativeDate(new Date(`${a}-01-01`)),r.EK.fromLocalNativeDate(new Date(`${a}-12-31`))),`${a}`))],this.label="Select the time period."}writeValue(a){if(void 0===a&&(a=null),null===a||a instanceof r.Se)return this.control.setValue(a);console.warn("Invalid value for DatePeriodComponent",a)}registerOnChange(a){this.control.valueChanges.pipe((0,R.a)(this.destroy$)).subscribe((...f)=>a(...f))}registerOnTouched(a){this.control.valueChanges.pipe((0,R.a)(this.destroy$)).subscribe((...f)=>a(...f))}setDisabledState(a){a?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(f){return new(f||E)};static#t=this.\u0275cmp=e.In1({type:E,selectors:[["app-date-period"]],inputs:{max:"max",label:"label"},standalone:!0,features:[e.M5G([{provide:_.Y6,useExisting:(0,e.wd)(()=>E),multi:!0},t.UF]),e.UHJ],ngContentSelectors:M,decls:6,vars:6,consts:[[3,"min","max","formControl","items"],["content",""],["class","d-block text-muted"],[1,"d-block","text-muted"]],template:function(f,p){if(1&f&&(e.kPM(),e.I0R(0,"tui-input-date-range",0)(1,"span",null,1),e._Xx(3),e.C$Y(),e.yuY(4,O,1,1),e.C$Y(),e.yuY(5,T,3,3,"small",2)),2&f){const I=e.Gew(2);e.E7m("min",p.appProductionDate)("max",p.max)("formControl",p.control)("items",p.periodOptions),e.yG2(4),e.C0Y(4,I.children.length?-1:4),e.yG2(),e.C0Y(5,null!=p.control.value&&p.control.value.from&&null!=p.control.value&&p.control.value.to?5:-1)}},dependencies:[d.uy,d.YZ,d.Ku,_.sl,_.ue,_.ug,s],encapsulation:2})}return E})();var P=o(1183),D=o(8212),A=o(9956),m=o(8304),g=o(8824),l=o(3264),v=o(1128),C=o(8256),U=o(8392);let F=(()=>{class E{constructor(){this.service=(0,e.uUt)(m.S),this.destroy$=(0,e.uUt)(t.UF),this.date=(0,e.uUt)(i.y),this.notifications=(0,e.uUt)(v.E),this.loading=(0,e.OCB)(!1),this.form=new _.WC({created_at:new _.Ku(null),datetime:new _.Ku(null),status:new _.Ku(null)})}export(){this.loading.set(!0),this.service.export(this.formatFormValue()).pipe((0,R.a)(this.destroy$),(0,g.U)(()=>this.loading.set(!1))).subscribe({error:a=>{this.notifications.error((0,C.mk)(a)||U.a)}})}formatFormValue(){const a={};return this.form.value.created_at&&(a.created_at_from=this.date.transform(this.form.value.created_at.from.toUtcNativeDate(),"yyyy-MM-dd")||"",a.created_at_to=this.date.transform(this.form.value.created_at.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.datetime&&(a.datetime_from=this.date.transform(this.form.value.datetime.from.toUtcNativeDate(),"yyyy-MM-dd")||"",a.datetime_to=this.date.transform(this.form.value.datetime.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.status&&(0,P.s)(this.form.value.status)&&(a.status=this.form.value.status),a}static#e=this.\u0275fac=function(f){return new(f||E)};static#t=this.\u0275cmp=e.In1({type:E,selectors:[["app-export-reservations-modal"]],standalone:!0,features:[e.M5G([t.UF]),e.UHJ],decls:27,vars:10,consts:()=>{let a,f,p,I,$,L,x;return a="Export reservations",f="Booking status",p="Booking creation date",I="Booking date",$="(date when people come to eat)",L="Download Excel",x="Cancel",[a,[3,"formGroup","ngSubmit"],[1,"block","mb-3"],[3,"formControlName"],f,[3,"errors"],p,I,[1,"text-slate-400"],$,[1,"flex","items-center","justify-center"],["type","submit","tuiButton","","appearance","primary",1,"me-2",3,"disabled","showLoader"],L,["type","button","routerLink","..","tuiButton","","appearance","icon",3,"disabled"],x]},template:function(f,p){1&f&&(e.I0R(0,"h1"),e.aS0(1,0),e.C$Y(),e.I0R(2,"form",1),e.qCj("ngSubmit",function(){return p.export()}),e.I0R(3,"div",2)(4,"app-reservation-status-select",3),e.SAx(5),e.aS0(6,4),e.k70(),e.C$Y(),e.wR5(7,"app-errors",5),e.C$Y(),e.I0R(8,"div",2)(9,"app-date-period",3)(10,"span"),e.aS0(11,6),e.C$Y()(),e.wR5(12,"app-errors",5),e.C$Y(),e.I0R(13,"div",2)(14,"app-date-period",3)(15,"span"),e.aS0(16,7),e.C$Y()(),e.I0R(17,"span",8),e.aS0(18,9),e.C$Y(),e.wR5(19,"app-errors",5),e.C$Y(),e.I0R(20,"div",10)(21,"button",11),e.SAx(22),e.aS0(23,12),e.k70(),e.C$Y(),e.I0R(24,"button",13),e.SAx(25),e.aS0(26,14),e.k70(),e.C$Y()()()),2&f&&(e.yG2(2),e.E7m("formGroup",p.form),e.yG2(2),e.E7m("formControlName","status"),e.yG2(3),e.E7m("errors",p.form.controls.status.errors),e.yG2(2),e.E7m("formControlName","created_at"),e.yG2(3),e.E7m("errors",p.form.controls.created_at.errors),e.yG2(2),e.E7m("formControlName","datetime"),e.yG2(5),e.E7m("errors",p.form.controls.datetime.errors),e.yG2(2),e.E7m("disabled",p.form.disabled)("showLoader",p.loading()),e.yG2(3),e.E7m("disabled",p.form.disabled||p.loading()))},dependencies:[S,_.sl,_.sz,_.ue,_.u,_.uW,_.Wo,D.CI,D.Kw,A.g,l.Y,c.qQ,c.ER],encapsulation:2})}return E})(),V=(()=>{class E{static#e=this.\u0275fac=function(f){return new(f||E)};static#t=this.\u0275mod=e.a4G({type:E});static#r=this.\u0275inj=e.s3X({imports:[c.qQ.forChild([(0,n.VV)(F,{path:"",closeable:!0,dismissible:!0,size:"m"})])]})}return E})()},9956:(y,h,o)=>{o.d(h,{g:()=>A});var c=o(1368),n=o(4496),e=o(9938),_=o(2528),i=o(7308),r=o(7012),s=o(3972),t=o(5944),u=o(1040);function d(m,g){if(1&m&&(n.SAx(0),n.OEk(1),n.k70()),2&m){const l=g.polymorpheusOutlet;n.yG2(),n.oRS(" ",l," ")}}const R=()=>({});function O(m,g){if(1&m&&(n.I0R(0,"div",1),n.wVc(1,"async"),n.yuY(2,d,2,1,"ng-container",2),n.wVc(3,"async"),n.C$Y()),2&m){const l=n.GaO();n.eAK("t-message-text_light","onDark"===n.kDX(1,6,l.mode$)),n.E7m("@tuiFadeIn",l.animation)("@tuiHeightCollapse",l.animation),n.yG2(2),n.E7m("polymorpheusOutlet",l.error.message||n.kDX(3,8,l.defaultErrorMessage$))("polymorpheusOutletContext",l.error.context||n.q4q(10,R))}}let T=(()=>{class m{constructor(l,v,C){this.animation=l,this.mode$=v,this.defaultErrorMessage$=C,this.error=null,this.visible=!0}set errorSetter(l){this.error=(0,_.gT)(l)?new i.E(l):l}onAnimation(l){this.visible=l}}return m.\u0275fac=function(l){return new(l||m)(n.GI1(t.kp),n.GI1(t.Yx),n.GI1(t.cX))},m.\u0275cmp=n.In1({type:m,selectors:[["tui-error"]],hostBindings:function(l,v){1&l&&n.qCj("animationcancel.self",function(){return v.onAnimation(!1)})("animationstart.self",function(){return v.onAnimation(!0)})},inputs:{errorSetter:[n.Wk5.None,"error","errorSetter"]},features:[n.M5G([s.Ir])],decls:1,vars:1,consts:[["automation-id","tui-error__text","class","t-message-text",3,"t-message-text_light",4,"ngIf"],["automation-id","tui-error__text",1,"t-message-text"],[4,"polymorpheusOutlet","polymorpheusOutletContext"]],template:function(l,v){1&l&&n.yuY(0,O,4,11,"div",0),2&l&&n.E7m("ngIf",v.error&&v.visible)},dependencies:[c.u_,u.Af,c.a],styles:["[_nghost-%COMP%]{font:var(--tui-font-text-s);color:var(--tui-text-01);display:block;color:var(--tui-negative);word-wrap:break-word;animation:tuiPresent 1s infinite}.t-message-text[_ngcontent-%COMP%]{margin-top:.25rem;white-space:pre-line}.t-message-text_light[_ngcontent-%COMP%]{color:var(--tui-negative-night)}"],data:{animation:[r.iY,r.K2]},changeDetection:0}),m})(),M=(()=>{class m{}return m.\u0275fac=function(l){return new(l||m)},m.\u0275mod=n.a4G({type:m}),m.\u0275inj=n.s3X({imports:[[c.MD,u.Ux]]}),m})();function S(m,g){1&m&&n.wR5(0,"tui-error",0),2&m&&n.E7m("error",g.$implicit)}function P(m,g){1&m&&n.C_f(0)}function D(m,g){1&m&&n.yuY(0,P,1,0,"ng-container",1),2&m&&n.E7m("ngTemplateOutlet",g.$implicit)}let A=(()=>{class m{constructor(){this._errors=null}get errors(){return this._errors}set errors(l){this._errors=l}allErrors(){return this.errors||null}errorsToTemplates(){return e.y.formatErrors(this.errors||null).filter(l=>l&&l instanceof n.Yw2)}errorsToStr(){return e.y.formatErrors(this.errors||null).filter(l=>l&&"string"==typeof l)}static#e=this.\u0275fac=function(v){return new(v||m)};static#t=this.\u0275cmp=n.In1({type:m,selectors:[["app-errors"]],inputs:{errors:"errors"},standalone:!0,features:[n.UHJ],decls:4,vars:0,consts:[[3,"error"],[4,"ngTemplateOutlet"]],template:function(v,C){1&v&&(n.c53(0,S,1,1,"tui-error",0,n.oxv),n.c53(2,D,1,1,"ng-container",null,n.oxv)),2&v&&(n.oho(C.errorsToStr()),n.yG2(2),n.oho(C.errorsToTemplates()))},dependencies:[c.MD,c.XV,M,T]})}return m})()},8128:(y,h,o)=>{function c(n){if(!n)return null;const e=n.match(/filename="(.+)"/);return e?e[1]:null}o.d(h,{k:()=>c})},8256:(y,h,o)=>{function c(i,r){return i.error?.message?i.error.message:500==i.status?`${i.error.error} ${i.error.exception}`.replace(/\</gm,"").replace(/\>+/gm,""):504==i.status?"Server unreachable, check your connection and try again.":n(function _(i){if("object"==typeof i.error&&"object"==typeof i.error.details&&Array.isArray(i.error.details)&&i.error.details.length>0){const r=i.error.details.filter(s=>"object"==typeof s&&null!=s&&s instanceof Object&&Object.keys(s).length>0).filter(s=>"string"==typeof s.attribute&&s.attribute.length>0&&("string"==typeof s.message&&s.message.length>0||Array.isArray(s.message)&&s.message.length>0));if(r.length>0)return r}return[]}(i),r)}function n(i,r){if(0==i.length)return null;const s=r?.joinChar??", ",t=i.map(u=>`${u.attribute} ${u.message}`);return t.length?function e(i){return[...new Set(i)]}(t).join(s):null}o.d(h,{Yj:()=>n,mk:()=>c})},9938:(y,h,o)=>{o.d(h,{y:()=>_});var c=o(6504);const n={required:"This field cannot be empty!",email:"This email is not valid!",numbersOnly:"Only numbers allowed!",numberOnly:"Only numbers allowed!",numerical:"Only numbers allowed!",invalid_http_url:"Invalid HTTP connection",minlength:i=>"\n           Text too short: Minimum length: \n          " + i.requiredLength + "\n           , current length: \n          " + i.actualLength + "\n        ",InvalidFormat:i=>"\n           \" \n          " + i.value + "\n           \" is not a valid format. Valid example: \" \n          " + i.validExample + "\n           \" \n        ",pattern:i=>"\n           \" \n          " + i.actualValue + "\n           \" is not a valid format. The format must comply with the following\n          regular expression (RegExp): \" \n          " + i.requiredPattern + "\n           \" \n        ",max:i=>"\n           The entered value is too large! Maximum value: \n          " + i.max + "\n           , current value: \n          " + i.actual + "\n        ",min:i=>"\n           The entered value is too small! Minimum value: \n          " + i.min + "\n           , current value: \n          " + i.actual + "\n        ",maxlength:i=>"\n           The entered value is too long! Maximum length: \n          " + i.requiredLength + "\n           , Current length: \n          " + i.actualLength + "\n        ",phoneIT:"\n           This does not seem to be a valid Italian phone number. Example: +39\n          123 456 7890 \n        ",inclusion:i=>{const r=Array.isArray(i)?"\n           The allowed values are: \n          " + i.join(", ") + "\n           . \n        ":"";return "\n           The entered value is not valid. \n          " + r + "\n        "},arrayMinLength:i=>"\n           You must enter at least \n          " + i.requiredLength + "\n           elements. \n        ",passwordConfirmation:"The passwords do not match!",formWeeklyFromTo:"The start time must be earlier than the end time!"},e={assignToFormUnlessControl:!0};class _{static formatErrors(r,s){return null==r||null==r?[]:new _(r,s).formatErrors()}static assignErrorsToForm(r,s,t={}){const u=s.error?.details;if(!u||!Array.isArray(u))return"object"==typeof u&&Object.keys(u).length>0?this.assignErrorsToFormFromJson(r,u,t):void console.warn("invalid errors provided to assignErrorsToForm",u);this.assignErrorsToFormFromArray(r,u,t)}static assignErrorsToFormFromJson(r,s,t={}){const u={...e,...t};Object.keys(s).forEach(d=>{const R=s[d];R&&Array.isArray(R)?R.forEach(O=>{const T=r.controls[d];T?T.setErrors({[O.attribute]:O.message}):u.assignToFormUnlessControl&&r.setErrors({[O.attribute]:O.message})}):console.warn("assignErrorsToFormFromJson expected an array of ActiveError, but got:",R)})}static assignErrorsToFormFromArray(r,s,t={}){const u={...e,...t};s.forEach(d=>{const R=r instanceof c.WC?r.controls[d.attribute]:r;R?R.setErrors({[d.attribute]:d.message}):u.assignToFormUnlessControl&&r.setErrors({[d.attribute]:d.message})})}constructor(r,s=n){this.defaultMessages=n,this.messages={},this.enableLogging=!1,this.errors=r,s?this.mergeMessages(s):this.assignDefaults()}assignDefaults(){this.messages={},Object.keys(this.defaultMessages).forEach(r=>{this.messages[r]=this.defaultMessages[r]})}mergeMessages(r){[...Object.keys(this.defaultMessages),...Object.keys(r)].forEach(t=>{this.messages[t]=r[t]?r[t]:this.defaultMessages[t]})}formatErrors(){return[...this.errorMsgFromControl()]}warn(...r){this.enableLogging&&console.warn(...r)}errorMsgFromControl(){if(null==this.errors||null==this.errors)return[];var r=[];return Object.keys(this.errors).filter(s=>{if("string"==typeof this.errors[s]&&this.errors[s].length>0)return r.push(this.errors[s]);if(this.messages.hasOwnProperty(s)&&this.messages[s]&&null!=this.messages[s]){const d=this.messages[s];switch(typeof d){case"string":default:r.push(d);break;case"function":r.push(d(this.errors[s]))}}else if(this.warn(`ReactiveFormsErrors missing error message of "${s}". Parser error with your custom logic.`),[!0,!1].includes(this.errors[s])){var u={};u[s]=this.errors[s],"string"!=typeof u&&(u=JSON.stringify(u)),r.push(u)}else r.push(this.errors[s])}),r}}},5180:(y,h,o)=>{o.d(h,{C:()=>r});var c=o(8400);class n extends c.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class e extends c.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(u=>new n(u)):[]}}class _ extends c.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(u=>new e(u)):[]}}class i extends c.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.other=t.other}}class r extends c.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new i(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(u=>new _(u)):[]}}},8304:(y,h,o)=>{o.d(h,{S:()=>u});var c=o(6012),n=o(5180),e=o(4704),_=o(3252),i=o(9144),r=o(7048),s=o(8128),t=o(4496);let u=(()=>{class d extends c.s{constructor(){super(n.C,"admin/reservations")}tablesSummary(O={}){return this.get("tables_summary",{params:O})}deliverConfirmationEmail(O){return this.post(`${O}/deliver_confirmation_email`,{}).pipe((0,e.k)(T=>this.mapItem(T)))}export(O){return new _._(T=>{this.get("export",{responseType:"blob",observe:"response",params:O}).pipe((0,i.a)(M=>(console.error("ReservationsService.export() error:",M),T.error(M),new _._))).subscribe(M=>{if(M instanceof r.WA&&M.body){const S=(0,s.k)(M.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",P=M.headers?.get("Content-Type")??"application/octet-stream",D=window.URL.createObjectURL(new Blob([M.body],{type:P})),A=document.createElement("a");A.href=D,A.download=S,A.click(),T.complete()}})})}static#e=this.\u0275fac=function(T){return new(T||d)};static#t=this.\u0275prov=t.wxM({token:d,factory:d.\u0275fac,providedIn:"root"})}return d})()},4736:(y,h,o)=>{o.d(h,{M:()=>_,O:()=>i});var c=o(4496),n=o(5944),e=o(4704);let _=(()=>{class r{constructor(t){this.months$=t}transform({month:t}){return this.months$.pipe((0,e.k)(u=>u[t]))}}return r.\u0275fac=function(t){return new(t||r)(c.GI1(n.GU,16))},r.\u0275pipe=c.UTH({name:"tuiMonth",type:r,pure:!0}),r})(),i=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=c.a4G({type:r}),r.\u0275inj=c.s3X({}),r})()},3984:(y,h,o)=>{o.d(h,{AF:()=>e,Ib:()=>c});class c{constructor(i,r,s){this.range=i,this.name=r,this.content=s}toString(){return this.name}}class e{constructor(i,r){this.item=i,this.stringify=r}toString(){return this.stringify(this.item)}}},812:(y,h,o)=>{o.d(h,{m2:()=>O,mU:()=>t,qS:()=>_,w3:()=>T}),o(4392);var n=o(2528);o(3840);const _={DMY:"dd/mm/yyyy",MDY:"mm/dd/yyyy",YMD:"yyyy/mm/dd"},t=/\([#]+\)|[#\- ]/g,O=(S,P,D,A)=>{if(!P?.isSingleDay||!D)return S;const m=(0,n.Kw)(Object.entries(D).map(([l,v])=>[l,-v])),g=P.from.append(A?m:D).append({day:A?1:-1});return A?g.dayBefore(S)?S:g:S&&g.dayAfter(S)?S:g},T={HH:23,MM:59,SS:59,MS:999}},796:(y,h,o)=>{o.d(h,{YL:()=>R,g3:()=>O}),o(4736);var n=o(5193),e=o(5944),r=(o(3012),o(2700),o(528)),t=(o(4704),o(4496)),u=o(6504);const R=(0,n.Sk)({limitWidth:"fixed",align:"right"}),O={provide:e.Y9,deps:[[new t.T7N,new t.Yiy,u.Y6]],useFactory:r.Z}}}]);