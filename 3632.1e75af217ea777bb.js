"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[3632],{3632:(R,h,n)=>{n.r(h),n.d(h,{DuplicateDishModule:()=>Z});var o=n(1236),m=n(7552),e=n(4496),T=n(3480),_=n(1712),g=n(1128),a=n(5820),t=n(6504),i=n(9852),s=n(3616),C=n(4704),M=n(6684),u=n(8824),P=n(8256),y=n(8392),$=n(9938),d=n(9956),f=n(8212),r=n(8976),c=n(9880),S=n(1512),A=n(7692),U=n(3580),v=n(2204),L=n(9088),w=n(8676),F=n(2368),V=n(1368);function j(D,H){if(1&D&&(e.I0R(0,"div",6)(1,"p",18),e.aS0(2,19),e.C$Y(),e.I0R(3,"div",20)(4,"tui-radio-block",21),e.SAx(5),e.aS0(6,22),e.k70(),e.C$Y(),e.I0R(7,"tui-radio-block",23),e.SAx(8),e.aS0(9,24),e.k70(),e.C$Y(),e.I0R(10,"tui-radio-block",25),e.OEk(11," No "),e.C$Y()(),e.wR5(12,"app-errors",10),e.C$Y(),e.I0R(13,"div",6)(14,"p",18),e.aS0(15,26),e.C$Y(),e.I0R(16,"div",20)(17,"tui-radio-block",27),e.SAx(18),e.aS0(19,28),e.k70(),e.C$Y(),e.I0R(20,"tui-radio-block",29),e.OEk(21," No "),e.C$Y()(),e.wR5(22,"app-errors",10),e.C$Y(),e.I0R(23,"div",6)(24,"p",18),e.aS0(25,30),e.C$Y(),e.I0R(26,"div",20)(27,"tui-radio-block",31),e.SAx(28),e.aS0(29,32),e.k70(),e.C$Y(),e.I0R(30,"tui-radio-block",33),e.OEk(31," No "),e.C$Y()(),e.wR5(32,"app-errors",10),e.C$Y(),e.I0R(33,"div",6)(34,"p",18),e.aS0(35,34),e.C$Y(),e.I0R(36,"div",20)(37,"tui-radio-block",35),e.SAx(38),e.aS0(39,36),e.k70(),e.C$Y(),e.I0R(40,"tui-radio-block",37),e.OEk(41," No "),e.C$Y()(),e.wR5(42,"app-errors",10),e.C$Y()),2&D){const l=e.GaO();e.yG2(3),e.E7m("collapsed",!0),e.yG2(),e.E7m("hideRadio",!0),e.yG2(3),e.E7m("hideRadio",!0),e.yG2(3),e.E7m("hideRadio",!0),e.yG2(2),e.E7m("errors",l.e("copy_images")),e.yG2(4),e.E7m("collapsed",!0),e.yG2(),e.E7m("hideRadio",!0),e.yG2(3),e.E7m("hideRadio",!0),e.yG2(2),e.E7m("errors",l.e("copy_ingredients")),e.yG2(4),e.E7m("collapsed",!0),e.yG2(),e.E7m("hideRadio",!0),e.yG2(3),e.E7m("hideRadio",!0),e.yG2(2),e.E7m("errors",l.e("copy_tags")),e.yG2(4),e.E7m("collapsed",!0),e.yG2(),e.E7m("hideRadio",!0),e.yG2(3),e.E7m("hideRadio",!0),e.yG2(2),e.E7m("errors",l.e("copy_allergens"))}}const Q=(D,H)=>({categoryId:D,itemId:H});let J=(()=>{class D{constructor(){this.destroy$=(0,e.uUt)(T.UF),this.router=(0,e.uUt)(o.E5),this.route=(0,e.uUt)(o.gV),this.service=(0,e.uUt)(_.S),this.dishesService=(0,e.uUt)(w.k),this.notifications=(0,e.uUt)(g.E),this.urlTo=(0,e.uUt)(L.S),this.submitted=!1,this.category=(0,e.OCB)(null),this.dish=(0,e.OCB)(null),this.form=new t.WC({category:new t.Ku(null,[t.AQ.required,i.S.instanceof(a.Q)]),copy_images:new t.Ku("full",[t.AQ.required,i.S.in(["full","link","none"])]),copy_ingredients:new t.Ku("link",[t.AQ.required,i.S.in(["link","none"])]),copy_tags:new t.Ku("link",[t.AQ.required,i.S.in(["link","none"])]),copy_allergens:new t.Ku("link",[t.AQ.required,i.S.in(["link","none"])])}),this.loadingCategory=(0,e.OCB)(!1),this.loadingDish=(0,e.OCB)(!1),this.saving=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.saving()||this.loadingDish()||this.loadingCategory()),this.e=this.getErrorsFor}ngOnInit(){this.route.parent?.parent?.params.pipe((0,s.a)(this.destroy$),(0,C.k)(l=>Number(l.category_id)),(0,M.I)(l=>"number"==typeof l&&!isNaN(l)&&l>0)).subscribe({next:l=>this.loadCategory(l)}),this.route.params.pipe((0,s.a)(this.destroy$),(0,C.k)(l=>Number(l.dish_id)),(0,M.I)(l=>"number"==typeof l&&!isNaN(l)&&l>0)).subscribe({next:l=>this.loadDish(l)})}submit(){if(this.submitted=!0,this.form.invalid)return;const l=this.dish()?.id,E=this.formValue(),p=E.category_id;if(!l||!p)throw new Error(`some invalid id: dishId=${l}; categoryId=${p}`);this.saving.set(!0),this.dishesService.copy(l,E).pipe((0,s.a)(this.destroy$),(0,u.U)(()=>this.saving.set(!1))).subscribe({next:O=>{this.notifications.fireSnackBar("Duplicato.");const N=this.urlTo.transform({itemId:O.id,categoryId:p},"dish.show");N?this.router.navigateByUrl(N):(console.error("no url for dish",O,p),this.navigateBack())},error:O=>{this.manageError(O)}})}cancel(){(this.form.touched||this.form.dirty)&&!confirm("Sei sicuro di voler annullare le modifiche fatte?")||(this.notifications.fireSnackBar("Operazione annullata"),this.navigateBack())}formValue(){return{copy_tags:this.form.value.copy_tags,copy_images:this.form.value.copy_images,copy_ingredients:this.form.value.copy_ingredients,copy_allergens:this.form.value.copy_allergens,category_id:this.form.value.category?.id}}navigateBack(){this.router.navigate([".."],{relativeTo:this.route})}manageError(l){422==l.status?$.y.assignErrorsToForm(this.form,l):this.notifications.error((0,P.mk)(l)||y.a)}getErrorsFor(l){const E=this.form.get(l);return E&&(this.submitted||E.touched||E.dirty)?E.errors:null}loadCategory(l){l&&(this.loadingCategory.set(!0),this.service.show(l).pipe((0,s.a)(this.destroy$),(0,u.U)(()=>this.loadingCategory.set(!1))).subscribe({next:E=>{this.category.set(E),!this.form.touched&&!this.form.dirty&&this.form.patchValue({category:E})},error:E=>{this.notifications.error((0,P.mk)(E)||y.a)}}))}loadDish(l){l&&(this.loadingDish.set(!0),this.dishesService.show(l).pipe((0,s.a)(this.destroy$),(0,u.U)(()=>this.loadingDish.set(!1))).subscribe({next:E=>this.dish.set(E),error:E=>{this.notifications.error((0,P.mk)(E)||y.a)}}))}static#e=this.\u0275fac=function(E){return new(E||D)};static#t=this.\u0275cmp=e.In1({type:D,selectors:[["app-duplicate-dish"]],standalone:!0,features:[e.M5G([T.UF,L.S]),e.UHJ],decls:30,vars:18,consts:()=>{let l,E,p,O,N,B,G,x,k,z,W,X,K,Y,b;return l="Copia piatto",E="Associa il nuovo piatto alla categoria",p="Seleziona una categoria",O="Dettagli",N="Conferma",B="Annulla",G="Copiare immagini?",x="Copia",k="Associa esistenti",z="Copiare ingredienti?",W="Associa esistenti",X="Copiare tag?",K="Associa esistenti",Y="Copiare allergeni?",b="Associa esistenti",[["size","l",3,"showLoader","overlay"],[1,"flex","items-center"],l,[1,"ml-2"],["tuiLink","",3,"routerLink"],[3,"formGroup","ngSubmit"],[1,"mb-3"],E,[3,"formControlName"],p,[3,"errors"],O,["tuiAccordionItemContent",""],[3,"innerText"],["type","submit","size","l","tuiButton","",1,"me-2",3,"appearance"],N,["type","button","size","l","tuiButton","",1,"me-2",3,"appearance","click"],B,[1,"mb-1"],G,["tuiGroup","",1,"group",3,"collapsed"],["contentAlign","right","formControlName","copy_images","item","full","size","l",3,"hideRadio"],x,["contentAlign","right","formControlName","copy_images","item","link","size","l",3,"hideRadio"],k,["contentAlign","right","formControlName","copy_images","item","none","size","l",3,"hideRadio"],z,["contentAlign","right","formControlName","copy_ingredients","item","link","size","l",3,"hideRadio"],W,["contentAlign","right","formControlName","copy_ingredients","item","none","size","l",3,"hideRadio"],X,["contentAlign","right","formControlName","copy_tags","item","link","size","l",3,"hideRadio"],K,["contentAlign","right","formControlName","copy_tags","item","none","size","l",3,"hideRadio"],Y,["contentAlign","right","formControlName","copy_allergens","item","link","size","l",3,"hideRadio"],b,["contentAlign","right","formControlName","copy_allergens","item","none","size","l",3,"hideRadio"]]},template:function(E,p){if(1&E&&(e.I0R(0,"tui-loader",0)(1,"div",1)(2,"h1"),e.aS0(3,2),e.C$Y(),e.I0R(4,"span",3)(5,"a",4),e.wVc(6,"urlTo"),e.OEk(7),e.C$Y()()(),e.I0R(8,"form",5),e.qCj("ngSubmit",function(){return p.submit()}),e.I0R(9,"div",6)(10,"p"),e.aS0(11,7),e.C$Y(),e.I0R(12,"app-menu-category-select",8),e.SAx(13),e.aS0(14,9),e.k70(),e.C$Y(),e.wR5(15,"app-errors",10),e.C$Y(),e.I0R(16,"tui-accordion",6)(17,"tui-accordion-item"),e.SAx(18),e.aS0(19,11),e.k70(),e.yuY(20,j,43,17,"ng-template",12),e.C$Y()(),e.wR5(21,"pre",13),e.wVc(22,"json"),e.I0R(23,"div",1)(24,"button",14),e.SAx(25),e.aS0(26,15),e.k70(),e.C$Y(),e.I0R(27,"button",16),e.qCj("click",function(){return p.cancel()}),e.SAx(28),e.aS0(29,17),e.k70(),e.C$Y()()()()),2&E){let O,N;e.E7m("showLoader",p.loading())("overlay",!0),e.yG2(5),e.E7m("routerLink",e.g7$(6,10,e.IBC(15,Q,null==(O=p.category())?null:O.id,null==(O=p.dish())?null:O.id),"dish.show")),e.yG2(2),e.cNF(null==(N=p.dish())?null:N.name),e.yG2(),e.E7m("formGroup",p.form),e.yG2(4),e.E7m("formControlName","category"),e.yG2(3),e.E7m("errors",p.e("category")),e.yG2(6),e.E7m("innerText",e.kDX(22,13,p.formValue())),e.yG2(3),e.E7m("appearance","primary"),e.yG2(3),e.E7m("appearance","outline")}},dependencies:[d.g,f.CI,f.Kw,U.W,U.I,t.sl,t.sz,t.ue,t.u,t.uW,t.Wo,r.Gy,r.Ko,c.kh,o.ER,S.w,S.C,L.S,F.a,v.Ep,v.Ix,v._Q,v.Up,V.ED,A.Sk,A.Cb],changeDetection:0})}return D})(),Z=(()=>{class D{static#e=this.\u0275fac=function(E){return new(E||D)};static#t=this.\u0275mod=e.a4G({type:D});static#n=this.\u0275inj=e.s3X({imports:[o.qQ.forChild([(0,m.VV)(J,{path:"",closeable:!0,dismissible:!1,size:"l"})])]})}return D})()},9852:(R,h,n)=>{n.d(h,{S:()=>_});var o=n(6504),m=n(400);const e=g=>null!=g&&""!=`${g}`;class _ extends o.AQ{static formWeeklyFromTo(a,t){return i=>{if(!(i instanceof o.WC))return console.warn("formWeeklyFromTo: param is not a FormGroup",i),null;const s=i,C=s.get(a),M=s.get(t);return C&&M&&C.value instanceof m.uc&&M.value instanceof m.uc&&C.value&&M.value&&C.value.toAbsoluteMilliseconds()>=M.value.toAbsoluteMilliseconds()?{formWeeklyFromTo:!0}:null}}static canBeBlankIf(a,t,i){const s=i?.message||"La form non \xE8 valida.";return C=>{if(!(C instanceof o.WC))throw new Error("canBeBlankIf: thisIsAFormGroup is not a FormGroup");const u=C.get(a);if(!u)throw new Error("canBeBlankIf: control is blank. control name: "+a);return e(u.value)||t()?null:{[`${a}canBeBlankIf`]:s}}}static listOfEmails(a){const t=a.value;if(!t||"string"!=typeof t||!t.length)return null;const i=new RegExp("^[a-z0-9._%+-]+@[a-z0-9.-]+.[a-z]{2,4}$","i");return t.split(/\,|\s+/gm).map(s=>s.trim()).filter(s=>s.length).forEach(s=>{if(!i.test(s))return{listOfEmails:!0}}),null}static mustBeArray(a){return Array.isArray(a.value)?null:{mustBeArray:!0}}static objectNotEmpty(a){return e(a.value)&&"object"==typeof a.value&&0===Object.keys(a.value).length&&0===Object.values(a.value).filter(i=>e(i)).length?{objectNotEmpty:!0}:null}static arrayMinLength(a){return t=>Array.isArray(t.value)&&t.value.length<a?{arrayMinLength:{requiredLength:a,actualLength:t.value?.length??0}}:null}static validateArray(a){return t=>{if(!Array.isArray(t.value))return null;const i={};for(const s of t.value){const C=a(new o.yM(s));C&&Object.assign(i,C)}return Object.keys(i).length?i:null}}static percentage(a){return e(a.value)&&(isNaN(a.value)||a.value<0||a.value>100)?{percentage:!0}:null}static phoneIT(a){const t=s=>s?null:{phoneIT:!0},i=`${a.value}`.trim().replace(/\s+/gm,"").replace(/^\+39/gm,"");return e(i)?t(!((g=i).length<9||isNaN(Number(g))||g.length>14)):t(!0);var g}static instanceof(a){return t=>!e(t.value)||t.value instanceof a?null:{instanceof:!0}}static#e=this.instanceOf=this.instanceof;static numerical(a){return e(a.value)&&isNaN(a.value)?{numerical:!0}:null}static moreThan(a){return t=>t.value<=a?{moreThan:!0}:null}static in(a){return this.inclusion(a)}static inclusion(a){return t=>e(t.value)&&!a.includes(t.value)?{inclusion:!0}:null}}},4824:(R,h,n)=>{n.d(h,{o:()=>e});var o=n(8400),m=n(2264);class e extends o.w{constructor(_){super(_),this.name=_.name,this.description=_.description,this.status=_.status,this.other=_.other,this.translations={..._.translations},_.image&&(this.image=new m.W(_.image))}}},5891:(R,h,n)=>{n.d(h,{S:()=>g});var o=n(8400),m=n(2264),e=n(355),T=n(4824),_=n(532);class g extends o.w{constructor(t){super(t),this.name=t.name,this.description=t.description,this.status=t.status,this.price=t.price,this.translations=t.translations,this.images=t.images?t.images.map(i=>new m.W(i)):[],this.suggestions=t.suggestions?t.suggestions.map(i=>new g(i)):[],this.tags=t.tags?t.tags.map(i=>new e.E(i)):[],this.allergens=t.allergens?t.allergens.map(i=>new T.o(i)):[],this.ingredients=t.ingredients?t.ingredients.map(i=>new _.e(i)):[]}}},532:(R,h,n)=>{n.d(h,{e:()=>e});var o=n(8400),m=n(2264);class e extends o.w{constructor(_){super(_),this.name=_.name,this.description=_.description,this.status=_.status,this.other=_.other,this.translations={..._.translations},_.image&&(this.image=new m.W(_.image))}}},355:(R,h,n)=>{n.d(h,{E:()=>e});var o=n(8400),m=n(2264);class e extends o.w{constructor(_){super(_),this.name=_.name,this.description=_.description,this.status=_.status,this.other=_.other,this.translations={..._.translations},this.color=_.color,_.image&&(this.image=new m.W(_.image))}}},8676:(R,h,n)=>{n.d(h,{k:()=>_});var o=n(6012),m=n(5891),e=n(4704),T=n(4496);let _=(()=>{class g extends o.s{constructor(){super(m.S,"admin/menu/dishes")}updatePrices(t){return(null==t.filters||null==t.filters)&&delete t.filters,this.patch("update_prices",t)}copy(t,i){return this.post(`${t}/copy`,i).pipe((0,e.k)(s=>this.mapItem(s)))}move(t,i){return this.patch(`${t}/move`,i).pipe((0,e.k)(s=>this.mapItem(s)))}moveIngredient(t,i,s){return this.patch(`${t}/ingredients/${i}/move`,{to_index:s}).pipe((0,e.k)(C=>this.mapItem(C)))}moveTag(t,i,s){return this.patch(`${t}/tags/${i}/move`,{to_index:s}).pipe((0,e.k)(C=>this.mapItem(C)))}moveAllergen(t,i,s){return this.patch(`${t}/allergens/${i}/move`,{to_index:s}).pipe((0,e.k)(C=>this.mapItem(C)))}updateStatus(t,i){return this.patch(`${t}/status/${i}`,{}).pipe((0,e.k)(s=>this.mapItem(s)))}addIngredient(t,i){return this.post(`${t}/ingredients/${i}`,{}).pipe((0,e.k)(s=>this.mapItem(s)))}removeIngredient(t,i){return this.delete(`${t}/ingredients/${i}`).pipe((0,e.k)(s=>this.mapItem(s)))}addTag(t,i){return this.post(`${t}/tags/${i}`,{}).pipe((0,e.k)(s=>this.mapItem(s)))}removeTag(t,i){return this.delete(`${t}/tags/${i}`).pipe((0,e.k)(s=>this.mapItem(s)))}addAllergen(t,i){return this.post(`${t}/allergens/${i}`,{}).pipe((0,e.k)(s=>this.mapItem(s)))}removeAllergen(t,i){return this.delete(`${t}/allergens/${i}`).pipe((0,e.k)(s=>this.mapItem(s)))}references(t){return this.get(`${t}/references`).pipe((0,e.k)(i=>i))}addSuggestion(t,i){return this.post(`${t}/suggestions/${i}`,{}).pipe((0,e.k)(s=>this.mapItem(s)))}removeSuggestion(t,i){return this.delete(`${t}/suggestions/${i}`).pipe((0,e.k)(s=>this.mapItem(s)))}static#e=this.\u0275fac=function(i){return new(i||g)};static#t=this.\u0275prov=T.wxM({token:g,factory:g.\u0275fac,providedIn:"root"})}return g})()},9880:(R,h,n)=>{n.d(h,{kP:()=>M,kh:()=>$,st:()=>y});var o=n(4496),m=n(3480),e=n(4392),T=n(3120),_=n(3616),g=n(7692),a=n(1368);const t=["wrapper"];function i(d,f){if(1&d&&(o.I0R(0,"tui-loader",4),o.C_f(1,5),o.C$Y()),2&d){const r=o.GaO(2);o.E7m("overlay",!0)("showLoader",r.loading),o.yG2(),o.E7m("ngTemplateOutlet",r.content)}}function s(d,f){if(1&d&&(o.SAx(0),o._Xx(1),o.yuY(2,i,2,3,"tui-loader",3),o.k70()),2&d){const r=o.GaO();o.yG2(2),o.E7m("ngIf",r.async)("ngIfElse",r.content)}}const C=["*"];let M=(()=>{class d{}return d.\u0275fac=function(r){return new(r||d)},d.\u0275dir=o.Sc5({type:d,selectors:[["","tuiExpandContent",""]]}),d})();let y=(()=>{class d{constructor(r,c){this.cdr=r,this.destroy$=c,this.state=0,this.async=!1,this.content=null,this.expanded=null}set expandedSetter(r){if(null!==this.expanded)return 0!==this.state?(this.expanded=r,void(this.state=3)):(this.expanded=r,void this.retrigger(this.async&&r?1:3));this.expanded=r}get overflow(){return 0!==this.state}get loading(){return!!this.expanded&&this.async&&1===this.state}get height(){const{expanded:r,state:c,contentWrapper:S}=this;return r&&2===c||!r&&3===c?0:S&&(!r&&2===c||r&&3===c)?S.nativeElement.offsetHeight:S&&r&&1===c?Math.max(S.nativeElement.offsetHeight,48):null}get contentVisible(){return this.expanded||0!==this.state}onTransitionEnd({propertyName:r}){"opacity"===r&&3===this.state&&(this.state=0)}onExpandLoaded(r){r.stopPropagation(),1===this.state&&this.retrigger(3)}retrigger(r){this.state=2,(0,T.k)(0).pipe((0,_.a)(this.destroy$)).subscribe(()=>{2===this.state&&(this.state=r,this.cdr.markForCheck())})}}return d.\u0275fac=function(r){return new(r||d)(o.GI1(o.kD9),o.GI1(m.UF,2))},d.\u0275cmp=o.In1({type:d,selectors:[["tui-expand"]],contentQueries:function(r,c,S){if(1&r&&o.szK(S,M,5,o.Yw2),2&r){let A;o.wto(A=o.Gqi())&&(c.content=A.first)}},viewQuery:function(r,c){if(1&r&&o.CC$(t,5),2&r){let S;o.wto(S=o.Gqi())&&(c.contentWrapper=S.first)}},hostVars:9,hostBindings:function(r,c){1&r&&o.qCj("transitionend.self",function(A){return c.onTransitionEnd(A)})("tui-expand-loaded",function(A){return c.onExpandLoaded(A)}),2&r&&(o.e48("aria-expanded",c.expanded),o.m4B("height",c.height,"px"),o.eAK("_expanded",c.expanded)("_overflow",c.overflow)("_loading",c.loading))},inputs:{async:"async",expandedSetter:[o.Wk5.None,"expanded","expandedSetter"]},features:[o.M5G([m.UF])],ngContentSelectors:C,decls:3,vars:3,consts:[[1,"t-wrapper"],["wrapper",""],[4,"ngIf"],["size","l",3,"overlay","showLoader",4,"ngIf","ngIfElse"],["size","l",3,"overlay","showLoader"],[3,"ngTemplateOutlet"]],template:function(r,c){1&r&&(o.kPM(),o.I0R(0,"div",0,1),o.yuY(2,s,3,2,"ng-container",2),o.C$Y()),2&r&&(o.E7m("@tuiParentAnimation",void 0)("@.disabled",c.overflow),o.yG2(2),o.E7m("ngIf",c.contentVisible))},dependencies:[g.Cb,a.u_,a.XV],styles:['[_nghost-%COMP%]{transition-property:opacity,height,visibility;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;display:block;opacity:0;transition-delay:1ms}._overflow[_nghost-%COMP%]{overflow:hidden}._expanded[_nghost-%COMP%]{opacity:1;transform:translate(0)}._loading[_nghost-%COMP%]{opacity:.99}.t-wrapper[_ngcontent-%COMP%]:before, .t-wrapper[_ngcontent-%COMP%]:after{content:"";display:table}'],data:{animation:[e.cI]},changeDetection:0}),d})(),$=(()=>{class d{}return d.\u0275fac=function(r){return new(r||d)},d.\u0275mod=o.a4G({type:d}),d.\u0275inj=o.s3X({imports:[[a.MD,g.Sk]]}),d})()}}]);