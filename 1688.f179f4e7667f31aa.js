"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[1688],{1744:(f,c,r)=>{r.d(c,{t:()=>H});var l=r(1368),t=r(4496),u=r(6504),_=r(2516),a=r(7556),i=r(3480),m=r(6732),y=r(7692),T=r(466),P=r(5193),E=r(1673),g=r(8212),v=r(6528),D=r(3616),x=r(8824),R=r(4704),$=r(9144),w=r(2700);let N=(()=>{class o{transform(e){return n=>n?.dayOfWeek(!1)!=e}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275pipe=t.UTH({name:"tuiWeekdayHandler",type:o,pure:!0,standalone:!0})}return o})();var G=r(964),U=r(9160);let F=(()=>{class o{transform(e,n){return!(!e||!n)&&e.getTime()>n.getTime()}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275pipe=t.UTH({name:"dateAfter",type:o,pure:!0,standalone:!0})}return o})();const A=(o,d)=>d.id,O=()=>[];function I(o,d){if(1&o){const e=t.KQA();t.I0R(0,"tui-calendar",11),t.qCj("dayClick",function(s){t.usT(e);const p=t.GaO(3).$implicit,h=t.GaO(2);return t.CGJ(h.triggerDate(p.id,s))}),t.wVc(1,"tuiWeekdayHandler"),t.C$Y()}if(2&o){const e=t.GaO().tuiLet,n=t.GaO(2).$implicit;let s;t.E7m("disabledItemHandler",t.kDX(1,2,n.weekday))("value",null!==(s=e)&&void 0!==s?s:t.q4q(4,O))}}const L=o=>({"text-slate-400":o});function k(o,d){if(1&o&&(t.I0R(0,"span",13),t.wVc(1,"dateAfter"),t.wVc(2,"fromTuiDay"),t.OEk(3),t.wVc(4,"date"),t.wVc(5,"fromTuiDay"),t.C$Y()),2&o){const e=d.$implicit,n=t.GaO(6);t.E7m("ngClass",t.S45(12,L,!t.g7$(1,2,t.kDX(2,5,e),n.today))),t.yG2(3),t.cNF(t.g7$(4,7,t.kDX(5,10,e),"d MMMM y"))}}function b(o,d){1&o&&(t.I0R(0,"span",14),t.aS0(1,15),t.C$Y())}function Y(o,d){if(1&o&&(t.I0R(0,"tui-hosted-dropdown",12)(1,"button",16),t.SAx(2),t.aS0(3,17),t.k70(),t.C$Y()()),2&o){t.GaO(2);const e=t.Gew(2);t.E7m("content",e)}}function K(o,d){if(1&o&&(t.I0R(0,"div",5),t.c53(1,k,6,14,"span",18,t.oxv,!1,b,2,0,"span",19),t.yuY(4,Y,4,1,"tui-hosted-dropdown",12),t.C$Y()),2&o){const e=t.GaO().tuiLet,n=t.GaO(4);let s;t.yG2(),t.oho(null!==(s=e)&&void 0!==s?s:t.q4q(2,O)),t.yG2(3),t.C0Y(4,n.editable?4:-1)}}function z(o,d){if(1&o){const e=t.KQA();t.SAx(0),t.yuY(1,I,2,5,"ng-template",null,7,t.gJz),t.I0R(3,"div",8)(4,"tui-checkbox-block",9),t.qCj("ngModelChange",function(){t.usT(e);const s=t.GaO(2).$implicit,p=t.GaO(2);return t.CGJ(p.triggerSelection(s.id))}),t.OEk(5),t.C$Y(),t.yuY(6,K,5,3,"div",10),t.C$Y(),t.k70()}if(2&o){const e=d.tuiLet,n=t.GaO(2).$implicit,s=t.GaO(2);t.yG2(4),t.E7m("readOnly",!s.editable)("ngModel",void 0!==e),t.yG2(),t.oRS(" ",n.name," "),t.yG2(),t.C0Y(6,null!=e?6:-1)}}function B(o,d){if(1&o&&t.yuY(0,z,7,4,"ng-container",6),2&o){const e=t.GaO().$implicit,n=t.GaO(2);t.E7m("tuiLet",n.selections()[e.id])}}function W(o,d){1&o&&t.yuY(0,B,1,1,"ng-container"),2&o&&t.C0Y(0,d.$implicit.id?0:-1)}function V(o,d){if(1&o&&(t.I0R(0,"tr",2)(1,"td",3)(2,"p",4),t.OEk(3),t.wVc(4,"weekday"),t.C$Y()(),t.I0R(5,"td",3)(6,"div",5),t.c53(7,W,1,1,null,null,A),t.C$Y()()()),2&o){const e=d.$implicit,n=t.GaO();t.yG2(3),t.cNF(t.kDX(4,1,e)),t.yG2(4),t.oho(n.turnsPerDay()[e])}}let H=(()=>{class o{constructor(){this.turnsService=(0,t.uUt)(a.K),this.destroy$=(0,t.uUt)(i.UF),this.date=(0,t.uUt)(l.y),this.outputMamiChanges=new t._w7,this.loading=(0,t.OCB)(!1),this.selections=(0,t.OCB)({}),this.today=new Date,this.editable$=(0,t.OCB)(!1),this.allTurns=(0,t.OCB)([]),this.turnsPerDay=(0,t.S6b)(()=>{const e=this.allTurns().filter(s=>null!=s.weekday),n={};for(const s of e){if(null==s.weekday||null==s.weekday)throw new Error("Turns must have a weekday");(this.editable$()||s.id&&Object.keys(this.selections()).includes(s.id.toString()))&&(n[s.weekday]||=[],n[s.weekday].push(s))}return n}),this.weekdays=(0,t.S6b)(()=>Object.keys(this.turnsPerDay()).map(Number)),this.lastOutput=null}set turns(e){this.selections.update(n=>(e.forEach(s=>{if(!s.id)throw new Error("Turn id is missing");n[s.id]||=[]}),n))}set dates(e){this.selections.update(n=>(e.forEach(s=>{if(!s.reservation_turn_id)throw new Error("Turn id is missing");if(!s.date)throw new Error("Date is missing or invalid",s.date);n[s.reservation_turn_id]||=[],n[s.reservation_turn_id].push((0,G._0)(s.date))}),n))}set editable(e){this.editable$.set(e)}get editable(){return this.editable$()}set item(e){this.selections.set({}),this.turns=e?.turns??[],this.dates=e?.dates??[]}ngOnInit(){this.searchTurns()}triggerSelection(e){this.selections.update(n=>(e in n?delete n[e]:n[e]=[],n)),this.emitChanges()}triggerDate(e,n){if(!e)throw new Error("Invalid turn id"+e);if(!n)throw new Error("Invalid day"+n);this.selections.update(s=>{s[e]||=[];const p=s[e].findIndex(h=>h.day===n.day);return-1===p?s[e].push(n):s[e].splice(p,1),s[e]=s[e].sort((h,C)=>h.dayAfter(C)?1:-1),s}),this.emitChanges()}emitChanges(){const e=[],n=[],s=this.selections();Object.keys(s).forEach(h=>{const C=parseInt(h);if(0===s[C].length)n.push(C);else for(const M of s[C]){const S=this.date.transform(M.toUtcNativeDate(),"yyyy-MM-dd");S?e.push({turn_id:C,date:S}):console.error("Invalid date",M)}});const p={dates:e,turns:n};(null===this.lastOutput||JSON.stringify(this.lastOutput)!==JSON.stringify(p))&&this.outputMamiChanges.emit(p)}searchTurns(){this.loading.set(!0),this.turnsService.search({per_page:1e3}).pipe((0,D.a)(this.destroy$),(0,x.U)(()=>this.loading.set(!1)),(0,R.k)(e=>e.items),(0,$.a)(e=>(console.error(e),(0,w.of)([])))).subscribe({next:e=>{this.allTurns.set(e)}})}static#t=this.\u0275fac=function(n){return new(n||o)};static#e=this.\u0275cmp=t.In1({type:o,selectors:[["app-select-turns-paymentv2"]],inputs:{turns:"turns",dates:"dates",editable:"editable",item:"item"},outputs:{outputMamiChanges:"outputMamiChanges"},standalone:!0,features:[t.M5G([i.UF]),t.UHJ],decls:5,vars:2,consts:()=>{let e,n;return e="Sempre",n="Modifica date",[["size","xl",3,"overlay","showLoader"],[1,"tui-table"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__td"],[1,"text-xl"],[1,"flex","flex-col"],[4,"tuiLet"],["selectDatesTemplate",""],[1,"flex","flex-row","items-center","mb-5"],[1,"me-1",3,"readOnly","ngModel","ngModelChange"],["class","flex flex-col"],["tuiPreventDefault","mousedown",3,"disabledItemHandler","value","dayClick"],[3,"content"],[1,"mx-2","mb-1",3,"ngClass"],[1,"text-xl","text-green-500"],e,["tuiButton","","tuiHint","Modifica date","appearance","outline","size","s","type","button"],n,["class","mx-2 mb-1",3,"ngClass"],["class","text-xl text-green-500"],["class","tui-table__tr tui-table__tr_border_none"]]},template:function(n,s){1&n&&(t.I0R(0,"tui-loader",0)(1,"table",1)(2,"tbody"),t.c53(3,V,9,3,"tr",20,t.oxv),t.C$Y()()()),2&n&&(t.E7m("overlay",!0)("showLoader",s.loading()),t.yG2(3),t.oho(s.weekdays()))},dependencies:[_.G,v.i,v.I,u.y,u.ue,u._G,y.Sk,y.Cb,l.y,T.GE,T.Qw,N,P.ms,E.y,E.I,g.CI,g.Kw,m.kR,m.ew,U.E,l.QF,F],changeDetection:0})}return o})()},9772:(f,c,r)=>{r.d(c,{CU:()=>t,ye:()=>u});const l=(new Date).getTimezoneOffset()/60;function t(_,a=l){return"string"==typeof _&&_.length>0&&_.match(/\d{1,2}:\d{1,2}/)?`${Number(_.split(":")[0])-a}:${_.split(":")[1]}`:(console.error("Invalid string provided to strTimeTimezone",{string:_}),"")}function u(_,a=l){return t(_,-1*a)}},1960:(f,c,r)=>{r.d(c,{u:()=>_});var l=r(8400),t=r(5136);class u extends l.w{constructor(i){super(i),this.date=i.date?new Date(i.date):void 0,this.reservation_turn_id=i.reservation_turn_id,this.group_id=i.group_id,this.reservation_turn=i.reservation_turn?new t.e(i.reservation_turn):void 0}}class _ extends l.w{constructor(i){super(i),this.turns=[],this.dates=[],this.title=i.title,this.status=i.status,this.preorder_type=i.preorder_type,this.payment_value=i.payment_value,this.message=i.message,this.turns=(i.turns||[]).map(m=>new t.e(m)),this.dates=(i.dates||[]).map(m=>new u(m)),this.translations=i.translations||{}}}},5136:(f,c,r)=>{r.d(c,{e:()=>_});var l=r(8400),t=r(9772),u=r(1960);class _ extends l.w{constructor(i){super(i),this.messages=[],this.name=i.name,this.weekday=i.weekday,this.step=i.step,this.valid_times=i.valid_times,this.starts_at=i.starts_at?(0,t.CU)(i.starts_at):void 0,this.ends_at=i.ends_at?(0,t.CU)(i.ends_at):void 0,this.preorder_reservation_group=i.preorder_reservation_group?new u.u(i.preorder_reservation_group):void 0,this.messages=i.messages}}},9160:(f,c,r)=>{r.d(c,{E:()=>u});var l=r(400),t=r(4496);let u=(()=>{class _{transform(i){return i instanceof Date?i:i instanceof l.EK?i.toUtcNativeDate():null}static#t=this.\u0275fac=function(m){return new(m||_)};static#e=this.\u0275pipe=t.UTH({name:"fromTuiDay",type:_,pure:!0,standalone:!0})}return _})()},2516:(f,c,r)=>{r.d(c,{G:()=>t});var l=r(4496);let t=(()=>{class u{constructor(){this.weekdays=["Domenica","Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato"]}transform(a){return"number"!=typeof a&&"string"==typeof a&&(a=parseInt(a)),"number"==typeof a&&a>=0&&a<=6?this.weekdays[a]:null}static#t=this.\u0275fac=function(i){return new(i||u)};static#e=this.\u0275pipe=l.UTH({name:"weekday",type:u,pure:!0,standalone:!0})}return u})()},4251:(f,c,r)=>{r.d(c,{e:()=>_});var l=r(6012),t=r(1960),u=r(4496);let _=(()=>{class a extends l.s{constructor(){super(t.u,"admin/preorder_reservation_groups")}static#t=this.\u0275fac=function(y){return new(y||a)};static#e=this.\u0275prov=u.wxM({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},7556:(f,c,r)=>{r.d(c,{K:()=>_});var l=r(6012),t=r(5136),u=r(4496);let _=(()=>{class a extends l.s{constructor(){super(t.e,"admin/reservation_turns")}static#t=this.\u0275fac=function(y){return new(y||a)};static#e=this.\u0275prov=u.wxM({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()}}]);