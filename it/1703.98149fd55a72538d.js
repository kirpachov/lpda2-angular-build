"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[1703],{1703:(h,p,t)=>{t.d(p,{q:()=>q});var e=t(4496),i=t(6504),c=t(1236),T=t(8256),u=t(9938),r=t(8392),R=t(1128),g=t(3480),v=t(400),D=t(5e3),N=t(8212),I=t(7692),d=t(9880),A=t(8048),P=t(3797),m=t(9888),a=t(2740),s=t(6052),n=t(5188),_=t(3616),O=t(4e3),M=t(8824),$=t(9956),x=t(7924),F=t(7556),K=t(2516),B=t(1240),U=t(964),G=t(7936),V=t(4336);const k=(l,f)=>f.id;function Y(l,f){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.name.errors)}}function b(l,f){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.weekday.errors)}}const z=()=>[15,30,45,60];function X(l,f){1&l&&e.wR5(0,"tui-data-list-wrapper",20),2&l&&e.E7m("items",e.q4q(1,z))}function Q(l,f){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.step.errors)}}function H(l,f){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.starts_at.errors)}}function j(l,f){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.controls.ends_at.errors)}}function J(l,f){if(1&l&&(e.I0R(0,"div",21),e.OEk(1),e.C$Y()),2&l){const o=f.$implicit;e.yG2(),e.MjK("",o.name,": ",o.starts_at," - ",o.ends_at,"")}}function Z(l,f){if(1&l&&e.wR5(0,"app-errors",4),2&l){const o=e.GaO();e.E7m("errors",o.form.errors)}}let q=(()=>{class l{constructor(){this.service=(0,e.uUt)(F.K),this.destroy$=(0,e.uUt)(g.UF),this.notifications=(0,e.uUt)(R.E),this.route=(0,e.uUt)(c.gV),this.formSubmitted=(0,e.OCB)(!1),this.parentLoading=(0,e.OCB)(!1),this.searching=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.parentLoading()||this.searching()),this._context="create",this.submitted=new e._w7,this.cancelled=new e._w7,this.concurrentData=(0,e.OCB)(null),this.concurrent=(0,e.S6b)(()=>(this.concurrentData()?.items??[]).filter(o=>o.weekday==this.form.value.weekday&&o.id!=this.currentItemId())),this.form=new i.WC({weekday:new i.Ku(null,[i.AQ.required]),starts_at:new i.Ku(null,[i.AQ.required]),ends_at:new i.Ku(null,[i.AQ.required]),step:new i.Ku(30,[i.AQ.required,i.AQ.min(15),i.AQ.max(60)]),name:new i.Ku(null,[i.AQ.required])}),this.formInitialValue=this.form.value,this.currentItemId=(0,e.OCB)(null)}set setParentLoading(o){this.parentLoading.set(o)}set context(o){"update"==o?this.form.controls.weekday.disable():this.form.controls.weekday.enable()}get context(){return this._context}set turn(o){if(this.currentItemId.set(o?.id??null),o){const C={weekday:o.weekday,starts_at:o.starts_at?v.uc.fromString(o.starts_at):null,ends_at:o.ends_at?v.uc.fromString(o.ends_at):null,step:o.step,name:o.name};this.form.patchValue(C)}else this.form.reset(this.formInitialValue)}ngOnInit(){this.form.controls.weekday.valueChanges.pipe((0,_.a)(this.destroy$),(0,O.a)()).subscribe({next:o=>this.searchSameWeekday(o)}),this.route.queryParams.pipe((0,_.a)(this.destroy$)).subscribe({next:o=>{o.weekday&&this.form.controls.weekday.setValue(o.weekday)}})}manageHttpError(o){u.y.assignErrorsToForm(this.form,o),this.notifications.error((0,T.mk)(o)||r.a)}submit(){this.formSubmitted.set(!0),!this.form.invalid&&this.submitted.emit(this.formatOutput())}cancel(){this.cancelled.emit()}formatOutput(){const{ends_at:o,starts_at:C,name:E,step:S}=this.form.value,L={starts_at:C?(0,U.In)(C):null,ends_at:o?(0,U.In)(o):null,name:E??"",step:S??30};return"create"==this.context&&(L.weekday=this.form.controls.weekday.value||0),L}searchSameWeekday(o){null!=o?(this.searching.set(!0),this.service.search({weekday:o,per_page:100}).pipe((0,_.a)(this.destroy$),(0,M.U)(()=>this.searching.set(!1))).subscribe({next:C=>this.concurrentData.set(C)})):this.concurrentData.set(null)}static#e=this.\u0275fac=function(C){return new(C||l)};static#t=this.\u0275cmp=e.In1({type:l,selectors:[["app-reservation-turn-form"]],inputs:{setParentLoading:[e.Wk5.None,"loading","setParentLoading"],context:"context",turn:"turn"},outputs:{submitted:"submitted",cancelled:"cancelled"},standalone:!0,features:[e.UHJ],decls:44,vars:20,consts:()=>{let o,C,E,S,L,w,W;return o="Nome turno",C="Minuti tra una prenotazione e l'altra",E="Dalle ore",S="Fino alle ore",L="Nota che per " + "\ufffd0\ufffd" + " sono presenti anche i seguenti turni:",w="Salva",W="Annulla",[[3,"formGroup","ngSubmit"],[1,"mb-3","block"],["tuiAutoFocus","",3,"formControlName"],o,[3,"errors"],[3,"formControlName"],C,["tuiTextfield",""],[3,"items",4,"tuiDataList"],[1,"flex","items-center"],[1,"me-2","grow"],E,S,[3,"expanded"],[1,"text-slate-400"],L,["type","submit","tuiButton","","appearance","primary",3,"showLoader"],w,["type","button","tuiButton","","appearance","icon",3,"disabled","click"],W,[3,"items"],[1,"block"],["class","block"]]},template:function(C,E){1&C&&(e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return E.submit()}),e.I0R(1,"div",1)(2,"tui-input",2),e.SAx(3),e.aS0(4,3),e.k70(),e.C$Y(),e.yuY(5,Y,1,1,"app-errors",4),e.C$Y(),e.I0R(6,"div",1),e.wR5(7,"app-weekday-select",5),e.yuY(8,b,1,1,"app-errors",4),e.C$Y(),e.I0R(9,"div",1)(10,"tui-select",5),e.SAx(11),e.aS0(12,6),e.k70(),e.wR5(13,"input",7),e.yuY(14,X,1,2,"tui-data-list-wrapper",8),e.C$Y(),e.yuY(15,Q,1,1,"app-errors",4),e.C$Y(),e.I0R(16,"div",1)(17,"div",9)(18,"div",10)(19,"tui-input-time",5),e.SAx(20),e.aS0(21,11),e.k70(),e.C$Y(),e.yuY(22,H,1,1,"app-errors",4),e.C$Y(),e.I0R(23,"div",10)(24,"tui-input-time",5),e.SAx(25),e.aS0(26,12),e.k70(),e.C$Y(),e.yuY(27,j,1,1,"app-errors",4),e.C$Y()(),e.I0R(28,"tui-expand",13)(29,"div",14)(30,"span"),e.aS0(31,15),e.wVc(32,"downcase"),e.wVc(33,"weekday"),e.C$Y(),e.c53(34,J,2,3,"div",22,k),e.C$Y()()(),e.yuY(36,Z,1,1,"app-errors",4),e.I0R(37,"div",9)(38,"button",16),e.SAx(39),e.aS0(40,17),e.k70(),e.C$Y(),e.I0R(41,"button",18),e.qCj("click",function(){return E.cancel()}),e.SAx(42),e.aS0(43,19),e.k70(),e.C$Y()()()),2&C&&(e.E7m("formGroup",E.form),e.yG2(2),e.E7m("formControlName","name"),e.yG2(3),e.C0Y(5,E.formSubmitted()||E.form.controls.name.touched?5:-1),e.yG2(2),e.E7m("formControlName","weekday"),e.yG2(),e.C0Y(8,E.formSubmitted()||E.form.controls.weekday.touched?8:-1),e.yG2(2),e.E7m("formControlName","step"),e.yG2(5),e.C0Y(15,E.formSubmitted()||E.form.controls.step.touched?15:-1),e.yG2(4),e.E7m("formControlName","starts_at"),e.yG2(3),e.C0Y(22,E.formSubmitted()||E.form.controls.starts_at.touched?22:-1),e.yG2(2),e.E7m("formControlName","ends_at"),e.yG2(3),e.C0Y(27,E.formSubmitted()||E.form.controls.ends_at.touched?27:-1),e.yG2(),e.E7m("expanded",E.concurrent().length>0),e.yG2(5),e.oBb(e.kDX(32,16,e.kDX(33,18,E.form.value.weekday))),e.Ylm(31),e.yG2(),e.oho(E.concurrent()),e.yG2(2),e.C0Y(36,E.formSubmitted()?36:-1),e.yG2(2),e.E7m("showLoader",E.loading()),e.yG2(3),e.E7m("disabled",E.loading()))},dependencies:[N.CI,N.Kw,I.Sk,i.sl,i.sz,i.ue,i.u,i.uW,i.Wo,P.CQ,P.Oo,P.cP,G.b,$.g,m.Q7,a.IZ,a.iw,a.gt,x.W,D.m6,D.gJ,K.G,d.kh,d.st,B.e,s.q8,s.OO,V.Ux,A.aS,n.my,n.cP,n.uO],encapsulation:2,changeDetection:0})}return l})()},7924:(h,p,t)=>{t.d(p,{W:()=>P});var e=t(4496),i=t(6504),c=t(3480),T=t(5e3),u=t(8048),r=t(5193),R=t(6052),g=t(5188),v=t(2516),D=t(4336),N=t(7936);function I(m,a){1&m&&(e.OEk(0),e.wVc(1,"weekday")),2&m&&e.cNF(e.kDX(1,1,a.$implicit))}const d=()=>[0,1,2,3,4,5,6];function A(m,a){if(1&m&&e.wR5(0,"tui-data-list-wrapper",5),2&m){e.GaO();const s=e.Gew(1);e.E7m("items",e.q4q(2,d))("itemContent",s)}}let P=(()=>{class m{constructor(){this.control=new i.Ku(null,[i.AQ.min(0),i.AQ.max(6)]),this.initialAutofocus=(0,e.OCB)(!1),this.dropdownOpen=(0,e.OCB)(!1),this.showCleaner=!0}set autofocus(s){this.initialAutofocus.set(!0===s),this.dropdownOpen.set(!0===s)}ngOnChanges(){this.control.valueChanges.subscribe({next:s=>{s&&this.dropdownOpen.set(!1)}})}writeValue(s){let n=null;n="number"==typeof s?s:"string"==typeof s?Number(s):null,this.control.setValue(n)}registerOnChange(s){this.control.valueChanges.subscribe({next:n=>s(n)})}registerOnTouched(s){this.control.valueChanges.subscribe({next:n=>s(n)})}setDisabledState(s){s?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(n){return new(n||m)};static#t=this.\u0275cmp=e.In1({type:m,selectors:[["app-weekday-select"]],inputs:{showCleaner:"showCleaner",autofocus:"autofocus"},standalone:!0,features:[e.M5G([c.UF,{provide:i.Y6,useExisting:m,multi:!0}]),e.SYr,e.UHJ],decls:7,vars:5,consts:()=>{let s;return s="Giorno della settimana",[["selectItem",""],[3,"tuiAutoFocus","tuiDropdownOpen","valueContent","tuiTextfieldCleaner","formControl","tuiDropdownOpenChange"],s,["tuiTextfield",""],[3,"items","itemContent",4,"tuiDataList"],[3,"items","itemContent"]]},template:function(n,_){if(1&n&&(e.yuY(0,I,2,3,"ng-template",null,0,e.gJz),e.I0R(2,"tui-select",1),e.qCj("tuiDropdownOpenChange",function(M){return _.dropdownOpen.set(M)}),e.SAx(3),e.aS0(4,2),e.k70(),e.wR5(5,"input",3),e.yuY(6,A,1,3,"tui-data-list-wrapper",4),e.C$Y()),2&n){const O=e.Gew(1);e.yG2(2),e.E7m("tuiAutoFocus",_.initialAutofocus())("tuiDropdownOpen",_.dropdownOpen())("valueContent",O)("tuiTextfieldCleaner",_.showCleaner)("formControl",_.control)}},dependencies:[R.q8,R.OO,D.Ux,u.aS,u.es,g.my,g.cP,g.uO,N.b,i.sl,i.ue,i.ug,v.G,T.m6,T.gJ,r.ms,r.oL],encapsulation:2})}return m})()},1960:(h,p,t)=>{t.d(p,{u:()=>T});var e=t(8400),i=t(5136);class c extends e.w{constructor(r){super(r),this.date=r.date?new Date(r.date):void 0,this.reservation_turn_id=r.reservation_turn_id,this.group_id=r.group_id,this.reservation_turn=r.reservation_turn?new i.e(r.reservation_turn):void 0}}class T extends e.w{constructor(r){super(r),this.turns=[],this.dates=[],this.title=r.title,this.status=r.status,this.preorder_type=r.preorder_type,this.payment_value=r.payment_value,this.message=r.message,this.turns=(r.turns||[]).map(R=>new i.e(R)),this.dates=(r.dates||[]).map(R=>new c(R)),this.translations=r.translations||{},this.table_type_to_preorder_reservation_groups=r.table_type_to_preorder_reservation_groups}}},5136:(h,p,t)=>{t.d(p,{e:()=>T});var e=t(8400),i=t(9772),c=t(1960);class T extends e.w{constructor(r){super(r),this.messages=[],this.name=r.name,this.weekday=r.weekday,this.step=r.step,this.valid_times=r.valid_times,this.starts_at=r.starts_at?(0,i.CU)(r.starts_at):void 0,this.ends_at=r.ends_at?(0,i.CU)(r.ends_at):void 0,this.preorder_reservation_group=r.preorder_reservation_group?new c.u(r.preorder_reservation_group):void 0,this.messages=r.messages}}},1240:(h,p,t)=>{t.d(p,{e:()=>i});var e=t(4496);let i=(()=>{class c{transform(u){return"string"==typeof u&&u.length>0?u.toLowerCase():null}static#e=this.\u0275fac=function(r){return new(r||c)};static#t=this.\u0275pipe=e.UTH({name:"downcase",type:c,pure:!0,standalone:!0})}return c})()},2516:(h,p,t)=>{t.d(p,{G:()=>i});var e=t(4496);let i=(()=>{class c{constructor(){this.weekdays=["Domenica","Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato"]}transform(u){return"number"!=typeof u&&"string"==typeof u&&(u=parseInt(u)),"number"==typeof u&&u>=0&&u<=6?this.weekdays[u]:null}static#e=this.\u0275fac=function(r){return new(r||c)};static#t=this.\u0275pipe=e.UTH({name:"weekday",type:c,pure:!0,standalone:!0})}return c})()},7556:(h,p,t)=>{t.d(p,{K:()=>T});var e=t(6012),i=t(5136),c=t(4496);let T=(()=>{class u extends e.s{constructor(){super(i.e,"admin/reservation_turns")}static#e=this.\u0275fac=function(g){return new(g||u)};static#t=this.\u0275prov=c.wxM({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},9880:(h,p,t)=>{t.d(p,{kP:()=>I,kh:()=>m,st:()=>P});var e=t(4496),i=t(3480),c=t(4392),T=t(3120),u=t(3616),r=t(7692),R=t(1368);const g=["wrapper"];function v(a,s){if(1&a&&(e.I0R(0,"tui-loader",4),e.C_f(1,5),e.C$Y()),2&a){const n=e.GaO(2);e.E7m("overlay",!0)("showLoader",n.loading),e.yG2(),e.E7m("ngTemplateOutlet",n.content)}}function D(a,s){if(1&a&&(e.SAx(0),e._Xx(1),e.yuY(2,v,2,3,"tui-loader",3),e.k70()),2&a){const n=e.GaO();e.yG2(2),e.E7m("ngIf",n.async)("ngIfElse",n.content)}}const N=["*"];let I=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275dir=e.Sc5({type:a,selectors:[["","tuiExpandContent",""]]}),a})();let P=(()=>{class a{constructor(n,_){this.cdr=n,this.destroy$=_,this.state=0,this.async=!1,this.content=null,this.expanded=null}set expandedSetter(n){if(null!==this.expanded)return 0!==this.state?(this.expanded=n,void(this.state=3)):(this.expanded=n,void this.retrigger(this.async&&n?1:3));this.expanded=n}get overflow(){return 0!==this.state}get loading(){return!!this.expanded&&this.async&&1===this.state}get height(){const{expanded:n,state:_,contentWrapper:O}=this;return n&&2===_||!n&&3===_?0:O&&(!n&&2===_||n&&3===_)?O.nativeElement.offsetHeight:O&&n&&1===_?Math.max(O.nativeElement.offsetHeight,48):null}get contentVisible(){return this.expanded||0!==this.state}onTransitionEnd({propertyName:n}){"opacity"===n&&3===this.state&&(this.state=0)}onExpandLoaded(n){n.stopPropagation(),1===this.state&&this.retrigger(3)}retrigger(n){this.state=2,(0,T.k)(0).pipe((0,u.a)(this.destroy$)).subscribe(()=>{2===this.state&&(this.state=n,this.cdr.markForCheck())})}}return a.\u0275fac=function(n){return new(n||a)(e.GI1(e.kD9),e.GI1(i.UF,2))},a.\u0275cmp=e.In1({type:a,selectors:[["tui-expand"]],contentQueries:function(n,_,O){if(1&n&&e.szK(O,I,5,e.Yw2),2&n){let M;e.wto(M=e.Gqi())&&(_.content=M.first)}},viewQuery:function(n,_){if(1&n&&e.CC$(g,5),2&n){let O;e.wto(O=e.Gqi())&&(_.contentWrapper=O.first)}},hostVars:9,hostBindings:function(n,_){1&n&&e.qCj("transitionend.self",function(M){return _.onTransitionEnd(M)})("tui-expand-loaded",function(M){return _.onExpandLoaded(M)}),2&n&&(e.e48("aria-expanded",_.expanded),e.m4B("height",_.height,"px"),e.eAK("_expanded",_.expanded)("_overflow",_.overflow)("_loading",_.loading))},inputs:{async:"async",expandedSetter:[e.Wk5.None,"expanded","expandedSetter"]},features:[e.M5G([i.UF])],ngContentSelectors:N,decls:3,vars:3,consts:[[1,"t-wrapper"],["wrapper",""],[4,"ngIf"],["size","l",3,"overlay","showLoader",4,"ngIf","ngIfElse"],["size","l",3,"overlay","showLoader"],[3,"ngTemplateOutlet"]],template:function(n,_){1&n&&(e.kPM(),e.I0R(0,"div",0,1),e.yuY(2,D,3,2,"ng-container",2),e.C$Y()),2&n&&(e.E7m("@tuiParentAnimation",void 0)("@.disabled",_.overflow),e.yG2(2),e.E7m("ngIf",_.contentVisible))},dependencies:[r.Cb,R.u_,R.XV],styles:['[_nghost-%COMP%]{transition-property:opacity,height,visibility;transition-duration:var(--tui-duration, .3s);transition-timing-function:ease-in-out;display:block;opacity:0;transition-delay:1ms}._overflow[_nghost-%COMP%]{overflow:hidden}._expanded[_nghost-%COMP%]{opacity:1;transform:translate(0)}._loading[_nghost-%COMP%]{opacity:.99}.t-wrapper[_ngcontent-%COMP%]:before, .t-wrapper[_ngcontent-%COMP%]:after{content:"";display:table}'],data:{animation:[c.cI]},changeDetection:0}),a})(),m=(()=>{class a{}return a.\u0275fac=function(n){return new(n||a)},a.\u0275mod=e.a4G({type:a}),a.\u0275inj=e.s3X({imports:[[R.MD,r.Sk]]}),a})()}}]);