(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[2088],{79740:(v,u,n)=>{"use strict";n.r(u),n.d(u,{ExportReservationsModalModule:()=>G});var _=n(31236),R=n(7552),e=n(54496),i=n(6504),E=n(91368),l=n(400);let d=(()=>{class s{constructor(){this.datePipe=(0,e.uUt)(E.y)}transform(o,r){return o instanceof l.Se?`Dal ${this.datePipe.transform(o.from.toUtcNativeDate(),r)} al ${this.datePipe.transform(o.to.toUtcNativeDate(),r)}`:null}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275pipe=e.UTH({name:"datePeriodSummary",type:s,pure:!0,standalone:!0})}return s})();var t=n(83480),c=n(63984),p=n(70424),y=n(53616),m=n(25288);function O(s,F){if(1&s&&e.OEk(0),2&s){const o=e.GaO();e.oRS(" ",o.label," ")}}function S(s,F){if(1&s&&(e.I0R(0,"small",3),e.OEk(1),e.wVc(2,"datePeriodSummary"),e.C$Y()),2&s){const o=e.GaO();e.yG2(),e.cNF(e.kDX(2,1,o.control.value))}}const T=["*"];let h=(()=>{class s{constructor(){this.destroy$=new t.UF,this.control=new i.Ku(null),this.today=l.EK.currentLocal(),this.tomorrow=l.EK.currentLocal().append({day:1}),this.max=null,this.appProductionDate=l.EK.fromLocalNativeDate(new Date("2023-8-1")),this.endOfCurrentYear=l.EK.fromLocalNativeDate(new Date(`${this.today.year}-12-31`)),this.periodOptions=[new c.Ib(new l.Se(this.today.append({day:-30}),this.today),m.$localize`Ultimo mese`),new c.Ib(new l.Se(this.today.append({day:-365}),this.today),m.$localize`Ultimo anno`),...Array.from({length:5},(o,r)=>r).map(o=>this.today.year-o).filter(o=>o>=this.appProductionDate.year).map(o=>new c.Ib(new l.Se(l.EK.fromLocalNativeDate(new Date(`${o}-01-01`)),l.EK.fromLocalNativeDate(new Date(`${o}-12-31`))),`${o}`))],this.label=m.$localize`Seleziona il periodo temporale`}writeValue(o){if(void 0===o&&(o=null),null===o||o instanceof l.Se)return this.control.setValue(o);console.warn("Invalid value for DatePeriodComponent",o)}registerOnChange(o){this.control.valueChanges.pipe((0,y.a)(this.destroy$)).subscribe((...r)=>o(...r))}registerOnTouched(o){this.control.valueChanges.pipe((0,y.a)(this.destroy$)).subscribe((...r)=>o(...r))}setDisabledState(o){o?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-date-period"]],inputs:{max:"max",label:"label"},standalone:!0,features:[e.M5G([{provide:i.Y6,useExisting:(0,e.wd)(()=>s),multi:!0},t.UF]),e.UHJ],ngContentSelectors:T,decls:6,vars:6,consts:[[3,"min","max","formControl","items"],["content",""],["class","d-block text-muted"],[1,"d-block","text-muted"]],template:function(r,a){if(1&r&&(e.kPM(),e.I0R(0,"tui-input-date-range",0)(1,"span",null,1),e._Xx(3),e.C$Y(),e.yuY(4,O,1,1),e.C$Y(),e.yuY(5,S,3,3,"small",2)),2&r){const P=e.Gew(2);e.E7m("min",a.appProductionDate)("max",a.max)("formControl",a.control)("items",a.periodOptions),e.yG2(4),e.C0Y(4,P.children.length?-1:4),e.yG2(),e.C0Y(5,null!=a.control.value&&a.control.value.from&&null!=a.control.value&&a.control.value.to?5:-1)}},dependencies:[p.uy,p.YZ,p.Ku,i.sl,i.ue,i.ug,d],encapsulation:2})}return s})();var M=n(33564),A=n(58212),I=n(99956),f=n(28304),g=n(68824),D=n(83264),V=n(1128),X=n(38256),U=n(48392);let x=(()=>{class s{constructor(){this.service=(0,e.uUt)(f.S),this.destroy$=(0,e.uUt)(t.UF),this.date=(0,e.uUt)(E.y),this.notifications=(0,e.uUt)(V.E),this.loading=(0,e.OCB)(!1),this.form=new i.WC({created_at:new i.Ku(null),datetime:new i.Ku(null),status:new i.Ku(null)})}export(){this.loading.set(!0),this.service.export(this.formatFormValue()).pipe((0,y.a)(this.destroy$),(0,g.U)(()=>this.loading.set(!1))).subscribe({error:o=>{this.notifications.error((0,X.mk)(o)||U.a)}})}formatFormValue(){const o={};return this.form.value.created_at&&(o.created_at_from=this.date.transform(this.form.value.created_at.from.toUtcNativeDate(),"yyyy-MM-dd")||"",o.created_at_to=this.date.transform(this.form.value.created_at.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.datetime&&(o.datetime_from=this.date.transform(this.form.value.datetime.from.toUtcNativeDate(),"yyyy-MM-dd")||"",o.datetime_to=this.date.transform(this.form.value.datetime.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.status&&(0,M.s)(this.form.value.status)&&(o.status=this.form.value.status),o}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-export-reservations-modal"]],standalone:!0,features:[e.M5G([t.UF]),e.UHJ],decls:27,vars:10,consts:()=>{let o,r,a,P,C,L,$;return o="Esporta prenotazioni",r="Stato prenotazione",a="Data di creazione prenotazione",P="Data di prenotazione prenotazione",C="(data in cui le persone vengono a mangiare)",L="Scarica excel",$="Annulla",[o,[3,"formGroup","ngSubmit"],[1,"block","mb-3"],[3,"formControlName"],r,[3,"errors"],a,P,[1,"text-slate-400"],C,[1,"flex","items-center","justify-center"],["type","submit","tuiButton","","appearance","primary",1,"me-2",3,"disabled","showLoader"],L,["type","button","routerLink","..","tuiButton","","appearance","icon",3,"disabled"],$]},template:function(r,a){1&r&&(e.I0R(0,"h1"),e.aS0(1,0),e.C$Y(),e.I0R(2,"form",1),e.qCj("ngSubmit",function(){return a.export()}),e.I0R(3,"div",2)(4,"app-reservation-status-select",3),e.SAx(5),e.aS0(6,4),e.k70(),e.C$Y(),e.wR5(7,"app-errors",5),e.C$Y(),e.I0R(8,"div",2)(9,"app-date-period",3)(10,"span"),e.aS0(11,6),e.C$Y()(),e.wR5(12,"app-errors",5),e.C$Y(),e.I0R(13,"div",2)(14,"app-date-period",3)(15,"span"),e.aS0(16,7),e.C$Y()(),e.I0R(17,"span",8),e.aS0(18,9),e.C$Y(),e.wR5(19,"app-errors",5),e.C$Y(),e.I0R(20,"div",10)(21,"button",11),e.SAx(22),e.aS0(23,12),e.k70(),e.C$Y(),e.I0R(24,"button",13),e.SAx(25),e.aS0(26,14),e.k70(),e.C$Y()()()),2&r&&(e.yG2(2),e.E7m("formGroup",a.form),e.yG2(2),e.E7m("formControlName","status"),e.yG2(3),e.E7m("errors",a.form.controls.status.errors),e.yG2(2),e.E7m("formControlName","created_at"),e.yG2(3),e.E7m("errors",a.form.controls.created_at.errors),e.yG2(2),e.E7m("formControlName","datetime"),e.yG2(5),e.E7m("errors",a.form.controls.datetime.errors),e.yG2(2),e.E7m("disabled",a.form.disabled)("showLoader",a.loading()),e.yG2(3),e.E7m("disabled",a.form.disabled||a.loading()))},dependencies:[h,i.sl,i.sz,i.ue,i.u,i.uW,i.Wo,A.CI,A.Kw,I.g,D.Y,_.qQ,_.ER],encapsulation:2})}return s})(),G=(()=>{class s{static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275mod=e.a4G({type:s});static#o=this.\u0275inj=e.s3X({imports:[_.qQ.forChild([(0,R.VV)(x,{path:"",closeable:!0,dismissible:!0,size:"m"})])]})}return s})()},48128:(v,u,n)=>{"use strict";function _(R){if(!R)return null;const e=R.match(/filename="(.+)"/);return e?e[1]:null}n.d(u,{k:()=>_})},85180:(v,u,n)=>{"use strict";n.d(u,{C:()=>l});var _=n(58400);class R extends _.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class e extends _.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(c=>new R(c)):[]}}class i extends _.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(c=>new e(c)):[]}}class E extends _.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.other=t.other}}class l extends _.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new E(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(c=>new i(c)):[]}}},28304:(v,u,n)=>{"use strict";n.d(u,{S:()=>c});var _=n(36012),R=n(85180),e=n(54704),i=n(53252),E=n(39144),l=n(97048),d=n(48128),t=n(54496);let c=(()=>{class p extends _.s{constructor(){super(R.C,"admin/reservations")}tablesSummary(m={}){return this.get("tables_summary",{params:m})}deliverConfirmationEmail(m){return this.post(`${m}/deliver_confirmation_email`,{}).pipe((0,e.k)(O=>this.mapItem(O)))}export(m){return new i._(O=>{this.get("export",{responseType:"blob",observe:"response",params:m}).pipe((0,E.a)(S=>(console.error("ReservationsService.export() error:",S),O.error(S),new i._))).subscribe(S=>{if(S instanceof l.WA&&S.body){const T=(0,d.k)(S.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",h=S.headers?.get("Content-Type")??"application/octet-stream",M=window.URL.createObjectURL(new Blob([S.body],{type:h})),A=document.createElement("a");A.href=M,A.download=T,A.click(),O.complete()}})})}static#e=this.\u0275fac=function(O){return new(O||p)};static#t=this.\u0275prov=t.wxM({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})()},63984:(v,u,n)=>{"use strict";n.d(u,{AF:()=>e,Ib:()=>_});class _{constructor(E,l,d){this.range=E,this.name=l,this.content=d}toString(){return this.name}}class e{constructor(E,l){this.item=E,this.stringify=l}toString(){return this.stringify(this.item)}}},50812:(v,u,n)=>{"use strict";n.d(u,{m2:()=>m,mU:()=>t,qS:()=>i,w3:()=>O}),n(64392);var R=n(82528);n(93840);const i={DMY:"dd/mm/yyyy",MDY:"mm/dd/yyyy",YMD:"yyyy/mm/dd"},t=/\([#]+\)|[#\- ]/g,m=(T,h,M,A)=>{if(!h?.isSingleDay||!M)return T;const I=(0,R.Kw)(Object.entries(M).map(([g,D])=>[g,-D])),f=h.from.append(A?I:M).append({day:A?1:-1});return A?f.dayBefore(T)?T:f:T&&f.dayAfter(T)?T:f},O={HH:23,MM:59,SS:59,MS:999}},25288:()=>{}}]);