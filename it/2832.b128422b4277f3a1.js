"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[2832],{1703:(T,l,t)=>{t.d(l,{q:()=>q});var e=t(4496),o=t(6504),r=t(1236),E=t(8256),a=t(9938),n=t(8392),c=t(1128),N=t(3480),A=t(400),I=t(5e3),h=t(8212),v=t(7692),g=t(9880),U=t(8048),O=t(3797),M=t(9888),m=t(2740),C=t(6052),S=t(5188),d=t(3616),D=t(4e3),y=t(8824),K=t(9956),B=t(7924),W=t(7556),G=t(2516),w=t(1240),F=t(964),V=t(7936),Y=t(4336);const k=(s,R)=>R.id;function x(s,R){if(1&s&&e.wR5(0,"app-errors",4),2&s){const _=e.GaO();e.E7m("errors",_.form.controls.name.errors)}}function X(s,R){if(1&s&&e.wR5(0,"app-errors",4),2&s){const _=e.GaO();e.E7m("errors",_.form.controls.weekday.errors)}}const b=()=>[15,30,45,60];function z(s,R){1&s&&e.wR5(0,"tui-data-list-wrapper",20),2&s&&e.E7m("items",e.q4q(1,b))}function H(s,R){if(1&s&&e.wR5(0,"app-errors",4),2&s){const _=e.GaO();e.E7m("errors",_.form.controls.step.errors)}}function Q(s,R){if(1&s&&e.wR5(0,"app-errors",4),2&s){const _=e.GaO();e.E7m("errors",_.form.controls.starts_at.errors)}}function j(s,R){if(1&s&&e.wR5(0,"app-errors",4),2&s){const _=e.GaO();e.E7m("errors",_.form.controls.ends_at.errors)}}function J(s,R){if(1&s&&(e.I0R(0,"div",21),e.OEk(1),e.C$Y()),2&s){const _=R.$implicit;e.yG2(),e.MjK("",_.name,": ",_.starts_at," - ",_.ends_at,"")}}function Z(s,R){if(1&s&&e.wR5(0,"app-errors",4),2&s){const _=e.GaO();e.E7m("errors",_.form.errors)}}let q=(()=>{class s{constructor(){this.service=(0,e.uUt)(W.K),this.destroy$=(0,e.uUt)(N.UF),this.notifications=(0,e.uUt)(c.E),this.route=(0,e.uUt)(r.gV),this.formSubmitted=(0,e.OCB)(!1),this.parentLoading=(0,e.OCB)(!1),this.searching=(0,e.OCB)(!1),this.loading=(0,e.S6b)(()=>this.parentLoading()||this.searching()),this._context="create",this.submitted=new e._w7,this.cancelled=new e._w7,this.concurrentData=(0,e.OCB)(null),this.concurrent=(0,e.S6b)(()=>(this.concurrentData()?.items??[]).filter(_=>_.weekday==this.form.value.weekday&&_.id!=this.currentItemId())),this.form=new o.WC({weekday:new o.Ku(null,[o.AQ.required]),starts_at:new o.Ku(null,[o.AQ.required]),ends_at:new o.Ku(null,[o.AQ.required]),step:new o.Ku(30,[o.AQ.required,o.AQ.min(15),o.AQ.max(60)]),name:new o.Ku(null,[o.AQ.required])}),this.formInitialValue=this.form.value,this.currentItemId=(0,e.OCB)(null)}set setParentLoading(_){this.parentLoading.set(_)}set context(_){"update"==_?this.form.controls.weekday.disable():this.form.controls.weekday.enable()}get context(){return this._context}set turn(_){if(this.currentItemId.set(_?.id??null),_){const u={weekday:_.weekday,starts_at:_.starts_at?A.uc.fromString(_.starts_at):null,ends_at:_.ends_at?A.uc.fromString(_.ends_at):null,step:_.step,name:_.name};this.form.patchValue(u)}else this.form.reset(this.formInitialValue)}ngOnInit(){this.form.controls.weekday.valueChanges.pipe((0,d.a)(this.destroy$),(0,D.a)()).subscribe({next:_=>this.searchSameWeekday(_)}),this.route.queryParams.pipe((0,d.a)(this.destroy$)).subscribe({next:_=>{_.weekday&&this.form.controls.weekday.setValue(_.weekday)}})}manageHttpError(_){a.y.assignErrorsToForm(this.form,_),this.notifications.error((0,E.mk)(_)||n.a)}submit(){this.formSubmitted.set(!0),!this.form.invalid&&this.submitted.emit(this.formatOutput())}cancel(){this.cancelled.emit()}formatOutput(){const{ends_at:_,starts_at:u,name:i,step:f}=this.form.value,P={starts_at:u?(0,F.In)(u):null,ends_at:_?(0,F.In)(_):null,name:i??"",step:f??30};return"create"==this.context&&(P.weekday=this.form.controls.weekday.value||0),P}searchSameWeekday(_){null!=_?(this.searching.set(!0),this.service.search({weekday:_,per_page:100}).pipe((0,d.a)(this.destroy$),(0,y.U)(()=>this.searching.set(!1))).subscribe({next:u=>this.concurrentData.set(u)})):this.concurrentData.set(null)}static#e=this.\u0275fac=function(u){return new(u||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-reservation-turn-form"]],inputs:{setParentLoading:[e.Wk5.None,"loading","setParentLoading"],context:"context",turn:"turn"},outputs:{submitted:"submitted",cancelled:"cancelled"},standalone:!0,features:[e.UHJ],decls:44,vars:20,consts:()=>{let _,u,i,f,P,L,$;return _="Nome turno",u="Minuti tra una prenotazione e l'altra",i="Dalle ore",f="Fino alle ore",P="Nota che per " + "\ufffd0\ufffd" + " sono presenti anche i seguenti turni:",L="Salva",$="Annulla",[[3,"formGroup","ngSubmit"],[1,"mb-3","block"],["tuiAutoFocus","",3,"formControlName"],_,[3,"errors"],[3,"formControlName"],u,["tuiTextfield",""],[3,"items",4,"tuiDataList"],[1,"flex","items-center"],[1,"me-2","grow"],i,f,[3,"expanded"],[1,"text-slate-400"],P,["type","submit","tuiButton","","appearance","primary",3,"showLoader"],L,["type","button","tuiButton","","appearance","icon",3,"disabled","click"],$,[3,"items"],[1,"block"],["class","block"]]},template:function(u,i){1&u&&(e.I0R(0,"form",0),e.qCj("ngSubmit",function(){return i.submit()}),e.I0R(1,"div",1)(2,"tui-input",2),e.SAx(3),e.aS0(4,3),e.k70(),e.C$Y(),e.yuY(5,x,1,1,"app-errors",4),e.C$Y(),e.I0R(6,"div",1),e.wR5(7,"app-weekday-select",5),e.yuY(8,X,1,1,"app-errors",4),e.C$Y(),e.I0R(9,"div",1)(10,"tui-select",5),e.SAx(11),e.aS0(12,6),e.k70(),e.wR5(13,"input",7),e.yuY(14,z,1,2,"tui-data-list-wrapper",8),e.C$Y(),e.yuY(15,H,1,1,"app-errors",4),e.C$Y(),e.I0R(16,"div",1)(17,"div",9)(18,"div",10)(19,"tui-input-time",5),e.SAx(20),e.aS0(21,11),e.k70(),e.C$Y(),e.yuY(22,Q,1,1,"app-errors",4),e.C$Y(),e.I0R(23,"div",10)(24,"tui-input-time",5),e.SAx(25),e.aS0(26,12),e.k70(),e.C$Y(),e.yuY(27,j,1,1,"app-errors",4),e.C$Y()(),e.I0R(28,"tui-expand",13)(29,"div",14)(30,"span"),e.aS0(31,15),e.wVc(32,"downcase"),e.wVc(33,"weekday"),e.C$Y(),e.c53(34,J,2,3,"div",22,k),e.C$Y()()(),e.yuY(36,Z,1,1,"app-errors",4),e.I0R(37,"div",9)(38,"button",16),e.SAx(39),e.aS0(40,17),e.k70(),e.C$Y(),e.I0R(41,"button",18),e.qCj("click",function(){return i.cancel()}),e.SAx(42),e.aS0(43,19),e.k70(),e.C$Y()()()),2&u&&(e.E7m("formGroup",i.form),e.yG2(2),e.E7m("formControlName","name"),e.yG2(3),e.C0Y(5,i.formSubmitted()||i.form.controls.name.touched?5:-1),e.yG2(2),e.E7m("formControlName","weekday"),e.yG2(),e.C0Y(8,i.formSubmitted()||i.form.controls.weekday.touched?8:-1),e.yG2(2),e.E7m("formControlName","step"),e.yG2(5),e.C0Y(15,i.formSubmitted()||i.form.controls.step.touched?15:-1),e.yG2(4),e.E7m("formControlName","starts_at"),e.yG2(3),e.C0Y(22,i.formSubmitted()||i.form.controls.starts_at.touched?22:-1),e.yG2(2),e.E7m("formControlName","ends_at"),e.yG2(3),e.C0Y(27,i.formSubmitted()||i.form.controls.ends_at.touched?27:-1),e.yG2(),e.E7m("expanded",i.concurrent().length>0),e.yG2(5),e.oBb(e.kDX(32,16,e.kDX(33,18,i.form.value.weekday))),e.Ylm(31),e.yG2(),e.oho(i.concurrent()),e.yG2(2),e.C0Y(36,i.formSubmitted()?36:-1),e.yG2(2),e.E7m("showLoader",i.loading()),e.yG2(3),e.E7m("disabled",i.loading()))},dependencies:[h.CI,h.Kw,v.Sk,o.sl,o.sz,o.ue,o.u,o.uW,o.Wo,O.CQ,O.Oo,O.cP,V.b,K.g,M.Q7,m.IZ,m.iw,m.gt,B.W,I.m6,I.gJ,G.G,g.kh,g.st,w.e,C.q8,C.OO,Y.Ux,U.aS,S.my,S.cP,S.uO],encapsulation:2,changeDetection:0})}return s})()},9772:(T,l,t)=>{t.d(l,{CU:()=>o,ye:()=>r});const e=(new Date).getTimezoneOffset()/60;function o(E,a=e){return"string"==typeof E&&E.length>0&&E.match(/\d{1,2}:\d{1,2}/)?`${Number(E.split(":")[0])-a}:${E.split(":")[1]}`:(console.error("Invalid string provided to strTimeTimezone",{string:E}),"")}function r(E,a=e){return o(E,-1*a)}},1960:(T,l,t)=>{t.d(l,{u:()=>E});var e=t(8400),o=t(5136);class r extends e.w{constructor(n){super(n),this.date=n.date?new Date(n.date):void 0,this.reservation_turn_id=n.reservation_turn_id,this.group_id=n.group_id,this.reservation_turn=n.reservation_turn?new o.e(n.reservation_turn):void 0}}class E extends e.w{constructor(n){super(n),this.turns=[],this.dates=[],this.title=n.title,this.status=n.status,this.preorder_type=n.preorder_type,this.payment_value=n.payment_value,this.message=n.message,this.turns=(n.turns||[]).map(c=>new o.e(c)),this.dates=(n.dates||[]).map(c=>new r(c)),this.translations=n.translations||{}}}},5136:(T,l,t)=>{t.d(l,{e:()=>E});var e=t(8400),o=t(9772),r=t(1960);class E extends e.w{constructor(n){super(n),this.messages=[],this.name=n.name,this.weekday=n.weekday,this.step=n.step,this.valid_times=n.valid_times,this.starts_at=n.starts_at?(0,o.CU)(n.starts_at):void 0,this.ends_at=n.ends_at?(0,o.CU)(n.ends_at):void 0,this.preorder_reservation_group=n.preorder_reservation_group?new r.u(n.preorder_reservation_group):void 0,this.messages=n.messages}}},1240:(T,l,t)=>{t.d(l,{e:()=>o});var e=t(4496);let o=(()=>{class r{transform(a){return"string"==typeof a&&a.length>0?a.toLowerCase():null}static#e=this.\u0275fac=function(n){return new(n||r)};static#t=this.\u0275pipe=e.UTH({name:"downcase",type:r,pure:!0,standalone:!0})}return r})()},7556:(T,l,t)=>{t.d(l,{K:()=>E});var e=t(6012),o=t(5136),r=t(4496);let E=(()=>{class a extends e.s{constructor(){super(o.e,"admin/reservation_turns")}static#e=this.\u0275fac=function(N){return new(N||a)};static#t=this.\u0275prov=r.wxM({token:a,factory:a.\u0275fac,providedIn:"root"})}return a})()},812:(T,l,t)=>{t.d(l,{m2:()=>v,mU:()=>N,qS:()=>E,w3:()=>g}),t(4392);var o=t(2528);t(3840);const E={DMY:"dd/mm/yyyy",MDY:"mm/dd/yyyy",YMD:"yyyy/mm/dd"},N=/\([#]+\)|[#\- ]/g,v=(O,M,m,C)=>{if(!M?.isSingleDay||!m)return O;const S=(0,o.Kw)(Object.entries(m).map(([D,y])=>[D,-y])),d=M.from.append(C?S:m).append({day:C?1:-1});return C?d.dayBefore(O)?O:d:O&&d.dayAfter(O)?O:d},g={HH:23,MM:59,SS:59,MS:999}}}]);