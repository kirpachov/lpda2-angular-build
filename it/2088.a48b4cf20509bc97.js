"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[2088],{9740:(N,p,n)=>{n.r(p),n.d(p,{ExportReservationsModalModule:()=>x});var _=n(1236),S=n(7552),e=n(4496),i=n(6504),u=n(1368),l=n(400);let m=(()=>{class s{constructor(){this.datePipe=(0,e.uUt)(u.y)}transform(o,r){return o instanceof l.Se?`Dal ${this.datePipe.transform(o.from.toUtcNativeDate(),r)} al ${this.datePipe.transform(o.to.toUtcNativeDate(),r)}`:null}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275pipe=e.UTH({name:"datePeriodSummary",type:s,pure:!0,standalone:!0})}return s})();var t=n(3480),R=n(3984),O=n(424),I=n(3616);function d(s,G){if(1&s&&e.OEk(0),2&s){const o=e.GaO();e.oRS(" ",o.label," ")}}function E(s,G){if(1&s&&(e.I0R(0,"small",3),e.OEk(1),e.wVc(2,"datePeriodSummary"),e.C$Y()),2&s){const o=e.GaO();e.yG2(),e.cNF(e.kDX(2,1,o.control.value))}}const c=["*"];let h=(()=>{class s{constructor(){this.destroy$=new t.UF,this.control=new i.Ku(null),this.today=l.EK.currentLocal(),this.tomorrow=l.EK.currentLocal().append({day:1}),this.max=null,this.appProductionDate=l.EK.fromLocalNativeDate(new Date("2023-8-1")),this.endOfCurrentYear=l.EK.fromLocalNativeDate(new Date(`${this.today.year}-12-31`)),this.periodOptions=[new R.Ib(new l.Se(this.today.append({day:-30}),this.today),"Ultimo mese"),new R.Ib(new l.Se(this.today.append({day:-365}),this.today),"Ultimo anno"),...Array.from({length:5},(o,r)=>r).map(o=>this.today.year-o).filter(o=>o>=this.appProductionDate.year).map(o=>new R.Ib(new l.Se(l.EK.fromLocalNativeDate(new Date(`${o}-01-01`)),l.EK.fromLocalNativeDate(new Date(`${o}-12-31`))),`${o}`))],this.label="Seleziona il periodo temporale"}writeValue(o){if(void 0===o&&(o=null),null===o||o instanceof l.Se)return this.control.setValue(o);console.warn("Invalid value for DatePeriodComponent",o)}registerOnChange(o){this.control.valueChanges.pipe((0,I.a)(this.destroy$)).subscribe((...r)=>o(...r))}registerOnTouched(o){this.control.valueChanges.pipe((0,I.a)(this.destroy$)).subscribe((...r)=>o(...r))}setDisabledState(o){o?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-date-period"]],inputs:{max:"max",label:"label"},standalone:!0,features:[e.M5G([{provide:i.Y6,useExisting:(0,e.wd)(()=>s),multi:!0},t.UF]),e.UHJ],ngContentSelectors:c,decls:6,vars:6,consts:[[3,"min","max","formControl","items"],["content",""],["class","d-block text-muted"],[1,"d-block","text-muted"]],template:function(r,a){if(1&r&&(e.kPM(),e.I0R(0,"tui-input-date-range",0)(1,"span",null,1),e._Xx(3),e.C$Y(),e.yuY(4,d,1,1),e.C$Y(),e.yuY(5,E,3,3,"small",2)),2&r){const P=e.Gew(2);e.E7m("min",a.appProductionDate)("max",a.max)("formControl",a.control)("items",a.periodOptions),e.yG2(4),e.C0Y(4,P.children.length?-1:4),e.yG2(),e.C0Y(5,null!=a.control.value&&a.control.value.from&&null!=a.control.value&&a.control.value.to?5:-1)}},dependencies:[O.uy,O.YZ,O.Ku,i.sl,i.ue,i.ug,m],encapsulation:2})}return s})();var T=n(1183),A=n(8212),f=n(9956),v=n(8304),M=n(8824),g=n(3264),D=n(1128),V=n(8256),X=n(8392);let U=(()=>{class s{constructor(){this.service=(0,e.uUt)(v.S),this.destroy$=(0,e.uUt)(t.UF),this.date=(0,e.uUt)(u.y),this.notifications=(0,e.uUt)(D.E),this.loading=(0,e.OCB)(!1),this.form=new i.WC({created_at:new i.Ku(null),datetime:new i.Ku(null),status:new i.Ku(null)})}export(){this.loading.set(!0),this.service.export(this.formatFormValue()).pipe((0,I.a)(this.destroy$),(0,M.U)(()=>this.loading.set(!1))).subscribe({error:o=>{this.notifications.error((0,V.mk)(o)||X.a)}})}formatFormValue(){const o={};return this.form.value.created_at&&(o.created_at_from=this.date.transform(this.form.value.created_at.from.toUtcNativeDate(),"yyyy-MM-dd")||"",o.created_at_to=this.date.transform(this.form.value.created_at.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.datetime&&(o.datetime_from=this.date.transform(this.form.value.datetime.from.toUtcNativeDate(),"yyyy-MM-dd")||"",o.datetime_to=this.date.transform(this.form.value.datetime.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.status&&(0,T.sl)(this.form.value.status)&&(o.status=this.form.value.status),o}static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-export-reservations-modal"]],standalone:!0,features:[e.M5G([t.UF]),e.UHJ],decls:27,vars:10,consts:()=>{let o,r,a,P,C,L,$;return o="Esporta prenotazioni",r="Stato prenotazione",a="Data di creazione prenotazione",P="Data di prenotazione prenotazione",C="(data in cui le persone vengono a mangiare)",L="Scarica excel",$="Annulla",[o,[3,"formGroup","ngSubmit"],[1,"block","mb-3"],[3,"formControlName"],r,[3,"errors"],a,P,[1,"text-slate-400"],C,[1,"flex","items-center","justify-center"],["type","submit","tuiButton","","appearance","primary",1,"me-2",3,"disabled","showLoader"],L,["type","button","routerLink","..","tuiButton","","appearance","icon",3,"disabled"],$]},template:function(r,a){1&r&&(e.I0R(0,"h1"),e.aS0(1,0),e.C$Y(),e.I0R(2,"form",1),e.qCj("ngSubmit",function(){return a.export()}),e.I0R(3,"div",2)(4,"app-reservation-status-select",3),e.SAx(5),e.aS0(6,4),e.k70(),e.C$Y(),e.wR5(7,"app-errors",5),e.C$Y(),e.I0R(8,"div",2)(9,"app-date-period",3)(10,"span"),e.aS0(11,6),e.C$Y()(),e.wR5(12,"app-errors",5),e.C$Y(),e.I0R(13,"div",2)(14,"app-date-period",3)(15,"span"),e.aS0(16,7),e.C$Y()(),e.I0R(17,"span",8),e.aS0(18,9),e.C$Y(),e.wR5(19,"app-errors",5),e.C$Y(),e.I0R(20,"div",10)(21,"button",11),e.SAx(22),e.aS0(23,12),e.k70(),e.C$Y(),e.I0R(24,"button",13),e.SAx(25),e.aS0(26,14),e.k70(),e.C$Y()()()),2&r&&(e.yG2(2),e.E7m("formGroup",a.form),e.yG2(2),e.E7m("formControlName","status"),e.yG2(3),e.E7m("errors",a.form.controls.status.errors),e.yG2(2),e.E7m("formControlName","created_at"),e.yG2(3),e.E7m("errors",a.form.controls.created_at.errors),e.yG2(2),e.E7m("formControlName","datetime"),e.yG2(5),e.E7m("errors",a.form.controls.datetime.errors),e.yG2(2),e.E7m("disabled",a.form.disabled)("showLoader",a.loading()),e.yG2(3),e.E7m("disabled",a.form.disabled||a.loading()))},dependencies:[h,i.sl,i.sz,i.ue,i.u,i.uW,i.Wo,A.CI,A.Kw,f.g,g.Y,_.qQ,_.ER],encapsulation:2})}return s})(),x=(()=>{class s{static#e=this.\u0275fac=function(r){return new(r||s)};static#t=this.\u0275mod=e.a4G({type:s});static#o=this.\u0275inj=e.s3X({imports:[_.qQ.forChild([(0,S.VV)(U,{path:"",closeable:!0,dismissible:!0,size:"m"})])]})}return s})()},8128:(N,p,n)=>{function _(S){if(!S)return null;const e=S.match(/filename="(.+)"/);return e?e[1]:null}n.d(p,{k:()=>_})},5180:(N,p,n)=>{n.d(p,{C:()=>l});var _=n(8400);class S extends _.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class e extends _.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(R=>new S(R)):[]}}class i extends _.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(R=>new e(R)):[]}}class u extends _.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.external_id=t.external_id,this.other=t.other}}class l extends _.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new u(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(R=>new i(R)):[]}}},8304:(N,p,n)=>{n.d(p,{S:()=>R});var _=n(6012),S=n(5180),e=n(4704),i=n(3252),u=n(9144),l=n(7048),m=n(8128),t=n(4496);let R=(()=>{class O extends _.s{constructor(){super(S.C,"admin/reservations")}updateStatus(d,E){return this.patch(`${d}/status/${E}`,{}).pipe((0,e.k)(c=>this.mapItem(c)))}tablesSummary(d={}){return this.get("tables_summary",{params:d})}deliverConfirmationEmail(d){return this.post(`${d}/deliver_confirmation_email`,{}).pipe((0,e.k)(E=>this.mapItem(E)))}refoundPayment(d){return this.post(`${d}/refund_payment`,{}).pipe((0,e.k)(E=>this.mapItem(E)))}refreshPaymentStatus(d){return this.post(`${d}/refresh_payment_status`,{}).pipe((0,e.k)(E=>this.mapItem(E)))}export(d){return new i._(E=>{this.get("export",{responseType:"blob",observe:"response",params:d}).pipe((0,u.a)(c=>(console.error("ReservationsService.export() error:",c),E.error(c),new i._))).subscribe(c=>{if(c instanceof l.WA&&c.body){const h=(0,m.k)(c.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",T=c.headers?.get("Content-Type")??"application/octet-stream",A=window.URL.createObjectURL(new Blob([c.body],{type:T})),f=document.createElement("a");f.href=A,f.download=h,f.click(),E.complete()}})})}static#e=this.\u0275fac=function(E){return new(E||O)};static#t=this.\u0275prov=t.wxM({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})()},3984:(N,p,n)=>{n.d(p,{AF:()=>e,Ib:()=>_});class _{constructor(u,l,m){this.range=u,this.name=l,this.content=m}toString(){return this.name}}class e{constructor(u,l){this.item=u,this.stringify=l}toString(){return this.stringify(this.item)}}},812:(N,p,n)=>{n.d(p,{m2:()=>d,mU:()=>t,qS:()=>i,w3:()=>E}),n(4392);var S=n(2528);n(3840);const i={DMY:"dd/mm/yyyy",MDY:"mm/dd/yyyy",YMD:"yyyy/mm/dd"},t=/\([#]+\)|[#\- ]/g,d=(h,T,A,f)=>{if(!T?.isSingleDay||!A)return h;const v=(0,S.Kw)(Object.entries(A).map(([g,D])=>[g,-D])),M=T.from.append(f?v:A).append({day:f?1:-1});return f?M.dayBefore(h)?h:M:h&&M.dayAfter(h)?h:M},E={HH:23,MM:59,SS:59,MS:999}}}]);