"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[9740],{9740:(A,p,n)=>{n.r(p),n.d(p,{ExportReservationsModalModule:()=>z});var u=n(1236),S=n(7552),e=n(4496),r=n(6504),d=n(1368),l=n(400);let E=(()=>{class s{constructor(){this.datePipe=(0,e.uUt)(d.y)}transform(o,i){return o instanceof l.Se?`Dal ${this.datePipe.transform(o.from.toUtcNativeDate(),i)} al ${this.datePipe.transform(o.to.toUtcNativeDate(),i)}`:null}static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275pipe=e.UTH({name:"datePeriodSummary",type:s,pure:!0,standalone:!0})}return s})();var t=n(3480),R=n(3984),O=n(3460),N=n(3616);function _(s,b){if(1&s&&e.OEk(0),2&s){const o=e.GaO();e.oRS(" ",o.label," ")}}function m(s,b){if(1&s&&(e.I0R(0,"small",3),e.OEk(1),e.wVc(2,"datePeriodSummary"),e.C$Y()),2&s){const o=e.GaO();e.yG2(),e.cNF(e.kDX(2,1,o.control.value))}}const c=["*"];let P=(()=>{class s{constructor(){this.destroy$=(0,e.y_5)(t.UF),this.control=new r.Ku(null),this.today=l.EK.currentLocal(),this.tomorrow=l.EK.currentLocal().append({day:1}),this.max=null,this.appProductionDate=l.EK.fromLocalNativeDate(new Date("2023-8-1")),this.endOfCurrentYear=l.EK.fromLocalNativeDate(new Date(`${this.today.year}-12-31`)),this.periodOptions=[new R.Ib(new l.Se(this.today.append({day:-30}),this.today),"Ultimo mese"),new R.Ib(new l.Se(this.today.append({day:-365}),this.today),"Ultimo anno"),...Array.from({length:5},(o,i)=>i).map(o=>this.today.year-o).filter(o=>o>=this.appProductionDate.year).map(o=>new R.Ib(new l.Se(l.EK.fromLocalNativeDate(new Date(`${o}-01-01`)),l.EK.fromLocalNativeDate(new Date(`${o}-12-31`))),`${o}`))],this.label="Seleziona il periodo temporale"}writeValue(o){if(void 0===o&&(o=null),null===o||o instanceof l.Se)return this.control.setValue(o);console.warn("Invalid value for DatePeriodComponent",o)}registerOnChange(o){this.control.valueChanges.pipe((0,N.a)(this.destroy$)).subscribe((...i)=>o(...i))}registerOnTouched(o){this.control.valueChanges.pipe((0,N.a)(this.destroy$)).subscribe((...i)=>o(...i))}setDisabledState(o){o?this.control.disable():this.control.enable()}static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-date-period"]],inputs:{max:"max",label:"label"},standalone:!0,features:[e.M5G([{provide:r.Y6,useExisting:(0,e.wd)(()=>s),multi:!0},t.UF]),e.UHJ],ngContentSelectors:c,decls:6,vars:6,consts:[[3,"min","max","formControl","items"],["content",""],["class","d-block text-muted"],[1,"d-block","text-muted"]],template:function(i,a){if(1&i&&(e.kPM(),e.I0R(0,"tui-input-date-range",0)(1,"span",null,1),e._Xx(3),e.C$Y(),e.yuY(4,_,1,1),e.C$Y(),e.yuY(5,m,3,3,"small",2)),2&i){const h=e.Gew(2);e.E7m("min",a.appProductionDate)("max",a.max)("formControl",a.control)("items",a.periodOptions),e.yG2(4),e.C0Y(4,h.children.length?-1:4),e.yG2(),e.C0Y(5,null!=a.control.value&&a.control.value.from&&null!=a.control.value&&a.control.value.to?5:-1)}},dependencies:[O.uy,O.YZ,O.Ku,r.sl,r.ue,r.ug,E],encapsulation:2})}return s})();var v=n(1183),M=n(8212),f=n(8048),$=n(9956),L=n(8304),V=n(8824),X=n(3264),x=n(1128),G=n(8256),U=n(8392),y=n(3797);let w=(()=>{class s{constructor(){this.service=(0,e.uUt)(L.S),this.destroy$=(0,e.uUt)(t.UF),this.date=(0,e.uUt)(d.y),this.notifications=(0,e.uUt)(x.E),this.loading=(0,e.OCB)(!1),this.form=new r.WC({created_at:new r.Ku(null),datetime:new r.Ku(null),status:new r.Ku(null),query:new r.Ku(null)})}export(){this.loading.set(!0),this.service.export(this.formatFormValue()).pipe((0,N.a)(this.destroy$),(0,V.U)(()=>this.loading.set(!1))).subscribe({error:o=>{this.notifications.error((0,G.mk)(o)||U.a)}})}formatFormValue(){const o={};return this.form.value.query&&(o.query=this.form.value.query),this.form.value.created_at&&(o.created_at_from=this.date.transform(this.form.value.created_at.from.toUtcNativeDate(),"yyyy-MM-dd")||"",o.created_at_to=this.date.transform(this.form.value.created_at.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.datetime&&(o.datetime_from=this.date.transform(this.form.value.datetime.from.toUtcNativeDate(),"yyyy-MM-dd")||"",o.datetime_to=this.date.transform(this.form.value.datetime.to.toUtcNativeDate(),"yyyy-MM-dd")||""),this.form.value.status&&(0,v.sl)(this.form.value.status)&&(o.status=this.form.value.status),o}static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275cmp=e.In1({type:s,selectors:[["app-export-reservations-modal"]],standalone:!0,features:[e.M5G([t.UF]),e.UHJ],decls:32,vars:12,consts:()=>{let o,i,a,h,I,g,C,D;return o="Esporta prenotazioni",i="Ricerca",a="Stato prenotazione",h="Data di creazione prenotazione",I="Data di prenotazione prenotazione",g="(data in cui le persone vengono a mangiare)",C="Scarica excel",D="Annulla",[o,[3,"formGroup","ngSubmit"],[1,"block","mb-3"],[3,"formControlName"],i,[3,"errors"],a,h,I,[1,"text-slate-400"],g,[1,"flex","items-center","justify-center"],["type","submit","tuiButton","","appearance","primary",1,"me-2",3,"disabled","showLoader"],C,["type","button","routerLink","..","tuiButton","","appearance","icon",3,"disabled"],D]},template:function(i,a){1&i&&(e.I0R(0,"h1"),e.aS0(1,0),e.C$Y(),e.I0R(2,"form",1),e.qCj("ngSubmit",function(){return a.export()}),e.I0R(3,"div",2)(4,"tui-input",3),e.SAx(5),e.aS0(6,4),e.k70(),e.C$Y(),e.wR5(7,"app-errors",5),e.C$Y(),e.I0R(8,"div",2)(9,"app-reservation-status-select",3),e.SAx(10),e.aS0(11,6),e.k70(),e.C$Y(),e.wR5(12,"app-errors",5),e.C$Y(),e.I0R(13,"div",2)(14,"app-date-period",3)(15,"span"),e.aS0(16,7),e.C$Y()(),e.wR5(17,"app-errors",5),e.C$Y(),e.I0R(18,"div",2)(19,"app-date-period",3)(20,"span"),e.aS0(21,8),e.C$Y()(),e.I0R(22,"span",9),e.aS0(23,10),e.C$Y(),e.wR5(24,"app-errors",5),e.C$Y(),e.I0R(25,"div",11)(26,"button",12),e.SAx(27),e.aS0(28,13),e.k70(),e.C$Y(),e.I0R(29,"button",14),e.SAx(30),e.aS0(31,15),e.k70(),e.C$Y()()()),2&i&&(e.yG2(2),e.E7m("formGroup",a.form),e.yG2(2),e.E7m("formControlName","query"),e.yG2(3),e.E7m("errors",a.form.controls.query.errors),e.yG2(2),e.E7m("formControlName","status"),e.yG2(3),e.E7m("errors",a.form.controls.status.errors),e.yG2(2),e.E7m("formControlName","created_at"),e.yG2(3),e.E7m("errors",a.form.controls.created_at.errors),e.yG2(2),e.E7m("formControlName","datetime"),e.yG2(5),e.E7m("errors",a.form.controls.datetime.errors),e.yG2(2),e.E7m("disabled",a.form.disabled)("showLoader",a.loading()),e.yG2(3),e.E7m("disabled",a.form.disabled||a.loading()))},dependencies:[P,r.sl,r.sz,r.ue,r.u,r.uW,r.Wo,M.CI,M.Kw,$.g,X.Y,u.qQ,u.ER,y.CQ,y.Oo,y.cP,f.aS],encapsulation:2})}return s})(),z=(()=>{class s{static#e=this.\u0275fac=function(i){return new(i||s)};static#t=this.\u0275mod=e.a4G({type:s});static#o=this.\u0275inj=e.s3X({imports:[u.qQ.forChild([(0,S.VV)(w,{path:"",closeable:!0,dismissible:!0,size:"m"})])]})}return s})()},8128:(A,p,n)=>{function u(S){if(!S)return null;const e=S.match(/filename="(.+)"/);return e?e[1]:null}n.d(p,{k:()=>u})},5180:(A,p,n)=>{n.d(p,{C:()=>l});var u=n(8400);class S extends u.w{constructor(t){super(t),this.image_pixel_id=t.image_pixel_id,this.event_data=t.event_data,this.event_time=t.event_time?new Date(t.event_time):void 0}}class e extends u.w{constructor(t){super(t),this.image_id=t.image_id,this.delivered_email_id=t.delivered_email_id,this.record_type=t.record_type,this.record_id=t.record_id,this.event_type=t.event_type,this.secret=t.secret,this.events=t.events?t.events.map(R=>new S(R)):[]}}class r extends u.w{constructor(t){super(t),this.record_id=t.record_id,this.record_type=t.record_type,this.text=t.text,this.html=t.html,this.subject=t.subject,this.headers=t.headers,this.raw=t.raw,this.image_pixels=t.image_pixels?t.image_pixels.map(R=>new e(R)):[]}}class d extends u.w{constructor(t){super(t),this.hpp_url=t.hpp_url,this.value=t.value,this.status=t.status,this.reservation_id=t.reservation_id,this.preorder_type=t.preorder_type,this.external_id=t.external_id,this.other=t.other}}class l extends u.w{constructor(t){super(t),this.fullname=t.fullname,this.datetime=t.datetime?new Date(t.datetime):void 0,this.status=t.status,this.secret=t.secret,this.adults=t.adults,this.children=t.children,this.table=t.table,this.notes=t.notes,this.email=t.email,this.phone=t.phone,this.payment=t.payment?new d(t.payment):void 0,this.delivered_emails=t.delivered_emails?t.delivered_emails.map(R=>new r(R)):[]}}},8304:(A,p,n)=>{n.d(p,{S:()=>R});var u=n(6012),S=n(5180),e=n(4704),r=n(3252),d=n(9144),l=n(7048),E=n(8128),t=n(4496);let R=(()=>{class O extends u.s{constructor(){super(S.C,"admin/reservations")}updateStatus(_,m){return this.patch(`${_}/status/${m}`,{}).pipe((0,e.k)(c=>this.mapItem(c)))}tablesSummary(_={}){return this.get("tables_summary",{params:_})}ungroupedTablesSummary(_={}){return this.get("ungrouped_tables_summary",{params:_})}deliverConfirmationEmail(_){return this.post(`${_}/deliver_confirmation_email`,{}).pipe((0,e.k)(m=>this.mapItem(m)))}refoundPayment(_){return this.post(`${_}/refund_payment`,{}).pipe((0,e.k)(m=>this.mapItem(m)))}refreshPaymentStatus(_){return this.post(`${_}/refresh_payment_status`,{}).pipe((0,e.k)(m=>this.mapItem(m)))}export(_){return new r._(m=>{this.get("export",{responseType:"blob",observe:"response",params:_}).pipe((0,d.a)(c=>(console.error("ReservationsService.export() error:",c),m.error(c),new r._))).subscribe(c=>{if(c instanceof l.WA&&c.body){const P=(0,E.k)(c.headers?.get("Content-Disposition"))??"Prenotazioni.xlsx",v=c.headers?.get("Content-Type")??"application/octet-stream",M=window.URL.createObjectURL(new Blob([c.body],{type:v})),f=document.createElement("a");f.href=M,f.download=P,f.click(),m.complete()}})})}static#e=this.\u0275fac=function(m){return new(m||O)};static#t=this.\u0275prov=t.wxM({token:O,factory:O.\u0275fac,providedIn:"root"})}return O})()},3984:(A,p,n)=>{n.d(p,{AF:()=>e,Ib:()=>u});class u{constructor(d,l,E){this.range=d,this.name=l,this.content=E}toString(){return this.name}}class e{constructor(d,l){this.item=d,this.stringify=l}toString(){return this.stringify(this.item)}}}}]);