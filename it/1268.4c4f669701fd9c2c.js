"use strict";(self.webpackChunklpda2=self.webpackChunklpda2||[]).push([[1268],{9332:(y,f,i)=>{i.d(f,{t:()=>X});var c=i(1368),t=i(4496),l=i(6504),d=i(2516),u=i(7556),a=i(3480),g=i(6732),C=i(7692),D=i(466),w=i(5193),x=i(1673),$=i(8212),P=i(6528),R=i(3616),N=i(8824),n=i(4704),_=i(9144),m=i(2700);let T=(()=>{class s{transform(e){return o=>o?.dayOfWeek(!1)!=e}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275pipe=t.UTH({name:"tuiWeekdayHandler",type:s,pure:!0,standalone:!0})}return s})();var S=i(964),M=i(400);let O=(()=>{class s{transform(e){return e instanceof Date?e:e instanceof M.EK?e.toUtcNativeDate():null}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275pipe=t.UTH({name:"fromTuiDay",type:s,pure:!0,standalone:!0})}return s})(),U=(()=>{class s{transform(e,o){return!(!e||!o)&&e.getTime()>o.getTime()}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275pipe=t.UTH({name:"dateAfter",type:s,pure:!0,standalone:!0})}return s})();const Y=(s,p)=>p.id,I=()=>[];function k(s,p){if(1&s){const e=t.KQA();t.I0R(0,"tui-calendar",11),t.qCj("dayClick",function(r){t.usT(e);const h=t.GaO(3).$implicit,E=t.GaO(2);return t.CGJ(E.triggerDate(h.id,r))}),t.wVc(1,"tuiWeekdayHandler"),t.C$Y()}if(2&s){const e=t.GaO().tuiLet,o=t.GaO(2).$implicit;let r;t.E7m("disabledItemHandler",t.kDX(1,2,o.weekday))("value",null!==(r=e)&&void 0!==r?r:t.q4q(4,I))}}const A=s=>({"text-slate-400":s});function L(s,p){if(1&s&&(t.I0R(0,"span",13),t.wVc(1,"dateAfter"),t.wVc(2,"fromTuiDay"),t.OEk(3),t.wVc(4,"date"),t.wVc(5,"fromTuiDay"),t.C$Y()),2&s){const e=p.$implicit,o=t.GaO(6);t.E7m("ngClass",t.S45(12,A,!t.g7$(1,2,t.kDX(2,5,e),o.today))),t.yG2(3),t.cNF(t.g7$(4,7,t.kDX(5,10,e),"d MMMM y"))}}function b(s,p){1&s&&(t.I0R(0,"span",14),t.aS0(1,15),t.C$Y())}function H(s,p){if(1&s&&(t.I0R(0,"tui-hosted-dropdown",12)(1,"button",16),t.SAx(2),t.aS0(3,17),t.k70(),t.C$Y()()),2&s){t.GaO(2);const e=t.Gew(2);t.E7m("content",e)}}function z(s,p){if(1&s&&(t.I0R(0,"div",5),t.c53(1,L,6,14,"span",18,t.oxv,!1,b,2,0,"span",19),t.yuY(4,H,4,1,"tui-hosted-dropdown",12),t.C$Y()),2&s){const e=t.GaO().tuiLet,o=t.GaO(4);let r;t.yG2(),t.oho(null!==(r=e)&&void 0!==r?r:t.q4q(2,I)),t.yG2(3),t.C0Y(4,o.editable?4:-1)}}function K(s,p){if(1&s){const e=t.KQA();t.SAx(0),t.yuY(1,k,2,5,"ng-template",null,7,t.gJz),t.I0R(3,"div",8)(4,"tui-checkbox-block",9),t.qCj("ngModelChange",function(){t.usT(e);const r=t.GaO(2).$implicit,h=t.GaO(2);return t.CGJ(h.triggerSelection(r.id))}),t.OEk(5),t.C$Y(),t.yuY(6,z,5,3,"div",10),t.C$Y(),t.k70()}if(2&s){const e=p.tuiLet,o=t.GaO(2).$implicit,r=t.GaO(2);t.yG2(4),t.E7m("readOnly",!r.editable)("ngModel",void 0!==e),t.yG2(),t.oRS(" ",o.name," "),t.yG2(),t.C0Y(6,null!=e?6:-1)}}function B(s,p){if(1&s&&t.yuY(0,K,7,4,"ng-container",6),2&s){const e=t.GaO().$implicit,o=t.GaO(2);t.E7m("tuiLet",o.selections()[e.id])}}function W(s,p){1&s&&t.yuY(0,B,1,1,"ng-container"),2&s&&t.C0Y(0,p.$implicit.id?0:-1)}function V(s,p){if(1&s&&(t.I0R(0,"tr",2)(1,"td",3)(2,"p",4),t.OEk(3),t.wVc(4,"weekday"),t.C$Y()(),t.I0R(5,"td",3)(6,"div",5),t.c53(7,W,1,1,null,null,Y),t.C$Y()()()),2&s){const e=p.$implicit,o=t.GaO();t.yG2(3),t.cNF(t.kDX(4,1,e)),t.yG2(4),t.oho(o.turnsPerDay()[e])}}let X=(()=>{class s{constructor(){this.turnsService=(0,t.uUt)(u.K),this.destroy$=(0,t.uUt)(a.UF),this.date=(0,t.uUt)(c.y),this.outputMamiChanges=new t._w7,this.loading=(0,t.OCB)(!1),this.selections=(0,t.OCB)({}),this.today=new Date,this.editable$=(0,t.OCB)(!1),this.allTurns=(0,t.OCB)([]),this.turnsPerDay=(0,t.S6b)(()=>{const e=this.allTurns().filter(r=>null!=r.weekday),o={};for(const r of e){if(null==r.weekday||null==r.weekday)throw new Error("Turns must have a weekday");(this.editable$()||r.id&&Object.keys(this.selections()).includes(r.id.toString()))&&(o[r.weekday]||=[],o[r.weekday].push(r))}return o}),this.weekdays=(0,t.S6b)(()=>Object.keys(this.turnsPerDay()).map(Number)),this.lastOutput=null}set turns(e){this.selections.update(o=>(e.forEach(r=>{if(!r.id)throw new Error("Turn id is missing");o[r.id]||=[]}),o))}set dates(e){this.selections.update(o=>(e.forEach(r=>{if(!r.reservation_turn_id)throw new Error("Turn id is missing");if(!r.date)throw new Error("Date is missing or invalid",r.date);o[r.reservation_turn_id]||=[],o[r.reservation_turn_id].push((0,S._0)(r.date))}),o))}set editable(e){this.editable$.set(e)}get editable(){return this.editable$()}set item(e){this.selections.set({}),this.turns=e?.turns??[],this.dates=e?.dates??[]}ngOnInit(){this.searchTurns()}triggerSelection(e){this.selections.update(o=>(e in o?delete o[e]:o[e]=[],o)),this.emitChanges()}triggerDate(e,o){if(!e)throw new Error("Invalid turn id"+e);if(!o)throw new Error("Invalid day"+o);this.selections.update(r=>{r[e]||=[];const h=r[e].findIndex(E=>E.day===o.day);return-1===h?r[e].push(o):r[e].splice(h,1),r[e]=r[e].sort((E,v)=>E.dayAfter(v)?1:-1),r}),this.emitChanges()}emitChanges(){const e=[],o=[],r=this.selections();Object.keys(r).forEach(E=>{const v=parseInt(E);if(0===r[v].length)o.push(v);else for(const F of r[v]){const G=this.date.transform(F.toUtcNativeDate(),"yyyy-MM-dd");G?e.push({turn_id:v,date:G}):console.error("Invalid date",F)}});const h={dates:e,turns:o};(null===this.lastOutput||JSON.stringify(this.lastOutput)!==JSON.stringify(h))&&this.outputMamiChanges.emit(h)}searchTurns(){this.loading.set(!0),this.turnsService.search({per_page:1e3}).pipe((0,R.a)(this.destroy$),(0,N.U)(()=>this.loading.set(!1)),(0,n.k)(e=>e.items),(0,_.a)(e=>(console.error(e),(0,m.of)([])))).subscribe({next:e=>{this.allTurns.set(e)}})}static#t=this.\u0275fac=function(o){return new(o||s)};static#e=this.\u0275cmp=t.In1({type:s,selectors:[["app-select-turns-paymentv2"]],inputs:{turns:"turns",dates:"dates",editable:"editable",item:"item"},outputs:{outputMamiChanges:"outputMamiChanges"},standalone:!0,features:[t.M5G([a.UF]),t.UHJ],decls:5,vars:2,consts:()=>{let e,o;return e="Sempre",o="Modifica date",[["size","xl",3,"overlay","showLoader"],[1,"tui-table"],[1,"tui-table__tr","tui-table__tr_border_none"],[1,"tui-table__td"],[1,"text-xl"],[1,"flex","flex-col"],[4,"tuiLet"],["selectDatesTemplate",""],[1,"flex","flex-row","items-center","mb-5"],[1,"me-1",3,"readOnly","ngModel","ngModelChange"],["class","flex flex-col"],["tuiPreventDefault","mousedown",3,"disabledItemHandler","value","dayClick"],[3,"content"],[1,"mx-2","mb-1",3,"ngClass"],[1,"text-xl","text-green-500"],e,["tuiButton","","tuiHint","Modifica date","appearance","outline","size","s","type","button"],o,["class","mx-2 mb-1",3,"ngClass"],["class","text-xl text-green-500"],["class","tui-table__tr tui-table__tr_border_none"]]},template:function(o,r){1&o&&(t.I0R(0,"tui-loader",0)(1,"table",1)(2,"tbody"),t.c53(3,V,9,3,"tr",20,t.oxv),t.C$Y()()()),2&o&&(t.E7m("overlay",!0)("showLoader",r.loading()),t.yG2(3),t.oho(r.weekdays()))},dependencies:[d.G,P.i,P.I,l.y,l.ue,l._G,C.Sk,C.Cb,c.y,D.GE,D.Qw,T,w.ms,x.y,x.I,$.CI,$.Kw,g.kR,g.ew,O,c.QF,U],changeDetection:0})}return s})()},9772:(y,f,i)=>{i.d(f,{CU:()=>t,ye:()=>l});const c=(new Date).getTimezoneOffset()/60;function t(d,u=c){return"string"==typeof d&&d.length>0&&d.match(/\d{1,2}:\d{1,2}/)?`${Number(d.split(":")[0])-u}:${d.split(":")[1]}`:(console.error("Invalid string provided to strTimeTimezone",{string:d}),"")}function l(d,u=c){return t(d,-1*u)}},964:(y,f,i)=>{i.d(f,{Ez:()=>D,In:()=>P,Q1:()=>N,Q9:()=>$,QX:()=>g,Qx:()=>l,_0:()=>R,ay:()=>d,cr:()=>a,e6:()=>t,yc:()=>u});var c=i(400);const t=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}.\d{3}Z$/;function l(n,_){return new Date(`${n.formattedYear}-${n.formattedMonthPart}-${n.formattedDayPart} ${_.toString()}`).toISOString()}function d(n){if(!("string"==typeof n&&n.length>0&&n.match(t)))return console.error("Invalid string provided to isoStringToTuiDay",{isoString:n}),null;const _=new Date(n);return new c.EK(_.getFullYear(),_.getMonth()+1,_.getDate())}function u(n){if("string"==typeof n&&n.length>0&&n.match(/^\d{4}-\d{1,2}-\d{1,2}\s{1}\d{1,2}:\d{1,2}$/)&&(n=n.split(" ")[0]),!("string"==typeof n&&n.length>0&&n.match(/^\d{4}-\d{1,2}-\d{1,2}$/)))return console.error("Invalid string provided to stringToTuiDay. Expected format YYYY-MM-DD, got",{str:n}),null;const{day:_,month:m,year:T}=c.EK.parseRawDateString(n,"YMD");return new c.EK(T,m,_)}function a(n){if("string"==typeof n&&n.length>0&&n.match(/^\d{4}-\d{1,2}-\d{1,2}\s{1}\d{1,2}:\d{1,2}$/)&&(n=n.split(" ")[1]),!("string"==typeof n&&n.length>0&&n.match(/^\d{1,2}:\d{1,2}$/)))return console.error("Invalid string provided to stringToTuiDay. Expected format HH:mm, got",{str:n}),null;const[_,m]=n.split(":").map(T=>Number(T));return"number"==typeof _&&_>=0&&_<=23?"number"==typeof m&&m>=0&&m<60?new c.uc(_,m):(console.error("error while parsing time in stringToTuiTime. minutes are invalid",{minutes:m}),null):(console.error("error while parsing time in stringToTuiTime. hours is invalid ",{hours:_}),null)}function g(n){if(!("string"==typeof n&&n.length>0&&n.match(t)))return console.error("Invalid string provided to isoStringToTuiTime",{isoString:n}),null;const _=new Date(n);return new c.uc(_.getHours(),_.getMinutes())}function D(n){return new Date(`1970-01-01 ${n.toString()}`).toISOString()}function $(n){const _=new Date(`${n}Z`);return`${_.getFullYear()}-${String(_.getMonth()+1).padStart(2,"0")}-${String(_.getDate()).padStart(2,"0")} ${String(_.getHours()).padStart(2,"0")}:${String(_.getMinutes()).padStart(2,"0")}`}function P(n){return function w(n){const _=new Date(`1970-01-01 ${n}`);return`${`${_.getUTCHours()}`.padStart(2,"0")}:${`${_.getUTCMinutes()}`.padStart(2,"0")}`}(n.toString())}function R(n){return new c.EK(n.getFullYear(),n.getMonth(),n.getDate())}function N(n){return new c.uc(n.getHours(),n.getMinutes())}},1960:(y,f,i)=>{i.d(f,{u:()=>d});var c=i(8400),t=i(5136);class l extends c.w{constructor(a){super(a),this.date=a.date?new Date(a.date):void 0,this.reservation_turn_id=a.reservation_turn_id,this.group_id=a.group_id,this.reservation_turn=a.reservation_turn?new t.e(a.reservation_turn):void 0}}class d extends c.w{constructor(a){super(a),this.turns=[],this.dates=[],this.title=a.title,this.status=a.status,this.preorder_type=a.preorder_type,this.payment_value=a.payment_value,this.message=a.message,this.turns=(a.turns||[]).map(g=>new t.e(g)),this.dates=(a.dates||[]).map(g=>new l(g))}}},5136:(y,f,i)=>{i.d(f,{e:()=>d});var c=i(8400),t=i(9772),l=i(1960);class d extends c.w{constructor(a){super(a),this.name=a.name,this.weekday=a.weekday,this.step=a.step,this.valid_times=a.valid_times,this.starts_at=a.starts_at?(0,t.CU)(a.starts_at):void 0,this.ends_at=a.ends_at?(0,t.CU)(a.ends_at):void 0,this.preorder_reservation_group=a.preorder_reservation_group?new l.u(a.preorder_reservation_group):void 0}}},2516:(y,f,i)=>{i.d(f,{G:()=>t});var c=i(4496);let t=(()=>{class l{constructor(){this.weekdays=["Domenica","Luned\xEC","Marted\xEC","Mercoled\xEC","Gioved\xEC","Venerd\xEC","Sabato"]}transform(u){return"number"!=typeof u&&"string"==typeof u&&(u=parseInt(u)),"number"==typeof u&&u>=0&&u<=6?this.weekdays[u]:null}static#t=this.\u0275fac=function(a){return new(a||l)};static#e=this.\u0275pipe=c.UTH({name:"weekday",type:l,pure:!0,standalone:!0})}return l})()},4251:(y,f,i)=>{i.d(f,{e:()=>d});var c=i(6012),t=i(1960),l=i(4496);let d=(()=>{class u extends c.s{constructor(){super(t.u,"admin/preorder_reservation_groups")}static#t=this.\u0275fac=function(C){return new(C||u)};static#e=this.\u0275prov=l.wxM({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()},7556:(y,f,i)=>{i.d(f,{K:()=>d});var c=i(6012),t=i(5136),l=i(4496);let d=(()=>{class u extends c.s{constructor(){super(t.e,"admin/reservation_turns")}static#t=this.\u0275fac=function(C){return new(C||u)};static#e=this.\u0275prov=l.wxM({token:u,factory:u.\u0275fac,providedIn:"root"})}return u})()}}]);